\section{Cohomology of affine schemes}
\label{section:cohomology-of-affine-schemes}

\subsection{Review of the exterior algebra complex}
\label{subsection:review-exterior-algebra-complex}

\begin{env}[1.1.1]
\label{3.1.1.1}
Let $A$ be a ring, $\mathbf{f}=(f_i)_{1\leq i\leq r}$ a system of $r$ elements of $A$.
The \emph{exterior algebra complex $K_\bullet(\mathbf{f})$} corresponding to $\mathbf{f}$ is a chain complex (G, I, 2.2) defined in the following way: the graded $A$-module $K_\bullet(\mathbf{f})$ is equal to the \emph{exterior algebra $\wedge(A^r)$}, graded in the usual way, and the boundary map is the \emph{interior multiplication $i_\mathbf{f}$} by $\mathbf{f}$ considered as an element of the dual $\dual{(A^r)}$; we recall that $i_\mathbf{f}$ is an \emph{antiderivation} of degree $-1$ of $\wedge(A^r)$, and if $(\mathbf{e}_i)_{1\leq i\leq r}$ is the canonical basis of $A^r$, then we have $i_\mathbf{f}(\mathbf{e}_i)=f_i$; the verification of the condition $i_\mathbf{f}\circ i_\mathbf{f}=0$ is immediate.

An equivalent definition is the following: for each $i$, we consider a chain complex $K_\bullet(f_i)$ defined as follows: $K_0(f_i)=K_1(f_i)=A$, $K_n(f_i)=0$ for $n\neq 0,1$: the boundary map is defined by the condition that $d_1:A\to A$ is \emph{multiplication by $f_i$}.
We then take $K_\bullet(\mathbf{f})$ to be the \emph{tensor product $K_\bullet(f_1)\otimes K_\bullet(f_2)\otimes\cdots\otimes K_\bullet(f_r)$} (G, I, 2.7) with its total degree; the verification of the isomorphism from this complex to the complex defined above is immediate.
\end{env}

\begin{env}[1.1.2]
\label{3.1.1.2}
For every $A$-module $M$, we define the \emph{chain complex}
\[
  K_\bullet(\mathbf{f},M)=K_\bullet(\mathbf{f})\otimes_A M
  \tag{1.1.2.1}
\]
and the \emph{cochain complex} (G, I, 2.2)
\[
  K^\bullet(\mathbf{f},M)=\Hom_A(K_\bullet(\mathbf{f},M).
  \tag{1.1.2.2}
\]

If $g$ is a $k$-cochain of this latter complex, and if we set
\[
  g(i_1,\dots,i_k)=g(\mathbf{e}_{i_1}\wedge\cdots\wedge\mathbf{e}_{i_k}),
\]
then $g$ identifies with an \emph{alternating} map from $[1,r]^k$ to $M$, and it follows from the above definitions that we have
\[
  d^k g(i_1,i_2,\dots,i_{k+1})=\sum_{h=1}^{k+1}(-1)^{h-1}f_{i_h}g(i_1,\dots,\wh{i_h},\dots,i_{k+1}).
  \tag{1.1.2.3}
\]
\end{env}

\begin{env}[1.1.3]
\label{3.1.1.3}
\oldpage[III]{83}
From the above complexes, we deduce as usual the \emph{homology and cohomology $A$-modules} (G, I, 2.2)
\[
  \HH_\bullet(\mathbf{f},M)=\HH_\bullet(K_\bullet(\mathbf{f},M)),
  \tag{1.1.3.1}
\]
\[
  \HH^\bullet(\mathbf{f},M)=\HH^\bullet(K^\bullet(\mathbf{f},M)).
  \tag{1.1.3.2}
\]

We define an \emph{$A$-isomorphism $K_\bullet(\mathbf{f},M)\isoto K^\bullet(\mathbf{f},M)$} by sending each chain $z=\sum(\mathbf{e}_{i_1}\wedge\cdots\wedge\mathbf{e}_{i_k})\otimes z_{i_1,\dots,i_k}$ to the cochain $g_z$ such that $g_z(j_1,\dots,j_{r-k})=\varepsilon z_{i_1,\dots,i_k}$, where $(j_h)_{1\leq h\leq r-k}$ is the strictly increasing sequence complementary to the strictly increasing sequence $(i_h)_{1\leq h\leq k}$ in $[1,r]$ and $\varepsilon=(-1)^\nu$, where $\nu$ is the number of inversions of the permutation $i_1,\dots,i_k,j_1,\dots,j_{r-k}$ of $[1,r]$.
We verify that $g_{dz}=d(g_z)$, which gives an isomorphism
\[
  \HH^i(\mathbf{f},M)\isoto\HH_{r-i}(\mathbf{f},M)\text{ for }0\leq i\leq r.
  \tag{1.1.3.3}
\]

In this chapter, we will especially consider the cohomology modules $\HH^\bullet(\mathbf{f},M)$.

For a given $\mathbf{f}$, it is immediate (G, I, 2.1) that $M\mapsto\HH^\bullet(\mathbf{f},M)$ is a \emph{cohomological functor} (T, II, 2.1) from the category of $A$-modules to the category of graded $A$-modules, zero in degrees $<0$ and $>r$.
In addition, we have
\[
  \HH^0(\mathbf{f},M)=\Hom_A(A/(\mathbf{f}),M),
  \tag{1.1.3.4}
\]
denoting by $(\mathbf{f})$ the ideal of $A$ generated by $f_1,\dots,f_r$; this follows immediately from (1.1.2.3), and it is clear that $\HH^0(\mathbf{f},M)$ identifies with the submodule of $M$ \emph{killed by $(\mathbf{f})$}.
Similarly, we have by (1.1.2.3) that
\[
  \HH^r(\mathbf{f},M)=M/\bigg(\sum_{i=1}^r f_i M\bigg)=(A/(\mathbf{f}))\otimes_A M.
  \tag{1.1.3.5}
\]

We will use the following known result, which we will recall a proof of to be complete:
\end{env}

\begin{prop}[1.1.4]
\label{3.1.1.4}
Let $A$ be a ring, $\mathbf{f}=(f_i)_{1\leq i\leq r}$ a finite family of elements of $A$, and $M$ an $A$-module.
If, for $1\leq i\leq r$, the scaling $z\mapsto f_i\cdot z$ on $M_{i-1}=M/(f_1 M+\cdots+f_{i-1}M)$ is injective, then we have $\HH^i(\mathbf{f},M)=0$ for $i\neq r$.
\end{prop}

It suffices to prove that $\HH_i(\mathbf{f},M)=0$ for all $i>0$ according to (1.1.3.3).
We argue by induction on $r$, the case $r=0$ being trivial.
Set $\mathbf{f}'=(f_i)_{1\leq i\leq r-1}$; this family satisfies the conditions in the statement, so if we set $L_\bullet=K_\bullet(\mathbf{f}',M)$, then we have $\HH_i(L_\bullet)=0$ for $i>0$ by hypothesis, and $\HH_0(L_\bullet)=M_{r-1}$ by virtue of (1.1.3.3) and (1.1.3.5).
To abbreviate, set $K_\bullet=K_\bullet(f_r)=K_0\oplus K_1$, with $K_0=K_1=A$, $d_1:K_1\to K_0$ multiplication by $f_r$; we have by definition \sref{3.1.1.1} that $K_\bullet(\mathbf{f},M)=K_\bullet\otimes_A L_\bullet$.
We have the following lemma:

\begin{lem}[1.1.4.1]
\label{3.1.1.4.1}
Let $K_\bullet$ be a chain complex of free $A$-modules, zero except in dimensions $0$ and $1$.
For every chain complex $L_\bullet$ of $A$-modules, we have an exact sequence
\[
  0\to\HH_0(K_\bullet\otimes\HH_p(L_\bullet))\to\HH_p(K_\bullet\otimes L_\bullet)\to\HH_1(K_\bullet\otimes\HH_{p-1}(L_\bullet))\to 0
\]
for every index $p$.
\end{lem}

\oldpage[III]{84}
This is a particular case of an exact sequece of low-order terms of the K\"unneth spectral sequence (M, XVII, 5.2 (a) and G, I, 5.5.2); it can be proved directly as follows.
Consider $K_0$ and $K_1$ as chain complexes (zero in dimensions $\neq 0$ and $\neq 1$ respectively); we then have an exact sequence of complexes
\[
  0\to K_0\otimes L_\bullet\to K_\bullet\otimes L_\bullet\to K_1\otimes L_\bullet\to 0,
\]
to which we can apply the exact sequence in homology
\[
  \cdots\to\HH_{p+1}(K_1\otimes L_\bullet)\xrightarrow{\partial}\HH_p(K_0\otimes L_\bullet)\to\HH_p(K_\bullet\otimes L_\bullet)\to\HH_p(K_1\otimes L_\bullet)\xrightarrow{\partial}\HH_{p-1}(K_0\otimes L_\bullet)\to\cdots.
\]
But it is evident that $\HH_p(K_0\otimes L_\bullet)=K_0\otimes\HH_p(L_\bullet)$ and $\HH_p(K_1\otimes L_\bullet)=K_1\otimes\HH_{p-1}(L_\bullet)$ for all $p$; in addition, we verify immediately that the operator $\partial:K_1\otimes\HH_p(L_\bullet)\to K_0\otimes\HH_p(L_\bullet)$ is none other than $d_1\otimes 1$; the lemma thus follows from the above exact sequence and the definition of $\HH_0(K_\bullet\otimes\HH_p(L_\bullet))$ and $\HH_1(K_\bullet\otimes\HH_{p-1}(L_\bullet))$.

The lemma having been established, the end of the proof of Proposition \sref{3.1.1.4} is immediate: the induction hypothesis of Lemma \sref{3.1.1.4.1} gives $\HH_p(K_\bullet\otimes L_\bullet)=0$ for $p\geq 2$; in addition if we show that $\HH_1(K_\bullet,\HH_0(L_\bullet))=0$, then we also deduce from Lemma \sref{3.1.1.4.1} that $\HH_1(K_\bullet\otimes L_\bullet)=0$; but by definition, $\HH_1(K_\bullet,\HH_0(L_\bullet))$ is none other than the kernel of the scaling $z\mapsto f_r\cdot z$ on $M_{r-1}$, and as by hypothesis this kernel is zero, this finishes the proof.

\begin{env}[1.1.5]
\label{3.1.1.5}
Let $\mathbf{g}=(g_i)_{1\leq i\leq r}$ be a second sequence of $r$ elements of $A$, and set $\mathbf{f}\mathbf{g}=(f_i g_i)_{1\leq i\leq r}$.
We can define a canonical homomorphism of complexes
\[
  \vphi_\mathbf{g}:K_\bullet(\mathbf{f}\mathbf{g})\to K_\bullet(\mathbf{f})
  \tag{1.1.5.1}
\]
as the canonical extension to the exterior algebra $\wedge(A^r)$ of the $A$-linear map $(x_1,\dots,x_r)\mapsto(g_1 x_1,\dots,g_r x_r)$ from $A^r$ to itself.
To see that we have a homomorphism of complexes, it suffices to note, in general, that if $u:E\to F$ is an $A$-linear map, and if $\mathbf{x}\in\dual{F}$ and $\mathbf{y}={}^t u(\mathbf{x})\in\dual{E}$, then we have the formula
\[
  (\wedge u)\circ i_\mathbf{y}=i_\mathbf{x}\circ(\wedge u);
  \tag{1.1.5.2}
\]
indeed, the two elements are antiderivations of $\wedge F$, and it suffies to check that they coincide on $F$, which follows immediately from the definitions.

When we identify $K_\bullet(\mathbf{f})$ with the tensor product of the $K_\bullet(f_i)$ \sref{3.1.1.1}, $\vphi_\mathbf{g}$ is the tensor product of the $\vphi_{g_i}$, where $\vphi_{g_i}$ is the identity in degree $0$ and multiplication by $g_i$ in degree $1$.
\end{env}

\begin{env}[1.1.6]
\label{3.1.1.6}
In particular, for every pair of integers $m$ and $n$ such that $0\leq n\leq m$, we have homomorphisms of complexes
\[
  \vphi_{\mathbf{f}^{m-n}}:K_\bullet(\mathbf{f}^m)\to K_\bullet(\mathbf{f}^n)
  \tag{1.1.6.1}
\]
and as a result, homomorphisms
\[
  \vphi_{\mathbf{f}^{m-n}}:K^\bullet(\mathbf{f}^n,M)\to K^\bullet(\mathbf{f}^m,M),
  \tag{1.1.6.2}
\]
\[
  \vphi_{\mathbf{f}^{m-n}}:\HH^\bullet(\mathbf{f}^n,M)\to\HH^\bullet(\mathbf{f}^m,M).
  \tag{1.1.6.3}
\]

\oldpage[III]{85}
The latter homomorphisms evidently satisfy the transitivity condition $\vphi_{\mathbf{f}^{m-p}}=\vphi_{\mathbf{f}^{m-n}}\circ\vphi_{\mathbf{f}^{n-p}}$ for $p\leq n\leq m$; they therefore define two \emph{inductive systems} of $A$-modules; we set
\[
  C^\bullet((\mathbf{f}),M)=\varinjlim_n K^\bullet(\mathbf{f}^n,M),
  \tag{1.1.6.4}
\]
\[
  \HH^\bullet((\mathbf{f}),M)=\HH^\bullet(C^\bullet((\mathbf{f}),M))=\varinjlim_n\HH^\bullet(\mathbf{f}^n,M),
  \tag{1.1.6.5},
\]
the last equality following from the fact that passing to the inductive limit commutes with the functor $\HH^\bullet$ (G, I, 2.1).
We will later see \sref{3.1.4.3} that $\HH^\bullet((\mathbf{f}),M)$ does not depend on the \emph{ideal $(\mathbf{f})$} of $A$ (and similarly on the $(\mathbf{f})$-pre-adic topology on $A$), which justifies the notations.

It is clear that $M\mapsto C^\bullet((\mathbf{f}),M)$ is an exact $A$-linear functor, and $M\mapsto\HH^\bullet((\mathbf{f}),M)$ is a cohomological functor.
\end{env}

\begin{env}[1.1.7]
\label{3.1.1.7}
Set $\mathbf{f}=(f_i)\in A^r$ and $\mathbf{g}=(g_i)\in A^r$; denote by $e_\mathbf{g}$ the left multiplication by the vector $\mathbf{g}\in A^r$ on the exterior algebra $\wedge(A^r)$; we know that we have the \emph{homotopy formula}
\[
  i_\mathbf{f}e_\mathbf{g}+e_\mathbf{g}i_\mathbf{f}=\langle\mathbf{g},\mathbf{f}\rangle 1
  \tag{1.1.7.1}
\]
in the $A$-module $A^r$ ($1$ denotes the identity automorphism of $A^r$); this relation also implies that \emph{in the complex $K_\bullet(\mathbf{f})$} we have
\[
  de_\mathbf{g}+e_\mathbf{g}d=\langle\mathbf{g},\mathbf{f}\rangle 1.
  \tag{1.1.7.2}
\]

If the ideal $(\mathbf{f})$ is equal to $A$, then there exists a $\mathbf{g}\in A^r$ such that $\langle\mathbf{g},\mathbf{f}\rangle=\sum_{i=1}^r g_i f_i=1$.
As a result (G, I, 2.4):
\end{env}

\begin{prop}[1.1.8]
\label{3.1.1.8}
Suppose that the ideal $(\mathbf{f})$ generated by the $f_i$ is equal to $A$.
Then the complex $K_\bullet(\mathbf{f})$ is homotopically trivial, and so are the complexes $K_\bullet(\mathbf{f},M)$ and $K^\bullet(\mathbf{f},M)$ for every $A$-module $M$.
\end{prop}

\begin{cor}[1.1.9]
\label{3.1.1.9}
If $(\mathbf{f})=A$, then we have $\HH^\bullet(\mathbf{f},M)=0$ and $\HH^\bullet((\mathbf{f}),M)=0$ for every $A$-module $M$.
\end{cor}

\begin{proof}
\label{proof-3.1.1.9}
Indeed, we then have $(\mathbf{f}^n)=A$ for all $n$.
\end{proof}

\begin{rmk}[1.1.10]
\label{3.1.1.10}
With the same notations as above, set $X=\Spec(A)$ and $Y$ the closed subprescheme of $X$ defined by the ideal $(\mathbf{f})$.
We will prove in \textsection9 that $\HH^\bullet((\mathbf{f}),M)$ is isomorphic to the cohomology $\HH_Y^\bullet(X,\wt{M})$ corresponding to the antifilter $\Phi$ of closed subsets of $Y$ (T, 3.2).
We will also show that Proposition \sref{3.1.2.3} applied to $X$ and to $\sh{F}=\wt{M}$ is a particular case of an exact sequence in cohomology
\[
  \cdots\to\HH_Y^p(X,\sh{F})\to\HH^p(X,\sh{F})\to\HH^p(X\setmin Y,\sh{F})\to\HH_Y^{p+1}(X,\sh{F})\to\cdots.
\]
\end{rmk}

\subsection{\v Cech cohomology of an open cover}
\label{subsection:cech-cohomology-open-cover}

\begin{nota}[1.2.1]
\label{3.1.2.1}
In this section, we denote:
\begin{enumerate}[label=--]
  \item $X$ a prescheme;
  \item $\sh{F}$ a quasi-coherent $\OO_X$-module;
\oldpage[III]{86}
  \item $A=\Gamma(X,\OO_X)$, $M=\Gamma(X,\sh{F})$;
  \item $\mathbf{f}=(f_i)_{1\leq i\leq r}$ a finite system of elements of $A$;
  \item $U_i=X_{f_i}$, the open set \sref[0]{0.5.5.2} of the $x\in X$ such that $f_i(x)\neq 0$;
  \item $U=\bigcup_{i=1}^r U_i$;
  \item $\fk{U}$ the cover $(U_i)_{1\leq i\leq r}$ of $U$.
\end{enumerate}
\end{nota}

\begin{env}[1.2.2]
\label{3.1.2.2}
Suppose that $X$ is either a prescheme whose underlying space is \emph{Noetherian} or a \emph{scheme} whose underlying space is \emph{quasi-compact}.
We then know \sref[I]{1.9.3.3} that we have $\Gamma(U_i,\sh{F})=M_{f_i}$.
We set
\[
  U_{i_0 i_1\cdots i_p}=\bigcap_{k=0}^p U_{i_k}=X_{f_{i_0}f_{i_1}\cdots f_{i_p}}
\]
\sref[0]{0.5.5.3}; so we also have
\[
  \Gamma(U_{i_0 i_1\cdots i_p},\sh{F})=M_{f_{i_0}f_{i_1}\cdots f_{i_p}}.
  \tag{1.2.2.1}
\]

We have \sref[0]{0.1.6.1} that $M_{f_{i_0}f_{i_1}\cdots f_{i_p}}$ identifies with the inductive limit $\varinjlim_n M_{i_0 i_1\cdots i_p}^{(n)}$, where the inductive system is formed by the $M_{i_0 i_1\cdots i_p}^{(n)}=M$, the homomorphisms $\vphi_{nm}:M_{i_0 i_1\cdots i_p}^{(m)}\to M_{i_0 i_1\cdots i_p}^{(n)}$ being multiplication by $(f_{i_0}f_{i_1}\cdots f_{i_p})^{n-m}$ for $m\leq n$.
We denote by $C_n^p(M)$ the set of \emph{alternating} maps from $[1,r]^{p+1}$ to $M$ (for all $n$); these $A$-modules also form an inductive system with respect to the $\vphi_{nm}$.
If $C^p(\fk{U},\sh{F})$ is the group of \emph{alternating} \v Cech $p$-cochains relative to the cover $\fk{U}$, with coefficients in $\sh{F}$ (G, II, 5.1), then it follows from the above that we can write
\[
  C^p(\fk{U},\sh{F})=\varinjlim_n C_n^p(M).
  \tag{1.2.2.2}
\]

With the notations of \sref{3.1.1.2}, $C_n^p(M)$ identifies with $K^{p+1}(\mathbf{f}^n,M)$, and the map $\vphi_{nm}$ identifies with the map $\vphi_{\mathbf{f}^{n-m}}$ defined in \sref{3.1.1.6}.
We thus have, for every $p\geq 0$, a canonical functorial isomorphism
\[
  C^p(\fk{U},\sh{F})\isoto C^{p+1}((\mathbf{f}),M).
  \tag{1.2.2.3}
\]

In addition, the formula (1.1.2.3) and the definition of the cohomology of a cover (G, II, 5.1) shows that the isomorphisms (1.2.2.3) are compatible with the coboundary maps.
\end{env}

\begin{prop}[1.2.3]
\label{3.1.2.3}
If $X$ is a prescheme whose underlying space in Noetherian or a scheme whose underlying space is quasi-compact, then there exists a canonical functorial isomorphism in $\sh{F}$
\[
  \HH^p(\fk{U},\sh{F})\isoto\HH^{p+1}((\mathbf{f}),M)\text{ for }p\geq 1.
  \tag{1.2.3.1}
\]

In addition, we have a functorial exact sequence in $\sh{F}$
\[
  0\to\HH^0((\mathbf{f}),M)\to M\to\HH^0(\fk{U},\sh{F})\to\HH^1((\mathbf{f}),M)\to 0.
  \tag{1.2.3.2}
\]
\end{prop}

\begin{proof}
\label{proof-3.1.2.3}
\oldpage[III]{87}
The isomorphisms (1.2.3.1) are immediate consequences of what we saw in \sref{3.1.2.2}.
On the other hand, we have $C^0(\fk{U},\sh{F})=C^1((\mathbf{f}),M)$; as a result, $\HH^0(\fk{U},\sh{F})$ identifies with the subgroup of $1$-cocycles of $C^1((\mathbf{f}),M)$; as $M=C^0((\mathbf{f}),M)$, the exact sequence (1.2.3.2) is none other than the one given by the definition of the cohomology groups $\HH^0((\mathbf{f}),M)$ and $\HH^1((\mathbf{f}),M)$.
\end{proof}

\begin{cor}[1.2.4]
\label{3.1.2.4}
Suppose that the $X_{f_i}$ are quasi-compact and that there exists $g_i\in\Gamma(U,\sh{F})$ such that $\sum_i g_i(f_i|U)=1|U$.
Then for every quasi-coherent $(\OO_X|U)$-module $\sh{G}$, we have $\HH^p(\fk{U},\sh{G})=0$ for $p>0$; if in addition $U=X$, then the canonical homomorphism (1.2.3.2) $M\to\HH^0(\fk{U},\sh{F})$ is bijective.
\end{cor}

\begin{proof}
\label{proof-3.1.2.4}
As by hypothesis the $U_i=X_{f_i}$ are quasi-compact, so is $U$, and we can reduce to the case where $U=X$; the hypothesis then implies that $\HH^p((\mathbf{f}),M)=0$ for all $p\geq 0$ \sref{3.1.1.9}.
The corollary then follows immediately from (1.2.3.1) and (1.2.3.2).
\end{proof}

We note that since $\HH^0(\fk{U},\sh{F})=\HH^0(U,\sh{F})$ (G, II, 5.2.2), we have again proved \sref[I]{1.1.3.7} as a special case.

\begin{rmk}[1.2.5]
\label{3.1.2.5}
Suppose that $X$ is an \emph{affine scheme}; then the $U_i=X_{f_i}=D(f_i)$ are affine open sets, as well as the $U_{i_0 i_1\cdots i_p}$ (but $U$ is not necessarily affine).
In this case, the functors $\Gamma(X,\sh{F})$ and $\Gamma(U_{i_0 i_1\cdots i_p},\sh{F})$ are exact in $\sh{F}$ \sref[I]{1.1.3.11}.
If we have an exact sequence $0\to\sh{F}'\to\sh{F}\to\sh{F}''\to 0$ of quasi-coherent $\OO_X$-modules, then the sequence of complexes
\[
  0\to C^\bullet(\fk{U},\sh{F}')\to C^\bullet(\fk{U},\sh{F})\to C^\bullet(\fk{U},\sh{F}'')\to 0
\]
is exact, and thus gives an exact sequence in cohomolology
\[
  \cdots\to\HH^p(\fk{U},\sh{F})\to\HH^p(\fk{U},\sh{F})\to\HH^p(\fk{U},\sh{F}'')\xrightarrow{\partial}\HH^{p+1}(\fk{U},\sh{F}')\to\cdots.
\]
On the other hand, if we set $M'=\Gamma(X,\sh{F}')$ and $M''=\Gamma(X,\sh{F}'')$, then the sequence $0\to M'\to M\to M''\to 0$ is exact; as $C^\bullet((\mathbf{f}),M)$ is an exact functor in $M$, we also have the exact sequence in cohomology
\[
  \cdots\to\HH^p((\mathbf{f}),M')\to\HH^p((\mathbf{f}),M)\to\HH^p((\mathbf{f}),M'')\xrightarrow{\partial}\HH^{p+1}((\mathbf{f}),M')\to\cdots.
\]

This being so, as the diagram
\[
  \xymatrix{
    0\ar[r] &
    C^\bullet(\fk{U},\sh{F}')\ar[r]\ar[d] &
    C^\bullet(\fk{U},\sh{F})\ar[r]\ar[d] &
    C^\bullet(\fk{U},\sh{F}'')\ar[r]\ar[d] &
    0\\
    0\ar[r] &
    C^\bullet((\mathbf{f}),M')\ar[r] &
    C^\bullet((\mathbf{f}),M)\ar[r] &
    C^\bullet((\mathbf{f}),M'')\ar[r] &
    0
  }
\]
\oldpage[III]{88}
is commutative, we conclude that the diagrams
\[
  \xymatrix{
    \HH^p(\fk{U},\sh{F}'')\ar[r]^\partial\ar[d] &
    \HH^{p+1}(\fk{U},\sh{F}')\ar[d]\\
    \HH^{p+1}((\mathbf{f}),M'')\ar[r]^\partial &
    \HH^{p+2}((\mathbf{f}),M')
  }
  \tag{1.2.5.1}
\]
are commutative for all $p$ (G, I, 2.1.1).
\end{rmk}

\subsection{Cohomology of an affine scheme}
\label{subsection:cohomology-affine-scheme}

\begin{thm}[1.3.1]
\label{3.1.3.1}
Let $X$ be an affine scheme.
For every quasi-coherent $\OO_X$-module $\sh{F}$, we have $\HH^p(X,\sh{F})=0$ for all $p>0$.
\end{thm}

\begin{proof}
\label{proof-3.1.3.1}
Let $\fk{U}$ be a finite cover of $X$ by the affine open sets $X_{f_i}=D(f_i)$ ($1\leq i\leq r$); we then know that the ideal of $A=\Gamma(X,\OO_X)$ generated by the $f_i$ is equal to $A$.
We thus conclude from Corollary~\sref{3.1.2.4} that we have $\HH^p(\fk{U},\sh{F})=0$ for $p>0$.
As there are finite covers of $X$ by affine open sets which are arbitrarily fine \sref[I]{1.1.1.10}, the definition of \v Cech cohomology (G, II, 5.8) shows that we also have $\CHH^p(X,\sh{F})=0$ for $p>0$.
But this also applies to every prescheme $X_f$ for $f\in A$ \sref[I]{1.1.3.6}, hence $\CHH^p(X_f,\sh{F})=0$ for $p>0$.
As we have $X_f\cap X_g=X_{fg}$, we deduce that we also have $\HH^p(X,\sh{F})=0$ for all $p>0$, by virtue of (G, II, 5.9.2).
\end{proof}

\begin{cor}[1.3.2]
\label{3.1.3.2}
Let $Y$ be a prescheme, $f:X\to Y$ an affine morphism \sref[II]{2.1.6.1}.
For every quasi-coherent $\OO_X$-module $\sh{F}$, we have $\RR^q f_*(\sh{F})=0$ for $q>0$.
\end{cor}

\begin{proof}
\label{proof-3.1.3.2}
By definition $\RR^q f_*(\sh{F})$ is the $\OO_Y$-module associated to the presheaf $U\mapsto\HH^q(f^{-1}(U),\sh{F})$, where $U$ varies over the open subsets of $Y$.
But the affine open sets form a basis for $Y$, and for such an open set $U$, $f^{-1}(U)$ is affine \sref[II]{2.1.3.2}, hence $\HH^q(f^{-1}(U),\sh{F})=0$ by Theorem~\sref{3.1.3.1}, which proves the corollary.
\end{proof}

\begin{cor}[1.3.3]
\label{3.1.3.3}
Let $Y$ be a prescheme, $f:X\to Y$ an affine morphism.
For every quasi-coherent $\OO_X$-module $\sh{F}$, the canonical homomorphism $\HH^p(Y,f_*(\sh{F}))\to\HH^p(X,\sh{F})$ (\textbf{0},~12.1.3.1) is bijective for all $p$.
\end{cor}

\begin{proof}
\label{proof-3.1.3.3}
It suffices (by \sref[0]{0.12.1.7}) to show that the edge homomorphisms $''E_2^{p0}=\HH^p(Y,f_*(\sh{F}))\to\HH^p(X,\sh{F})$ of the second spectral sequence of the composite functor $\Gamma f_*$ are bijective.
But the $E_2$-term of this spectral sequence is given by $''E_2^{pq}=\HH^p(Y,\RR^q f_*(\sh{F}))$ (G, II, 4.17.1), so it follows from Corollary~\sref{3.1.3.2} that $''E_2^{pq}=0$ for $q>0$, and the spectral sequence degenerates; hence our assertion \sref[0]{0.11.1.6}.
\end{proof}

\begin{cor}[1.3.4]
\label{3.1.3.4}
Let $f:X\to Y$ be an affine morphism, $g:Y\to Z$ a morphism.
\oldpage[III]{89}
For every quasi-coherent $\OO_X$-module $\sh{F}$, the canonical homomorphism $\RR^p g_*(f_*(\sh{F}))\to\RR^p(g\circ f)_*(\sh{F})$ (\textbf{0},~12.2.5.1) is bijective for all $p$.
\end{cor}

\begin{proof}
\label{proof-3.1.3.4}
It suffices to note that, according to Corollary~\sref{3.1.3.3}, for every affine open subset $W$ of $Z$, the canonical homomorphism $\HH^p(g^{-1}(W),f_*(\sh{F}))\to\HH^p(f^{-1}(g^{-1}(W)),\sh{F})$ is bijective; this proves that the homomorphism of presheaves defining the canonical homomorphism $\RR^p g_*(f_*(\sh{F}))\to\RR^p(g\circ f)_*(\sh{F})$ is bijective \sref[0]{0.12.2.5}.
\end{proof}

\subsection{Application to the cohomology of arbitrary preschemes}
\label{subsection:application-cohomology-preschemes}

\begin{prop}[1.4.1]
\label{3.1.4.1}
Let $X$ be a scheme, $\fk{U}=(U_\alpha)$ be a cover of $X$ by affine open sets.
For every quasi-coherent $\OO_X$-module $\sh{F}$, the cohomology modules $\HH^\bullet(X,\sh{F})$ and $\HH^\bullet(\fk{U},\sh{F})$ (over $\Gamma(X,\OO_X)$) are canonically isomorphic.
\end{prop}

\begin{proof}
\label{proof-3.1.4.1}
As $X$ is a scheme, every finite intersection $V$ of open sets in the cover $\fk{U}$ is affine \sref[I]{1.5.5.6}, so $\HH^q(V,\sh{F})=0$ for $g\geq 1$ by Theorem~\sref{3.1.3.1}.
The proposition then follows from a theorem of Leray (G, II, 5.4.1).
\end{proof}

\begin{rmk}[1.4.2]
\label{3.1.4.2}
We note that the result of Proposition~\sref{3.1.4.1} is still true when the finite intersections of the sets $U_\alpha$ are affine, even when we do not necessarily assume that $X$ is a scheme.
\end{rmk}

\begin{cor}[1.4.3]
\label{3.1.4.3}
Let $X$ be a scheme with quasi-compact underlying space, $A=\Gamma(X,\OO_X)$, and $\mathbf{f}=(f_i)_{1\leq i\leq r}$ a finite sequence of elements of $A$ such that the $X_{f_i}$ (notation of \sref{3.1.2.1}) are affine.
Then (with the notations of \sref{3.1.2.1}), for every quasi-coherent $\OO_X$-module $\sh{F}$, we have a canonical isomorphism which is functorial in $\sh{F}$
\[
  \HH^q(U,\sh{F})\isoto\HH^{q+1}((\mathbf{f}),M)\text{ for }q\geq 1,
  \tag{1.4.3.1}
\]
and an exact sequence which is functorial in $\sh{F}$
\[
  0\to\HH^0((\mathbf{f}),M)\to M\to\HH^0(U,\sh{F})\to\HH^1((\mathbf{f}),M)\to 0.
  \tag{1.4.3.2}
\]
\end{cor}

\begin{proof}
\label{proof-3.1.4.3}
This follows immediately from Propositions~\sref{3.1.4.1} and \sref{3.1.2.3}.
\end{proof}

\begin{env}[1.4.4]
\label{3.1.4.4}
If $X$ is an \emph{affine scheme}, then it follows from Remark~\sref{3.1.2.5} and Proposition~\sref{3.1.4.1} that for all $q\geq 0$, the diagrams
\[
  \xymatrix{
    \HH^q(U,\sh{F}'')\ar[r]^\partial\ar[d] &
    \HH^{q+1}(U,\sh{F}')\ar[d]\\
    \HH^{q+1}((\mathbf{f}),M'')\ar[r]^\partial &
    \HH^{q+2}((\mathbf{f}),M')
  }
  \tag{1.4.4.1}
\]
corresponding to an exact sequence $0\to\sh{F}'\to\sh{F}\to\sh{F}''\to 0$ of quasi-coherent $\OO_X$-modules (with the notations of Remark~\sref{3.1.2.5}) are commutative.
\end{env}

\begin{prop}[1.4.5]
\label{3.1.4.5}
\oldpage[III]{90}
Let $X$ be a quasi-compact scheme, $\sh{L}$ an invertible $\OO_X$-module, and consider the graded ring $A_*=\Gamma_*(\sh{L})$ \sref[0]{0.5.4.6}; then $\HH^\bullet(\sh{F},\sh{L})=\bigoplus_{n\in\bb{Z}}\HH^\bullet(X,\sh{F}\otimes\sh{L}^{\otimes n})$ is a graded $A_*$-module, and for all $f\in A_n$, we have a canonical isomorphism
\[
  \HH^\bullet(X_f,\sh{F})\isoto(\HH^\bullet(\sh{F},\sh{L}))_{(f)}
  \tag{1.4.5.1}
\]
of $(A_*)_{(f)}$-modules.
\end{prop}

\begin{proof}
\label{proof-3.1.4.5}
As $X$ is a quasi-compact scheme, we can calculate the cohomology of all the $\OO_X$-modules $\sh{F}\otimes\sh{L}^{\otimes n}$ using the same finite cover $\fk{U}=(U_i)$ consisting of the affine open sets such that the restriction $\sh{L}|U_i$ is isomorphic to $\OO_X|U_i$ for each $i$ \sref{3.1.4.1}.
It is then immediate that the $U_i\cap X_f$ are affine open sets \sref[I]{3.1.3.6}, and we can thus calculate the cohomology $\HH^\bullet(X_f,\sh{F}\otimes\sh{L}^{\otimes n})$ using the cover $\fk{U}|X_f=(U_i\cap X_f)$ \sref{3.1.4.1}.
It is immediate that for all $f\in A_n$, multiplication by $f$ defines a homomorphism $C^\bullet(\fk{U},\sh{F}\otimes\sh{L}^m)\to C^\bullet(\fk{U},\sh{F}\otimes\sh{L}^{\otimes(m+n)})$, hence a homomorphism $\HH^\bullet(\fk{U},\sh{F}\otimes\sh{L}^{\otimes m})\to\HH^\bullet(\fk{U},\sh{F}\otimes\sh{L}^{\otimes(m+n)})$, which establishes the first assertion.
On the other hand, for a given $f\in A_n$, it follows from \sref[I]{1.9.3.2} that we have an isomorphism of complexes of $(A_*)_{(f)}$-modules
\[
  C^\bullet(\fk{U}|X_f,\sh{F})\isoto\bigg(\!\!C^\bullet\bigg(\fk{U},\bigoplus_{n\in\bb{Z}}\sh{F}\otimes\sh{L}^{\otimes n}\bigg)\!\!\bigg)_{(f)},
\]
taking into account \sref[I]{1.1.3.9}[ii].
Passing to the cohomology of these complexes, we induce the isomorphism (1.4.5.1), recalling that the functor $M\mapsto M_{(f)}$ is exact on the category of graded $A_*$-modules.
\end{proof}

\begin{cor}[1.4.6]
\label{3.1.4.6}
Suppose that the hypotheses of Proposition~\sref{3.1.4.5} are satisfied, and in addition suppose that $\sh{L}=\OO_X$.
If we set $A=\Gamma(X,\OO_X)$, then for all $f\in A$, we have a canonical isomorphism $\HH^\bullet(X_f,\sh{F})\isoto(\HH^\bullet(X,\sh{F}))_f$ of $A_f$-modules.
\end{cor}

\begin{cor}[1.4.7]
\label{3.1.4.7}
Let $X$ be a quasi-compact scheme, $f$ an element of $\Gamma(X,\OO_X)$.
\begin{enumerate}[label=\emph{(\roman*)}]
  \item Suppose that the open set $X_f$ is affine.
    Then for every quasi-coherent $\OO_X$-module $\sh{F}$, every $i>0$, and every $\xi\in\HH^i(X,\sh{F})$, there exists an integer $n>0$ such that $f^n\xi=0$.
  \item Conversely, suppose that $X_f$ is quasi-compact and that for every quasi-coherent sheaf of ideals $\sh{J}$ of $\OO_X$ and every $\zeta\in\HH^1(X,\sh{J})$, there exists an $n>0$ such that $f^n\zeta=0$.
    Then $X_f$ is affine.
\end{enumerate}
\end{cor}

\begin{proof}
\label{proof-3.1.4.7}
\medskip\noindent
\begin{enumerate}[label=(\roman*)]
  \item If $X_f$ is affine, then we have $\HH^i(X_f,\sh{F})=0$ for all $i>0$ \sref{3.1.3.1}, so the assertion follows directly from Corollary~\sref{3.1.4.6}.
  \item By virtue of Serre's criterion \sref[II]{2.5.2.1}, it suffices to prove that for every quasi-coherent sheaf of ideals $\sh{K}$ of $\OO_X|X_f$, we have $\HH^1(X_f,\sh{K})=0$.
    As $X_f$ is a quasi-compact open set in a quasi-compact scheme $X$, there exists a quasi-coherent sheaf of ideals $\sh{J}$ of $\OO_X$ such that $\sh{K}=\sh{J}|X_f$ \sref[I]{1.9.4.2}.
    According to Corollary~\sref{3.1.4.6}, we have $\HH^1(X_f,\sh{K})=(\HH^1(X,\sh{J}))_f$, and the hypothesis implies that the right hand side is zero, hence the assertion.
\end{enumerate}
\end{proof}

\begin{rmk}[1.4.8]
\label{3.1.4.8}
We note that Corollary~\sref{3.1.4.7}[i] gives a simpler proof of the relation (\textbf{II},~4.5.13.2).
\end{rmk}

\begin{lem}[1.4.9]
\label{3.1.4.9}
\oldpage[III]{91}
Let $X$ be a quasi-comact scheme, $\fk{U}=(U_i)_{1\leq i\leq n}$ a finite cover of $X$ by affine open sets, and $\sh{F}$ a quasi-coherent $\OO_X$-module.
The complex of sheaves $\sh{C}^\bullet(\fk{U},\sh{F})$ defined by the cover $\fk{U}$ (G, II, 5.2) is then a quasi-coherent $\OO_X$-module.
\end{lem}

\begin{proof}
\label{proof-3.1.4.9}
It follows from the definitions (G, II, 5.2) that $\sh{C}^p(\fk{U},\sh{F})$ is the direct sum of the direct image sheaves of the $\sh{F}|U_{i_0\cdots i_p}$ under the canonical injection $U_{i_0\cdots i_p}\to X$.
The hypothesis that $X$ is a scheme implies that these injections are affine morphisms \sref[I]{1.5.5.6}, hence the $\sh{C}^p(\fk{U},\sh{F})$ are quasi-coherent \sref[II]{2.1.2.6}.
\end{proof}

\begin{prop}[1.4.10]
\label{3.1.4.10}
Let $u:X\to Y$ be a separated and quasi-compact morphism.
For every quasi-coherent $\OO_X$-module $\sh{F}$, the $\RR^q u_*(\sh{F})$ are quasi-coherent $\OO_Y$-modules.
\end{prop}

\begin{proof}
\label{proof-3.1.4.10}
The question is local on $Y$, so we can suppose that $Y$ is affine.
Then $X$ is a finite union of affine open sets $U_i$ ($1\leq i\leq n$); let $\fk{U}$ be the cover $(U_i)$.
In addition, as $Y$ is a scheme, it follows from \sref[I]{1.5.5.10} that for every affine open $V\subset Y$, the canonical injection $u^{-1}(V)\to X$ is an affine morphism; we conclude (Proposition~\sref{3.1.4.1} and (G, II, 5.2)) that we have a canonical isomorphism
\[
  \HH^\bullet(u^{-1}(V),\sh{F})\isoto\HH^\bullet(\Gamma(V,\sh{K}^\bullet)),
  \tag{1.4.10.1}
\]
where we set $\sh{K}^\bullet=u_*(\sh{C}^\bullet(\fk{U},\sh{F}))$.
According to Lemma~\sref{3.1.4.1} and \sref[I]{1.9.2.2}, $\sh{K}^\bullet$ is a quasi-coherent $\OO_Y$-module; moreover, it constitutes a \emph{complex of sheaves} since so is $\sh{C}^\bullet(\fk{U},\sh{F})$.
It then follows from the definition of the cohomology $\sh{H}^\bullet(\sh{K}^\bullet)$ (G, II, 4.1) that the latter consists of quasi-coherent $\OO_Y$-modules \sref[I]{1.4.1.1}.
As (for $V$ affine in $Y$) the functor $\Gamma(V,\sh{G})$ is exact in $\sh{G}$ on the category of quasi-coherent $\OO_Y$-modules, we have (G, II, 4.1)
\[
  \HH^\bullet(\Gamma(V,\sh{K}^\bullet))=\Gamma(V,\sh{H}^\bullet(\sh{K}^\bullet)).
  \tag{1.4.10.2}
\]

Finally, we note that it follows from the definition of the canonical homomorphism
\[
  \HH^\bullet(\fk{U},\sh{F})\to\HH^\bullet(X,\sh{F}),
\]
given in (G, II, 5.2), that if $V'\subset V$ is a second affine open subset of $Y$, then the
diagram
\[
  \xymatrix{
    \HH^\bullet(u^{-1}(V),\sh{F})\ar[r]^\sim\ar[d] &
    \HH^\bullet(\Gamma(V,\sh{K}^\bullet))\ar[d]\\
    \HH^\bullet(u^{-1}(V'),\sh{F})\ar[r]^\sim &
    \HH^\bullet(\Gamma(V',\sh{K}^\bullet))
  }
\]
is commutative.
We thus conclude from the above that the isomorphisms (1.4.10.1) define an isomorphism of $\OO_Y$-modules
\[
  \RR^\bullet u_*(\sh{F})\isoto\sh{H}^\bullet(\sh{K}^\bullet),
  \tag{1.4.10.3}
\]
\oldpage[III]{92}
and as a result, $\RR^\bullet u_*(\sh{F})$ is quasi-coherent.
\end{proof}

In addition, it follows from (1.4.10.3), (1.4.10.2), and (1.4.10.1) that:
\begin{cor}[1.4.11]
\label{3.1.4.11}
Under the hypotheses of Proposition~\sref{3.1.4.10}, for every affine open set $V$ of $Y$, the canonical homomorphism
\[
  \HH^q(u^{-1}(V),\sh{F})\to\Gamma(V,\RR^1 u_*(\sh{F}))
  \tag{1.4.11.1}
\]
is an isomorphism for all $q\geq 0$.
\end{cor}

\begin{cor}[1.4.12]
\label{3.1.4.12}
Suppose that the hypotheses of Proposition~\sref{3.1.4.10} are satisfied, and in addition suppose that $Y$ is quasi-compact.
Then there exists an integer $r>0$ such that for every quasi-coherent $\OO_X$-module $\sh{F}$ and every integer $q>r$, we have $\RR^q u_*(\sh{F})=0$.
If $Y$ is affine, then we can take for $r$ an integer such that there exists a cover of $X$ consisting of $r$ open affine sets.
\end{cor}

\begin{proof}
\label{proof-3.1.4.12}
As we can cover $Y$ by a finite number of affine open sets, we can reduce to proving the second assertion, by virtue of Corollary~\sref{3.1.4.11}.
If $\fk{U}$ is a cover of $X$ by $r$ affine open sets, then we have $\HH^q(\fk{U},\sh{F})=0$ for $q>r$, since the cochains of $C^q(\fk{U},\sh{F})$ are alternating; the assertion thus follows from Proposition~\sref{3.1.4.1}.
\end{proof}

\begin{cor}[1.4.13]
\label{3.1.4.13}
Suppose that the hypotheses of Proposition~\sref{3.1.4.10} are satsified, and in addition suppose that $Y=\Spec(A)$ is affine.
Then for every quasi-coherent $\OO_X$-module $\sh{F}$ and every $f\in A$, we have
\[
  \Gamma(Y_f,\RR^q u_*(\sh{F}))=(\Gamma(Y,\RR^q u_*(\sh{F}))_f
\]
up to canonical isomorphism.
\end{cor}

\begin{proof}
\label{proof-3.1.4.13}
This follows from the fact that $\RR^q u_*(\sh{F})$ is a quasi-coherent $\OO_Y$-module \sref[I]{1.1.3.7}.
\end{proof}

\begin{prop}[1.4.14]
\label{3.1.4.14}
Let $f:X\to Y$ be a separated and quasi-compact morphism, $g:Y\to Z$ an affine morphism.
For every quasi-coherent $\OO_X$-module $\sh{F}$, the canonical homomorphism $\RR^p(g\circ f)_*(\sh{F})\to g_*(\RR^p f_*(\sh{F}))$ (\textbf{0},~12.2.5.2) is bijective for all $p$.
\end{prop}

\begin{proof}
\label{proof-3.1.4.14}
For every affine open subset $W$ of $Z$, $g^{-1}(W)$ is an affine open subset of $Y$.
The homomorphism of presheaves defining the canonical homomorphism
\[
  \RR^p(g\circ f)_*(\sh{F})\to g_*(\RR^p f_*(\sh{F}))
\]
\sref[0]{0.12.2.5} is thus bijective by Corollary~\sref{3.1.4.11}.
\end{proof}

\begin{prop}[1.4.15]
\label{3.1.4.15}
Let $u:X\to Y$ be a separated morphism of finite type, $v:Y'\to Y$ a flat morphism of preschemes \sref[0]{0.6.7.1}; let $u'=u_{(Y')}$, such that we have the commutative diagram
\[
  \xymatrix{
    X\ar[d]_u &
    X'=X_{(Y')}\ar[l]_{v'}\ar[d]^{u'}\\
    Y &
    Y'\ar[l]_{v}.
  }
  \tag{1.4.15.1}
\]
Then for every quasi-coherent $\OO_X$-module $\sh{F}$, $\RR^q u_*'(\sh{F}')$ is canonically isomorphic to $\RR^q u_*(\sh{F})\otimes_{\OO_Y}\OO_{Y'}=v^*(\RR^q u_*(\sh{F}))$ for all $q\geq 0$, where $\sh{F}'={v'}^*(\sh{F})=\sh{F}\otimes_{\OO_Y}\OO_{Y'}$.
\end{prop}

\begin{proof}
\label{proof-3.1.4.15}
\oldpage[III]{93}
The canonical homomorphism $\rho:\sh{F}\to v_*'({v'}^*(\sh{F}))$ (\textbf{0},~4.4.3.2) defines by functoriality a homomorphism
\[
  \RR^q u_*(\sh{F})\to\RR^q u_*(v_*'(\sh{F}')).
  \tag{1.4.15.2}
\]

On the other hand, we have, by setting $w=u\circ v'=v\circ u'$, the canonical homomorphisms (\textbf{0}~,12.2.5.1 and 12.2.5.2)
\[
  \RR^q u_*(v_*'(\sh{F}'))\to\RR^q w_*(\sh{F}')\to v_*(\RR^q u_*'(\sh{F}')).
  \tag{1.4.15.3}
\]

Composing (1.4.15.3) and (1.4.15.2), we have a homomorphism
\[
  \psi:\RR^q u_*(\sh{F})\to v_*(\RR^q u_*'(\sh{F}')),
\]
and finally we obtain a canonical homomorphism (whose definition does not make \emph{any assumptions} on $v$)
\[
  \psi^\sharp:v^*(\RR^q u_*(\sh{F}))\to\RR^q u_*'(\sh{F}'),
  \tag{1.4.15.4}
\]
and it is necessary to prove that it is an isomorphism when $v$ is \emph{flat}.
It is clear that the question is local on $Y$ and $Y'$, and we can therefore suppose that $Y=\Spec(A)$ and $Y'=\Spec(B)$; we will also use the following lemma:
\begin{lem}[1.4.15.5]
\label{3.1.4.15.5}
Let $\vphi:A\to B$ be a ring homomorphism, $Y=\Spec(A)$, $X=\Spec(B)$, $f:X\to Y$ the morphism corresponding to $\vphi$, and $M$ a $B$-module.
For the $\OO_X$-module $\wt{M}$ to be $f$-flat \sref[0]{0.6.7.1}, it is necessary and sufficient for $M$ to be a flat $A$-module.
In particular, for the morphism $f$ to be flat, it is necessary and sufficient for $B$ to be a flat $A$-module.
\end{lem}

This follows from the definition \sref[0]{0.6.7.1} and from \sref[0]{0.6.3.3}, taking into account \sref[I]{1.1.3.4}.

This being so, it follows from (1.4.11.1) and the definitions of the homomorphisms (1.4.15.3) (cf.~\sref[0]{0.12.2.5}) that $\psi$ then corresponds to the composite morphism
\[
  \HH^q(X,\sh{F})\xrightarrow{\rho_q}\HH^q(X,v_*'({v'}^*(\sh{F})))\xrightarrow{\theta_q}\HH^q(X',{v'}^*(v_*'({v'}^*(\sh{F}))))\xrightarrow{\sigma_q}\HH^q(X',{v'}^*(\sh{F})),
\]
where $\rho_q$ and $\sigma_q$ are the homomorphisms in cohomology corresponding to the canonical morphisms $\rho$ and $\sigma:{v'}^*(v_*'(\sh{G}'))\to\sh{G}'$, and $\theta_q$ is the $\vphi$-morphism (\textbf{0},~12.1.3.1) relative to the $\OO_X$-module $v_*'({v'}^*(\sh{F}))$.
But by the functoriality of $\theta_q$, we have the commutative diagram
\[
  \xymatrix{
    \HH^q(X,\sh{F})\ar[rr]^{\rho_q}\ar[dd]_{\theta_q} & &
    \HH^q(X,v_*'({v'}^*(\sh{F})))\ar[dd]^{\theta_q}\\\\
    \HH^q(X',{v'}^*(\sh{F}))\ar[rr]^{{v'}^*(\rho_q)} & &
    \HH^q(X',{v'}^*(v_*'({v'}^*(\sh{F})))),
  }
\]
\oldpage[III]{94}
and as by definition \sref[0]{0.4.4.3} ${v'}^*(\rho)$ is the inverse of $\sigma$, we see that the composite morphism considered above is finally none other than $\theta_q$; as a result, $\psi^\sharp$ is the associated $B$-homomorphism $\HH^q(X,\sh{F})\otimes_A B\to\HH^q(X',\sh{F}')$.
As $u$ is of finite type, $X$ is a finite union of affine open sets $U_i$ ($1\leq i\leq r$); let $\fk{U}$ be the cover $(U_i)$.
As $v$ is an affine morphism, so is $v'$ \sref[II]{2.1.6.5}[iii], and as a result the $U_i'={v'}^{-1}(U_i)$ form an affine open cover $\fk{U}'$ of $X'$.
We then know (\textbf{0},~12.1.4.2) that the diagram
\[
  \xymatrix{
    \HH^q(\fk{U},\sh{F})\ar[r]^{\theta_q}\ar[d] &
    \HH^q(\fk{U}',\sh{F}')\ar[d]\\
    \HH^q(X,\sh{F})\ar[r]^{\theta_q} &
    \HH^q(X',\sh{F}')
  }
\]
is commutative, and the vertical arrows are isomorphisms since $X$ and $X'$ are schemes \sref[I]{1.1.4.1}.
As a result, it suffices to prove that the canonical $\vphi$-morphism $\theta_q:\HH^q(\fk{U},\sh{F})\to\HH^q(\fk{U}',\sh{F}')$ is such that the associated $B$-homomorphism
\[
  \HH^q(\fk{U},\sh{F})\otimes_A B\to\HH^q(\fk{U}',\sh{F}')
\]
is an isomorphism.
For every sequence $\mathbf{s}=(i_k)_{0\leq k\leq p}$ of $p+1$ indices of $[1,r]$, set $U_\mathbf{s}=\bigcap_{k=0}^p U_{i_k}$, $U_\mathbf{s}'=\bigcap_{k=0}^p U_{i_k}'={v'}^{-1}(U_\mathbf{s})$, $M_\mathbf{s}=\Gamma(U_\mathbf{s},\sh{F})$, and $M_\mathbf{s}'=\Gamma(U_\mathbf{s}',\sh{F}')$.
The canonical map $M_\mathbf{s}\otimes_A B\to M_\mathbf{s}'$ is an isomorphism \sref[I]{1.1.6.5}, hence the canonical map $C^p(\fk{U},\sh{F})\otimes_A B\to C^p(\fk{U}',\sh{F}')$ is an isomorphism, by which $d\otimes 1$ identifies with the coboundary map $C^p(\fk{U}',\sh{F}')\to C^{p+1}(\fk{U}',\sh{F}')$.
As $B$ is a \emph{flat} $A$-module, it follows from the definition of the cohomology modules that the canonical map $\HH^q(\fk{U},\sh{F})\otimes_A B\to\HH^q(\fk{U}',\sh{F}')$ is an isomorhism \sref[0]{0.6.1.1}.
This result will later be generalized in \textsection6.
\end{proof}

\begin{cor}[1.4.16]
\label{3.1.4.16}
Let $A$ be a ring, $X$ an $A$-scheme of finite type, and $B$ an $A$-algebra which is faithfully flat over $A$.
For $X$ to be affine, it is necessary and sufficient for $X\otimes_A B$ to be.
\end{cor}

\begin{proof}
\label{proof-3.1.4.16}
The condition is evidently necessary \sref[I]{1.3.2.2}; we show that it is sufficient.
As $X$ is separated over $A$ and the morphism $\Spec(B)\to\Spec(A)$ is flat, it follows from Proposition~\sref{3.1.4.1} that we have
\[
  \HH^i(X\otimes_A B,\sh{F}\otimes_A B)=\HH^i(X,\sh{F})\otimes_A B
  \tag{1.4.16.1}
\]
for every $i\geq 0$ and every quasi-coherent $\OO_X$-module $\sh{F}$.
If $X\otimes_A B$ is affine, the left hand side of (1.4.16.1) is zero for $i=1$, hence so is $\HH^1(X,\sh{F})$ since $B$ is a faithfully flat $A$-module.
As $X$ is a quasi-compact scheme, we finish the proof by Serre's criterion \sref[II]{2.5.2.1}.
\end{proof}

\begin{prop}[1.4.17]
\label{3.1.4.17}
Let $X$ be a prescheme, $0\to\sh{F}\xrightarrow{u}\sh{G}\xrightarrow{v}\sh{H}\to 0$ an exact sequence of $\OO_X$-modules.
If $\sh{F}$ and $\sh{H}$ are quasi-coherent, then so is $\sh{G}$.
\end{prop}

\begin{proof}
\label{proof-3.1.4.17}
\oldpage[III]{95}
The question is local on $X$, so we can suppose that $X=\Spec(A)$ is affine, and it then suffices to prove that $\sh{G}$ satisfies the conditions (d1) and (d2) of \sref[I]{1.1.4.1} (with $V=X$).
The verification of (d2) is immediate, because if $t\in\Gamma(X,\sh{G})$ is zero when restricted to $D(f)$, then so is its image $v(t)\in\Gamma(X,\sh{H})$; therefore there exists an $m>0$ such that $f^m v(t)=v(f^m t)=0$ \sref[I]{1.1.4.1}, and as $\Gamma$ is left exact, $f^m t=u(s)$, where $s\in\Gamma(X,\sh{F})$; as $u$ is injective, the restriction of $s$ to $D(f)$ is zero, hence \sref[I]{1.1.4.1} there exists an integer $n>0$ such that $f^n s=0$; we finally deduce that $f^{m+n}t=u(f^n s)=0$.

We now check (d1); let $t'\in\Gamma(D(f),\sh{G})$; as $\sh{H}$ is quasi-coherent, there exists an integer $m$ such that $f^m v(t')=v(f^m t')$ extends to a section $z\in\Gamma(X,\sh{H})$ \sref[I]{1.1.4.1}.
But in virtue of Theorem~\sref{3.1.3.1} (or (\textbf{I},~5.1.9.2)) applied to the quasi-coherent $\OO_X$-module $\sh{F}$, the sequence $\Gamma(X,\sh{G})\to\Gamma(X,\sh{H})\to 0$ is exact, so there exists $t\in\Gamma(X,\sh{G})$ such that $z=v(t)$; we thus see that $v(f^m t'-t'')=0$, denoting by $t''$ the restriction of $t$ to $D(f)$; thus we have $f^m t'-t''=u(s')$, where $s'\in\Gamma(D(f),\sh{F})$.
But as $\sh{F}$ is quasi-coherent, there exists an integer $n>0$ such that $f^n s'$ extends to a section $s\in\Gamma(X,\sh{F})$; as $f^{m+n}t'-f^n t''=u(f^n s')$, we see that $f^{m+n}t'$ is the restriction to $D(f)$ of a section $f^n t+u(f^n s)\in\Gamma(X,\sh{G})$, which finishes the proof.
\end{proof}

