\section{Finiteness theorem for proper morphisms}
\label{section:finiteness-theorem-for-proper-morphisms}

\subsection{The d\'evissage lemma}
\label{subsection:devissage-lemma}

\begin{defn}[3.1.1]
\label{3.3.1.1}
Let $\C$ be an abelian category.
We say that a subset $\C'$ of the set of objects of $\C$ is \emph{exact} if $0\in\C'$ and if, for every exact sequence $0\to A'\to A\to A''\to 0$ in $\C$ such that two of the objects $A$, $A'$, $A''$ are in $\C'$, then the third is also in $\C'$.
\end{defn}

\begin{thm}[3.1.2]
\label{3.3.1.2}
Let $X$ be a Noetherian prescheme; we denote by $\C$ the abelian category of coherent $\OO_X$-modules.
Let $\C'$ be an exact subset of $\C$, $X'$ a closed subset of the underlying space of $X$.
Suppose that for every closed irreducible subset $Y$ of $X'$, with generic point $y$, there exists a $\OO_X$-module $\sh{G}\in\C'$ such that $\sh{G}_y$ is a $\kres(y)$-vector space of dimension~$1$.
Then every coheren $\OO_X$-module with support contained in $X'$ is in $\C'$ (and in particular, if $X'=X$, then we have $\C'=\C$).
\end{thm}

\begin{proof}
\label{proof-3.3.1.2}
Consider the following property $\textbf{P}(Y)$ of a closed subset $Y$ of $X'$: every coherent $\OO_X$-module with support contained in $Y$ is in $\C'$.
By virtue of the principle of Noetherian induction \sref[0]{0.2.2.2}, we see that we can reduce to showing that \emph{if $Y$ is a closed subset of $X'$ such that the property $\textbf{P}(Y')$ is true for every closed subset $Y'$ of $Y$, distinct from $Y$, then $\textbf{P}(Y)$ is true}.

Therefore, let $\sh{F}\in\C$ have support contained in $Y$, and we show that $\sh{F}\in\C'$.
Denote also by $Y$ the reduced closed subprescheme of $X$ having $Y$ for its underlying space \sref[I]{1.5.2.1}; it is defined by a coherent sheaf of ideals $\sh{J}$ of $\OO_X$.
We know \sref[I]{1.9.3.4} that there exists an integer $n>0$ such that $\sh{J}^n\sh{F}=0$; for $1\leq k\leq n$, we thus have an exact sequence
\[
  0\to\sh{J}^{k-1}\sh{F}/\sh{J}^k\sh{F}\to\sh{F}/\sh{J}^k\sh{F}\to\sh{F}/\sh{J}^{k-1}\sh{F}\to 0
\]
 of coherent $\OO_X$-modules (\sref[I]{1.5.3.6} and \sref[I]{1.5.3.3}); as $\C'$ is exact, we see, by induction on $k$, that it suffices to show that each of the $\sh{F}_k=\sh{J}^{k-1}\sh{F}/\sh{J}^k\sh{F}$ is in $\C'$.
We thus reduce to proving that $\sh{F}\in\C'$ under the additional hypothesis that $\sh{J}\sh{F}=0$; it is equivalent to say that $\sh{F}=j_*(j^*(\sh{F}))$, where $j$ is the canonical injection $Y\to X$.
Let us now consider two cases:
\begin{enumerate}[label=(\alph*)]
  \item $Y$ is \emph{reducible}.
    Let $Y=Y'\cap Y''$, where $Y'$ and $Y''$ are closed subsets of $Y$, distinct from $Y$; denote also by $Y'$ and $Y''$ the reduced closed subpreschemes of $X$ having $Y$ and $Y''$ for their respective underlying spaces, which are defined respectively by sheaves of ideals $\sh{J}'$ and $\sh{J}''$ of $\OO_X$.
    Set $\sh{F}'=\sh{F}\otimes_{\OO_X}(\OO_X/\sh{J}')$ and $\sh{F}''=\sh{F}\otimes_{\OO_X}(\OO_X/\sh{J}'')$.
    The canonical homomorphisms $\sh{F}\to\sh{F}'$ and $\sh{F}\to\sh{F}''$ thus define a homomorphism $u:\sh{F}\to\sh{F}'\oplus\sh{F}''$.
    We show that for every $z\not\in Y'\cap Y''$, the homomorphism $u_z:\sh{F}_z\to\sh{F}_z'\oplus\sh{F}_z''$ is \emph{bijective}.
    Indeed, we have $\sh{J}'\cap\sh{J}''=\sh{J}$, since the question is local and
\oldpage[III]{116}
    the above equality follows from (\sref[I]{1.5.2.1} and \sref[I]{1.1.1.5}); if $z\not\in Y''$, then we have $\sh{J}_z'=\sh{J}_z$, hence $\sh{F}_z'=\sh{F}_z$ and $\sh{F}_z''=0$, which establishes our assertion in this case; we reason similarly for $z\not\in Y'$.
    As a result, the kernel and cokernel of $u$, which are in $\C$ \sref[0]{0.5.3.4}, have their support in $Y'\cap Y''$, and thus is in $\C'$ by hypothesis; for the same reason, $\sh{F}'$ and $\sh{F}''$ are in $\C'$, hence also $\sh{F}'\oplus\sh{F}''$, as $\C'$ is exact.
    The conclusion then follows from the consideration of the two exact sequences
    \[
      0\to\Im u\to\sh{F}'\oplus\sh{F}''\to\Coker u\to 0,
    \]
    \[
      0\to\Ker u\to\sh{F}\to\Im u\to 0,
    \]
    and the hypothesis that $\C'$ is exact.
  \item $Y$ is irreducible, and as a result, the subprescheme $Y$ of $X$ is \emph{integral}.
    If $y$ is its generic point, then we have $(\OO_Y)_y=\kres(y)$, and as $j^*(\sh{F})$ is a coherent $\OO_Y$-module, $\sh{F}_y=(j^*(\sh{F}))_y$ is a $\kres(y)$-vector space of finite dimension~$m$.
    By hypothesis, there is a coherent $\OO_X$-module $\sh{G}\in\C'$ (necessarily of support $Y$) such that $\sh{G}_y$ is a $\kres(y)$-vector space of dimension~$1$.
    As a result, there is a $\kres(y)$-isomorphism $(\sh{G}_y)^m\isoto\sh{F}_y$, which is also an $\OO_Y$-isomorphism, and as $\sh{G}^m$ and $\sh{F}$ are coherent, there exists an open neighborhood $W$ of $y$ in $X$ and an isomorphism $\sh{G}^m|W\isoto\sh{F}|W$ \sref[0]{0.5.2.7}.
    Let $\sh{H}$ be the graph of this isomorphism, which is a coherent $(\OO_X|W)$-submodule of $(\sh{G}^m\oplus\sh{F})|W$, canonically isomorphic to $\sh{G}^m|W$ and to $\sh{F}|W$; there thus exists a coherent $\OO_X$-submodule $\sh{H}_0$ of $\sh{G}^m\oplus\sh{F}$, inducing $\sh{H}$ on $W$ and $0$ on $X\setmin Y$, since $\sh{G}^m$ and $\sh{F}$ have $Y$ for their support~\sref[I]{1.9.4.7}.
    The restrictions $v:\sh{H}_0\to\sh{G}^m$ and $w:\sh{H}_0\to\sh{F}$ of the canonical projections of $\sh{G}^m\oplus\sh{F}$ are then homomorphisms of coherent $\OO_X$-modules, which, on $W$ and on $X\setmin Y$, reduce to isomorphisms; in other words, the kernels and cokernels of $v$ and $w$ have their suppoer in the closed set $Y\setmin(Y\cap W)$, distinct from $Y$.
    They are in $\C'$; on the other hand, we have $\sh{G}^m\in\C'$ since $\sh{G}\in\C'$ and since $\C'$ is exact.
    We conclude successively, by the exactness of $\C'$, that $\sh{H}_0\in\C'$, then $\sh{F}\in\C'$.
Q.E.D.
\end{enumerate}
\end{proof}

\begin{cor}[3.1.3]
\label{3.3.1.3}
Suppose that the exact subset $\C'$ of $\C$ has in addition the property that any coherent direct factor of a coherent $\OO_X$-module $\sh{M}\in\C'$ is also in $\C'$.
In this case, the conclusion of Theorem~\sref{3.3.1.2} is still valid when the condition ``$\sh{G}_y$ is a $\kres(y)$-vector space of dimension~$1$'' is replaced by $\sh{G}_y\neq 0$ (this is equivalent to $\Supp(\sh{G})=Y$).
\end{cor}

\begin{proof}
\label{proof-3.3.1.3}
The reasoning of Theorem~\sref{3.3.1.2} must be modified only in the case~(b); now $\sh{G}_y$ is a $\kres(y)$-vector space of dimension $q>0$, and as a result, we have an $\OO_Y$-isomorphism $(\sh{G}_y)^m\isoto(\sh{F}_y)^q$; the end of the reasoning in Theorem~\sref{3.3.1.2} then proves that $\sh{F}^q\in\C'$, and the additional hypothesis on $\C'$ implies that $\sh{F}\in\C'$.
\end{proof}

\subsection{The finiteness theorem: the case of usual schemes}
\label{subsection:finiteness-theorem-usual-case}

\begin{thm}[3.2.1]
\label{3.3.2.1}
Let $Y$ be a locally Noetherian prescheme, $f:X\to Y$ a proper morphism.
For every coherent $\OO_X$-module $\sh{F}$, the $\OO_Y$-modules $\RR^q f_*(\sh{F})$ are coherent for $q\geq 0$.
\end{thm}

\begin{proof}
\label{proof-3.3.2.1}
The question being local on $Y$, we can suppose $Y$ Noetherian, thus $X$ Noetherian~\sref[I]{1.6.3.7}.
The coherent $\OO_X$-modules $\sh{F}$ for which the conclusion of Theorem~\sref{3.3.2.1} is true forms an \emph{exact} subset $\C'$ of the category $\C$ of coherent $\OO_X$-modules.
\oldpage[III]{117}
Indeed, let $0\to\sh{F}'\to\sh{F}\to\sh{F}''\to 0$ is an exact sequence of coherent $\OO_X$-modules; suppose for example that $\sh{F}'$ and $\sh{F}''$ belong to $\C'$; we have the long exact sequence in cohomology
\[
  \RR^{q-1}f_*(\sh{F}'')\xrightarrow{\partial}\RR^q f_*(\sh{F}')\to\RR^q f_*(\sh{F})\to\RR^q f_*(\sh{F}'')\xrightarrow{\partial}\RR^{q+1}f_*(\sh{F}'),
\]
in which by hypothesis the outer four terms are coherent; it is the same for the middle term $\RR^q f_*(\sh{F})$ by (\sref[0]{0.5.3.4}~and~\sref[0]{0.5.3.3}).
We show in the same way that when $\sh{F}$ and $\sh{F}'$ (resp.~$\sh{F}$ and $\sh{F}''$) are in $\C'$, then so is $\sh{F}''$ (resp.~$\sh{F}'$).
In addition, every coherent \emph{direct factor} $\sh{F}'$ of an $\OO_X$-module $\sh{F}\in\C'$ belongs to $\C'$: indeed, $\RR^q f_*(\sh{F}')$ is then a direct factor of $\RR^q f_*(\sh{F})$~(G,~II,~4.4.4), therefore it is of finite type, and as it is quasi-coherent~\sref{3.1.4.10}, it is coherent, as $Y$ is Noetherian.
By virtue of Corollary~\sref{3.3.1.3}, we reduce to proving that when $X$ is \emph{irreducible} with generic point $x$, there exists \emph{one} coherent $\OO_X$-module $\sh{F}$ belonging to $\C'$, such that $\sh{F}_x\neq 0$: indeed, if this point is established, then it can be applied to any irreducible closed subprescheme $Y$ of $X$, since if $j:Y\to X$ is the canonical injection, then $f\circ j$ is proper~\sref[II]{2.5.4.2}, and if $\sh{G}$ is a coherent $\OO_Y$-module with support $Y$, then $j_*(\sh{G})$ is a coherent $\OO_X$-module such that $\RR^q(f\circ j)_*(\sh{G})=\RR^q f_*(j_*(\sh{G}))$~(G,~II,~4.9.1), therefore we can apply COrollary~\sref{3.3.1.3}.

By virtue of Chow's lemma~\sref[II]{2.5.6.2}, there exists an irreducible prescheme $X'$ an a \emph{projective} and surjective morphism $g:X'\to X$ such that $f\circ g:X'\to Y$ is \emph{projective}.
There exists an ample $\OO_X$-module $\sh{L}$ for $g$~\sref[II]{2.5.3.1}; we apply the fundamental theorem of projective morphisms~\sref{3.2.2.1} to $g:X'\to X$ and with $\sh{L}$: there thus exixts an integer $n$ such that $\sh{F}=g_*(\OO_{X'}(n))$ is a coherent $\OO_X$-module and $\RR^q g_*(\OO_{X'}(n))=0$ for all $q>0$; in addition, as $g^*(g_*(\OO_{X'}(n)))\to\OO_{X'}(n)$ is surjective for $n$ large enough~\sref{3.2.2.1}, we see that we can suppose, at the generic point $x$ of $X$, that we have $\sh{F}_x\neq 0$~\sref[II]{2.3.4.7}.
On the other hand, as $f\circ g$ is projective as $Y$ is Noetherian, the $\RR^q(f\circ g)_*(\OO_{X'}(n))$ are \emph{coherent}~\sref{3.2.2.1}.
This being so, $\RR^\bullet(f\circ g)_*(\OO_{X'}(n))$ is the abutment of a Leray spectral sequence, whose $E_2$-term is given by $E_2^{pq}=\RR^p f_*(\RR^q g_*(\OO_{X'}(n)))$; the above shows that this spectral sequence degenerates, and we then know~\sref[0]{0.11.1.6} that $E_2^{p0}=\RR^p f_*(\sh{F})$ is isomorphic to $\RR^p(f\circ g)_*(\OO_{X'}(n))$, which finishes the proof.
\end{proof}

\begin{cor}[3.2.2]
\label{3.3.2.2}
Let $Y$ be a locally Noetherian prescheme.
For every proper morphism $f:X\to Y$, the direct image under $f$ of any coherent $\OO_X$-module is a coherent $\OO_Y$-module.
\end{cor}

\begin{cor}[3.2.3]
\label{3.3.2.3}
Let $A$ be a Noetherian ring, $X$ a proper scheme over $A$; for every coherent $\OO_X$-module $\sh{F}$, the $\HH^p(X,\sh{F})$ are $A$-modules of finite type, and there exists an integer $r>0$ such that for every coherent $\OO_X$-module $\sh{F}$ and all $p>r$, $\HH^p(X,\sh{F})=0$.
\end{cor}

\begin{proof}
\label{proof-3.3.2.3}
The second assertion has already been proved~\sref{3.1.4.12}; the first follows from the finiteness theorem~\sref{3.3.2.1}, taking into account Corollary~\sref{3.1.4.11}.
\end{proof}

In particular, if $X$ is a \emph{proper algebraic scheme} over a field $k$, then, for every coherent $\OO_X$-module $\sh{F}$, the $\HH^p(X,\sh{F})$ are \emph{finite-dimensional} $k$-vector spaces.

\begin{cor}[3.2.4]
\label{3.3.2.4}
Let $Y$ be a locally Noetherian prescheme, $f:X\to Y$ a morphism of finite type.
For every coherent $\OO_X$-module $\sh{F}$ whose support in proper over $Y$~\sref[II]{2.5.4.10}, the $\OO_Y$-modules $\RR^q f_*(\sh{F})$ are coherent.
\end{cor}

\begin{proof}
\label{proof-3.3.2.4}
\oldpage[III]{118}
The question being local on $Y$, we can suppose $Y$ Noetherian, and it is the same for $X$~\sref[I]{1.6.3.7}.
By hypothesis, every closed subprescheme $Z$ of $X$ whose underlying space is $\Supp(\sh{F})$ is proper over $Y$, in other words, if $j:Z\to X$ is the canonical injection, then $f\circ j:Z\to Y$ is proper.
We can suppose that $Z$ is such that $\sh{F}=j_*(\sh{G})$, where $\sh{G}=j^*(\sh{F})$ is a coherent $\OO_Z$-module~\sref[I]{1.9.3.5}; as we have $\RR^q f_*(\sh{F})=\RR^q(f\circ j)_*(\sh{G})$ by Corollary~\sref{3.1.3.4}, the conclusion follows immediately from Theorem~\sref{3.3.2.1}.
\end{proof}

\subsection{Generalization of the finiteness theorem (usual schemes)}
\label{subsection:finiteness-theorem-generalization-usual}

\begin{prop}[3.3.1]
\label{3.3.3.1}
Let $Y$ be a Noetherian prescheme, $\sh{S}$ a quasi-coherent $\OO_Y$-algebra of finite type, graded in positive degrees, $Y'=\Proj(\sh{S})$, and $g:Y'\to Y$ the structure morphism.
Let $f:X\to Y$ be a proper morphism, $\sh{S}'=f^*(\sh{S})$, $\sh{M}=\bigoplus_{k\in\bb{Z}}\sh{M}_k$ a quasi-coherent graded $\sh{S}'$-module of finite type.
Then the $\RR^p f_*(\sh{M})=\bigoplus_{k\in\bb{Z}}\RR^p f_*(\sh{M}_k)$ are graded $\sh{S}$-modules of finite type for all $p$.
Suppose in addition that the $\sh{S}$ are generated by $\sh{S}_1$; then, for every $p\in\bb{Z}$, there exists an integer $k_p$ such that for all $k\geq k_p$ and all $r>0$, we have
\[
\label{3.3.3.1.1}
  \RR^p f_*(\sh{M}_{k+r})=\sh{S}_r\RR^p f_*(\sh{M}_k).
  \tag{3.3.1.1}
\] 
\end{prop}

\begin{proof}
\label{proof-3.3.3.1}
The first assertion is identical to the statement of Theorem~\sref{3.2.4.1}[i], where we have simply replaced ``projective morphism'' by ``proper morphism''.
In the proof of Theorem~\sref{3.2.4.1}[i], the hypothesis on $f$ was only used to show (with the notation of this proof) that $\RR^p f_*'(\wt{\sh{M}})$ is a coherent $\OO_{Y'}$-module.
With the hypothesis of Proposition~\sref{3.3.3.1}, $f'$ is proper~\sref[II]{2.5.4.2}[iii], so we can resume without change in the proof of Theorem~\sref{3.2.4.1}[i], thanks to the finiteness theorem~\sref{3.3.2.1}.

As for the second assertion, it suffices to remark that there is a finite affine open cover $(U_i)$ of $Y$ such that the restrictions to the $U_i$ of the two sides of~(3.3.1.1) are equal for all $k\geq k_{p,i}$~\sref[II]{2.2.1.6}[ii]; it suffices to take for $k_p$ the largest of the $k_{p,i}$.
\end{proof}

\begin{cor}[3.3.2]
\label{3.3.3.2}
Let $A$ be a Notherian ring, $\fk{m}$ an ideal of $A$, $X$ a proper $A$-scheme, and $\sh{F}$ a coherent $\OO_X$-module.
Then, for all $p\geq 0$, the direct sum $\bigoplus_{k\geq 0}\HH^p(X,\fk{m}^k\sh{F})$ is a module of finite type over the ring $S=\bigoplus_{k\geq 0}\fk{m}^k$; in particular, there exists an integer $k_p\geq 0$ such that for all $k\geq k_p$ and all $r>0$, we have
\[
\label{3.3.3.2.1}
  \HH^p(X,\fk{m}^{k+r}\sh{F})=\fk{m}^r\HH^p(X,\fk{m}^k\sh{F}).
  \tag{3.3.2.1}
\]
\end{cor}

\begin{proof}
\label{proof-3.3.3.2}
It suffices to apply Proposition~\sref{3.3.3.1} with $Y=\Spec(A)$, $\sh{S}=\wt{S}$, $\sh{M}_k=\fk{m}^k\sh{F}$, taking into account Corollary~\sref{3.1.4.11}.
\end{proof}

It should be remembered that the $S$-module structure on $\bigoplus_{k\geq 0}\HH^p(X,\fk{m}^k\sh{F})$ is obtained by considering, for every $a\in\fk{m}^r$, the map $\HH^p(X,\fk{m}^k\sh{F})\to\HH^p(X,\fk{m}^{k+r}\sh{F})$, which comes from the passage to cohomology of the multiplication map $\fk{m}^r\sh{F}\to\fk{m}^{k+r}\sh{F}$ defined by $a$~\sref{3.2.4.1}.

\subsection{Finiteness theorem: the case of formal schemes}
\label{subsection:finiteness-theorem-formal-case}

\oldpage[III]{119}
The results of this section (except the definition~\sref{3.3.4.1}) will not be used in the rest of this chapter.

\begin{env}[3.4.1]
\label{3.3.4.1}
Let $\fk{X}$ and $\fk{S}$ be two locally Noetherian formal preschemes~\sref[I]{1.10.4.2}, $f:\fk{X}\to\fk{S}$ a morphism of formal preschemes.
We say that $f$ is a \emph{proper} morphism if it satisfies the following conditions:
\begin{enumerate}
  \item[1st.] \emph{$f$ is a morphism of finite type~\sref[I]{1.10.13.3}}.
  \item[2nd.] \emph{If $\sh{K}$ is a sheaf of ideals of definition for $\fk{S}$ and if we set $\sh{J}=f^*(\sh{K})\OO_\fk{X}$, $X_0=(\fk{X},\OO_\fk{X}/\sh{J})$, $S_0=(\fk{S},\OO_\fk{S}/\sh{K})$, then the morphism $f_0:X_0\to S_0$ induced by $f$~\sref[I]{1.10.5.6} is proper}.
\end{enumerate}
It is immediate that this definition does not depend on the sheaf of ideals of definition $\sh{K}$ for $\sh{S}$ considered; indeed, if $\sh{K}'$ is a second sheaf of ideals of definition such that $\sh{K}'\subset\sh{K}$, and if we set $\sh{J}'=f^*(\sh{K}')\OO_\fk{X}$, $X_0'=(\fk{X},\OO_\fk{X}/\sh{J}')$, $S_0'=(\sh{S},\OO_\fk{S}/\sh{K}')$, then the morphism $f_0':X_0'\to S_0'$ induced by $f$ is such that the diagram
\[
  \xymatrix{
    X_0\ar[r]^{f_0}\ar[d]_i &
    S_0\ar[d]^j\\
    X_0'\ar[r]^{f_0'} &
    S_0'
  }
\]
is commutative, $i$ and $j$ being surjective immersions; it is equivalent to say that $f_0$ or $f_0'$ is proper, by virtue of~\sref[II]{2.5.4.5}.

We note that, for all $n\geq 0$, if we set $X_n=(\fk{X},\OO_\fk{X}/\sh{J}^{n+1})$, $S_n=(\sh{S},\OO_\sh{S}/\sh{K}^{n+1})$, then the morphism $f_n:X_n\to S_n$ induced by $f$~\sref[I]{1.10.5.6} is proper for all $n$ whenever it is for $n=0$~\sref[II]{2.5.4.6}.

If $g:Y\to Z$ is a proper morphism of locally Noetherian usual preschemes, $Z'$ a closed subset of $Z$, $Y'$ a closed subset of $Y$ such that $g(Y')\subset Z'$, then the extension $\wh{g}:Y_{/Y'}\to Z_{/Z'}$ of $g$ to the completions~\sref[I]{1.10.9.1} is a proper morphism of formal preschemes, as it follows from the definition and from~\sref[II]{2.5.4.5}.

Let $\fk{X}$ and $\fk{S}$ be two locally Noetherian formal preschemes, $f:\fk{X}\to\fk{S}$ a morphism \emph{of finite type}~\sref[I]{1.10.13.3}; the notation being the same as above, we say that a subset $Z$ of the underlying space of $\fk{X}$ is \emph{proper} over $\fk{S}$ (or proper for $f$) if, considered as a subset of $X_0$, $Z$ is \emph{proper over $S_0$}~\sref[II]{2.5.4.10}.
All the properties of proper subsets of usual preschemes stated in~\sref[II]{2.5.4.10} are still true for the proper subsets of formal preschemes, as it follows immediately from the definitions.
\end{env}





