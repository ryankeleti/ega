\section{Chevalley schemes}
\label{section:1.8}

\subsection{Allied local rings}
\label{subsection:1.8.1}

For each local ring $A$, we denote by $\mathfrak{m}(A)$ the maximal ideal of $A$.
\begin{lemma}[8.1.1]
\label{1.8.1.1}
Let $A$ and $B$ be two local rings such that $A\subset B$;
Then the following conditions are equivalent.
\begin{enumerate}
  \item[{\rm(i)}] $\mathfrak{m}(B)\cap A=\mathfrak{m}(A)$.
  \item[{\rm(ii)}] $\mathfrak{m}(A)\subset\mathfrak{m}(B)$.
  \item[{\rm(iii)}] $1$ is not an element of the ideal of $B$ generated by $\mathfrak{m}(A)$.
\end{enumerate}
\end{lemma}

\begin{proof}
\label{proof-1.8.1.1}
It is evident that (i) implies (ii), and (ii) implies (iii);
lastly, if (iii) is true, then $\mathfrak{m}(B)\cap A$ contains $\mathfrak{m}(A)$, and does not contain $1$, and is thus equal to $\mathfrak{m}(A)$.

When the equivalent conditions of \sref{1.8.1.1} are satisfied, we say that $B$ \emph{dominates} $A$;
this is equivalent to saying that the injection $A\to B$ is a \emph{local} homomorphism.
It is clear that, in the set of local subrings of a ring $R$, the relation given by domination is an order.
\end{proof}

\begin{env}[8.1.2]
\label{1.8.1.2}
Now consider a \emph{field} $R$.
For all subrings $A$ of $R$, we denote by $L(A)$ the set of local rings $A_\mathfrak{p}$, where $\mathfrak{p}$ ranges over the prime spectrum of $A$;
such local rings are identified with the subrings of $R$ containing $A$.
Since $\mathfrak{p}=(\mathfrak{p}A_\mathfrak{p})\cap A$, the map $\mathfrak{p}\mapsto A_\mathfrak{p}$ from $\Spec(A)$ to $L(A)$ is bijective.
\end{env}

\begin{lemma}[8.1.3]
\label{1.8.1.3}
Let $R$ be a field, and $A$ a subring of $R$.
For a local subring $M$ of $R$ to dominate a ring $A_\mathfrak{p}\in L(A)$, it is necessary and sufficient that $A\subset M$;
the local ring $A_\mathfrak{p}$ dominated by $M$ is then unique, and corresponds to $\mathfrak{p}=\mathfrak{m}(M)\cap A$.
\end{lemma}

\begin{proof}
\label{proof-1.8.1.3}
If $M$ dominates $A_\mathfrak{p}$, then $\mathfrak{m}(M)\cap A_\mathfrak{p}=\mathfrak{p}A_\mathfrak{p}$, by \sref{1.8.1.1}, whence the uniqueness of $\mathfrak{p}$;
on the other hand, if $A\subset M$, then $\mathfrak{m}M\cap A=\mathfrak{p}$ is prime in $A$, and since $A-\mathfrak{p}\subset M$, we have that $A_\mathfrak{p}\subset M$ and $\mathfrak{p}A_\mathfrak{p}\subset\mathfrak{m}(M)$, so $M$ dominates $A_\mathfrak{p}$.
\end{proof}

\begin{lemma}[8.1.4]
\label{1.8.1.4}
\oldpage[I]{165}
Let $R$ be a field, $M$ and $N$ local subrings of $R$, and $P$ the subring of $R$ generated by $M\cup N$.
Then the following conditions are equivalent.
\begin{enumerate}
  \item[{\rm(i)}] There exists a prime ideal $\mathfrak{p}$ of $P$ such that $\mathfrak{m}(M)=\mathfrak{p}\cap M$ and $\mathfrak{m}(N)=\mathfrak{p}\cap N$.
  \item[{\rm(ii)}] The ideal $\mathfrak{a}$ generated in $P$ by $\mathfrak{m}(M)\cup\mathfrak{m}(N)$ is distinct from $P$.
  \item[{\rm(iii)}] There exists a local subring $Q$ of $R$ simultaneously dominating both $M$ and $N$.
\end{enumerate}
\end{lemma}

\begin{proof}
\label{proof-1.8.1.4}
It is clear that (i) implies (ii);
conversely, if $\mathfrak{a}\neq P$, then $\mathfrak{a}$ is contained in a maximal ideal $\mathfrak{n}$ of $P$, and since $1\not\in\mathfrak{n}$, $\mathfrak{n}\cap M$ contains $\mathfrak{m}(M)$ and is distinct from $M$, so $\mathfrak{n}\cap M=\mathfrak{m}(M)$, and similarly $\mathfrak{n}\cap N=\mathfrak{m}(N)$.
It is clear that, if $Q$ dominates both $M$ and $N$, then $P\subset Q$ and $\mathfrak{m}(M)=\mathfrak{m}(Q)\cap M=(\mathfrak{m}(Q)\cap P)\cap M$, and $\mathfrak{m}(N)=(\mathfrak{m}(Q)\cap P)\cap N$, so (iii) implies (i);
the converse is evident when we take $Q=P_\mathfrak{p}$.
\end{proof}

When the conditions of \sref{1.8.1.4} are satisfied, we say, with C.~Chevalley, that the local rings $M$ and $N$ are \emph{allied}.

\begin{proposition}[8.1.5]
\label{1.8.1.5}
Let $A$ and $B$ be subrings of a field $R$, and $C$ the subring of $R$ generated by $A\cup B$.
Then the following conditions are equivalent.
\begin{enumerate}
  \item[{\rm(i)}] For every local ring $Q$ containing $A$ and $B$, we have that $A_\mathfrak{p}=B_\mathfrak{q}$, where $\mathfrak{p}=\mathfrak{m}(Q)\cap A$ and $\mathfrak{q}=\mathfrak{m}(Q)\cap B$.
  \item[{\rm(ii)}] For all prime ideals $\mathfrak{r}$ of $C$, we have that $A_\mathfrak{p}=B_\mathfrak{q}$, where $\mathfrak{p}=\mathfrak{r}\cap A$ and $\mathfrak{q}=\mathfrak{r}\cap B$.
  \item[{\rm(iii)}] If $M\in L(A)$ and $N\in L(B)$ are allied, then they are identical.
  \item[{\rm(iv)}] $L(A)\cap L(B)=L(C)$.
\end{enumerate}
\end{proposition}

\begin{proof}
\label{proof-1.8.1.5}
Lemmas~\sref{1.8.1.3} and \sref{1.8.1.4} prove that (i) and (iii) are equivalent;
it is clear that (i) implies (ii) by taking $Q=C_\mathfrak{r}$;
conversely, (ii) implies (i), because if $Q$ contains $A\cup B$ then it contains $C$, and if $\mathfrak{r}=\mathfrak{m}(Q)\cap C$, then $\mathfrak{p}=\mathfrak{r}\cap A$ and $\mathfrak{q}=\mathfrak{r}\cap B$, by \sref{1.8.1.3}.
It is immediate that (iv) implies (i), because if $Q$ contains $A\cup B$ then it dominates a local ring $C_\mathfrak{r}\in L(C)$ by \sref{1.8.1.3};
by hypothesis we have that $C_\mathfrak{r}\in L(A)\cap L(B)$, and \sref{1.8.1.1} and \sref{1.8.1.3} prove that $C_\mathfrak{r}=A_\mathfrak{p}=B_\mathfrak{q}$.
We prove finally that (iii) implies (iv).
Let $Q\in L(C)$;
$Q$ dominates some $M\in L(A)$ and some $N\in L(B)$ \sref{1.8.1.3}, so $M$ and $N$, being allied, are identical by hypothesis.
As we then have that $C\subset M$, we know that $M$ dominates some $Q'\in L(C)$ \sref{1.8.1.3}, so $Q$ dominates $Q'$, whence necessarily \sref{1.8.1.3} $Q=Q'=M$, so $Q\in L(A)\cap L(B)$.
Conversely, if $Q\in L(A)\cap L(B)$, then $C\subset Q$, so \sref{1.8.1.3} $Q$ dominates some $Q''\in L(C)\subset L(A)\cap L(B)$;
$Q$ and $Q''$, being allied, are identical, so $Q''=Q\in L(C)$, which completes the proof.
\end{proof}

\subsection{Local rings of an integral scheme}
\label{subsection:1.8.2}

\begin{env}[8.2.1]
\label{1.8.2.1}
Let $X$ be an \emph{integral} prescheme, and $R$ its field of rational functions, identical to the local ring of the generic point $a$ of $X$;
for all $x\in X$, we know that $\sh{O}_x$ can be canonically identified with a subring of $R$ \sref{1.7.1.5}, and for every rational function $f\in R$, the domain of definition $\delta(f)$ of $f$ is the open set of $x\in X$ such that
$f\in\sh{O}_x$.
It thus follows, from \sref{1.7.2.6}, that, for every open $U\subset X$, we have
\[
\label{1.8.2.1.1}
  \Gamma(U,\sh{O}_X)=\bigcap_{x\in U}\sh{O}_x.
  \tag{8.2.1.1}
\]
\end{env}

\begin{proposition}[8.2.2]
\label{1.8.2.2}
\oldpage[I]{166}
Let $X$ be an integral prescheme, and $R$ its field of rational fractions. For $X$ to be a scheme, it is necessary and sufficient for the relation ``$\sh{O}_x$ and $\sh{O}_y$ are allied'' \sref{1.8.1.4}, for points $x$ and $y$ of $X$, to imply that $x=y$.
\end{proposition}

\begin{proof}
\label{proof-1.8.2.2}
We suppose that this condition is satisfied, and aim to show that $X$ is separated.
Let $U$ and $V$ be two distinct affine open subsets of $X$, given by rings $A$ and $B$ (respectively), identified with subrings of $R$;
$U$ (resp. $V$) is thus identified \sref{1.8.1.2} with $L(A)$ (resp. $L(B)$), and the hypotheses tell us \sref{1.8.1.5} that $C$ is the subring of $R$ generated by $A\cup B$, and $W=U\cap V$ is identified with $L(A)\cap L(B)=L(C)$.
Furthermore, we know (\cite{I-1}, p.~5-03, 4~\emph{bis}) that every subring $E$ of $R$ is equal to the intersection of the local rings belonging to $L(E)$;
$C$ is thus identified with the intersection of the rings $\sh{O}_z$ for $z\in W$, or, equivalently \sref{1.8.2.1.1}, with $\Gamma(W,\sh{O}_X)$.
So consider the subprescheme induced by $X$ on $W$;
to the identity morphism $\vphi: C\to\Gamma(W,\sh{O}_X)$ there corresponds \sref{1.2.2.4} a morphism $\Phi=(\psi,\theta):W\to\Spec(C)$;
we will see that $\Phi$ is an \emph{isomorphism} of preschemes, whence $W$ is an \emph{affine} open subset.
The identification of $W$ with $L(C)=\Spec(C)$ shows that $\psi$ is \emph{bijective}.
On the other hand, for all $x\in W$, $\theta_x^\sharp$ is the injection $C_\mathfrak{r}\to\sh{O}_x$, where $\mathfrak{r}=\mathfrak{m}_x\cap C$, and, by definition, $C_\mathfrak{r}$ is identified with $\sh{O}_x$, so $\theta_x^\sharp$ is bijective.
It thus remains to show that $\psi$ is a \emph{homeomorphism}, or, in other words, that for every closed subset $F\subset W$, $\psi(F)$ is closed in
$\Spec(C)$.
But $F$ is the intersection of $W$ with a closed subspace of $U$ of the form $V(\mathfrak{a})$, where $\mathfrak{a}$ is an ideal of $A$;
we will show that $\psi(F)=V(\mathfrak{a}C)$, which proves our claim.
In fact, the prime ideals of $C$ containing $\mathfrak{a}C$ are the prime ideals of $C$ containing $\mathfrak{a}$, and so are the ideals of the form $\psi(x)=\mathfrak{m}_x\cap C$, where $\mathfrak{a}\subset\mathfrak{m}_x$ and $x\in W$;
since $\mathfrak{a}\subset\mathfrak{m}_x$ is equivalent to $x\in V(\mathfrak{a})=W\cap F$ for $x\in U$, we do indeed have that $\psi(F)=V(\mathfrak{a}C)$.

It follows that $X$ is separated, because $U\cap V$ is affine and its ring $C$ is generated by the union $A\cup B$ of the rings of $U$ and $V$ \sref{1.5.5.6}.

Conversely, suppose that $X$ is separated, and let $x$ and $y$ be points of $X$ such that $\sh{O}_x$ and $\sh{O}_y$ are allied.
Let $U$ (resp. $V$) be an affine open subset containing $x$ (resp. $y$), of ring $A$ (resp. $B$);
we then know that $U\cap V$ is affine and that its ring $C$ is generated by $A\cup B$ \sref{1.5.5.6}.
If $\mathfrak{p}=\mathfrak{m}_x\cap A$ and $\mathfrak{q}=\mathfrak{m}_y\cap B$, then $A_\mathfrak{p}=\sh{O}_x$ and $B_\mathfrak{q}=\sh{O}_y$, and since $A_\mathfrak{p}$ and $B_\mathfrak{q}$ are allied, there exists a prime ideal $\mathfrak{r}$ of $C$ such that $\mathfrak{p}=\mathfrak{r}\cap A$ and $\mathfrak{q}=\mathfrak{r}\cap B$ \sref{1.8.1.4}.
But then there exists a point $z\in U\cap V$ such that $\mathfrak{r}=\mathfrak{m}_z\cap C$, since $U\cap V$ is affine, and so evidently $x=z$ and $y=z$, whence $x=y$.
\end{proof}

\begin{corollary}[8.2.3]
\label{1.8.2.3}
Let $X$ be an integral scheme, and $x$ and $y$ points of $X$.
In order for $x\in\overline{\{y\}}$, it is necessary and
sufficient for $\sh{O}_x\subset\sh{O}_y$, or, equivalently, for every rational
function defined at $x$ to also be defined at $y$.
\end{corollary}

\begin{proof}
\label{proof-1.8.2.3}
The condition is evidently necessary because the domain of definition $\delta(f)$ of a rational function $f\in R$ is open;
we now show that it is sufficient.
If $\sh{O}_x\subset\sh{O}_y$, then there exists a prime ideal $\mathfrak{p}$ of $\sh{O}_x$ such that $\sh{O}_y$ dominates $(\sh{O}_x)_\mathfrak{p}$ \sref{1.8.1.3};
but \sref{1.2.4.2} there exists some $z\in X$ such that $x\in\overline{\{z\}}$ and $\sh{O}_z=(\sh{O}_x)_\mathfrak{p}$;
since $\sh{O}_z$ and $\sh{O}_y$ are allied, we have that $z=y$ by \sref{1.8.2.2}, whence the corollary.
\end{proof}

\begin{corollary}[8.2.4]
\label{1.8.2.4}
If $X$ is an integral scheme then the map $x\to\sh{O}_x$ is injective; equivalently, if $x$ and $y$ are two distinct points of $X$, then there exists a rational function defined at one of these points but not the other.
\end{corollary}

\begin{proof}
\label{proof-1.8.2.4}
\oldpage[I]{167}
This follows from \sref{1.8.2.3} and the axiom ($T_0$) \sref{1.2.1.4}.
\end{proof}

\begin{corollary}[8.2.5]
\label{1.8.2.5}
Let $X$ be an integral scheme whose underlying space is Noetherian;
letting $f$ range over the field $R$ of rational functions on $X$, the sets $\delta(f)$ generate the topology of $X$.
\end{corollary}

In fact, every closed subset of $X$ is thus a finite union of irreducible closed subsets, or, in other words, of the form $\overline{\{y\}}$ \sref{1.2.1.5}.
But, if $x\not\in\overline{\{y\}}$, then there exists a rational function $f$ defined at $x$ but not at $y$ \sref{1.8.2.3}, or, equivalently, we have that $x\in\delta(f)$ and that $\delta(f)$ is not contained in $\overline{\{y\}}$.
The complement of $\overline{\{y\}}$ is thus a union of sets of the form $\delta(f)$, and, by virtue of the first remark, every open subset of $X$ is the union of finite intersections of open sets of the form $\delta(f)$.

\begin{env}[8.2.6]
\label{1.8.2.6}
Corollary~\sref{1.8.2.5} shows that the topology of $X$ is entirely characterised by the data of the local rings $(\sh{O}_x)_{x\in X}$ that have $R$ as their field of fractions.
It is equivalent to say that the closed subsets of $X$ are defined in the following manner: given a finite subset $\{x_1,\ldots,x_n\}$ of $X$, consider the set of $y\in X$ such that $\sh{O}_y\subset\sh{O}_{x_i}$ for at least one index $i$, and these sets (over all choices of $\{x_1,\ldots,x_n\}$) are the closed subsets of $X$.
Further, once the topology on $X$ is known, the structure sheaf $\sh{O}_X$ is also determined by the family of the $\sh{O}_x$, since $\Gamma(U,\sh{O}_X)=\bigcap_{x\in U}\sh{O}_x$, by \sref{1.8.2.1.1}.
The family $(\sh{O}_X)_{x\in X}$ thus completely determines the prescheme $X$ when $X$ is an integral scheme whose underlying space is Noetherian.
\end{env}

\begin{proposition}[8.2.7]
\label{1.8.2.7}
Let $X$ and $Y$ be integral schemes, $f:X\to Y$ a dominant morphism \sref{1.2.2.6}, and $K$ (resp.$L$) the field of rational functions on $X$ (resp.$Y$).
Then $L$ can be identified with a subfield of $K$, and, for all $x\in X$, $\sh{O}_{f(x)}$ is the unique local ring of $Y$ dominated by $\sh{O}_x$.
\end{proposition}

\begin{proof}
\label{proof-1.8.2.7}
If $f=(\psi,\theta)$ and $a$ is the generic point of $X$, then $\psi(a)$ is the generic point of $Y$ \sref[0]{0.2.1.5};
$\theta_a^\sharp$ is then a monomorphism of fields, from $L=\sh{O}_{\psi(a)}$ to $K=\sh{O}_a$.
Since every nonempty affine open subset $U$ of $Y$ contains $\psi(a)$, it follows from \sref{1.2.2.4} that the homomorphism $\Gamma(U,\sh{O}_Y)\to\Gamma(\psi^{-1}(U),\sh{O}_X)$ corresponding to $f$ is the restriction of $\theta_a^\sharp$ to $\Gamma(U,\sh{O}_Y)$.
So, for every $x\in X$, $\theta_x^\sharp$ is the restriction to $\sh{O}_{\psi(a)}$ of $\theta_a^\sharp$, and is thus a monomorphism.
We also know that $\theta_x^\sharp$ is a local homomorphism, so, if we identify $L$ with a subfield of $K$ by $\theta_a^\sharp$, $\sh{O}_{\psi(x)}$ is dominated by $\sh{O}_x$ \sref{1.8.1.1};
it is also the only local ring of $Y$ dominated by $\sh{O}_x$, since two local rings of $Y$ that are allied are identical \sref{1.8.2.2}.
\end{proof}

\begin{proposition}[8.2.8]
\label{1.8.2.8}
Let $X$ be an \emph{irreducible} prescheme, $f:X\to Y$ a local immersion (resp. local isomorphism), and suppose further that $f$ is separated. Then $f$ is an immersion (resp. an open immersion).
\end{proposition}

\begin{proof}
\label{proof-1.8.2.8}
Let $f=(\psi,\theta)$;
it suffices, in both cases, to prove that $\psi$ is a \emph{homeomorphism} from $X$ to $\psi(X)$ \sref{1.4.5.3}.
Replacing $f$ by $f_\text{red}$ (\sref{1.5.1.6} and \sref{1.5.5.1}[vi]), we can assume that $X$ and $Y$ are \emph{reduced}.
If $Y'$ is the closed reduced subprescheme of $Y$ that has $\overline{\psi(X)}$ as its underlying space, then $f$ factors as $X\xrightarrow{f'}Y'\xrightarrow{j}Y$, where $j$ is the canonical injection \sref{1.5.2.2}.
It follows from \sref{1.5.5.1}[v] that $f'$ is again a separated morphism; further, $f'$ is again
\oldpage[I]{168}
a local immersion (resp. a local isomorphism), because, since the condition is local on $X$ and $Y$, we can restrict to the case where $f$ is a closed immersion (resp. open immersion), and our claim then follows immediately from \sref{1.4.2.2}.

We can thus suppose that $f$ is a \emph{dominant} morphism, which leads to the fact that $Y$ is, itself, irreducible \sref[0]{0.2.1.5}, and so $X$ and $Y$ are both \emph{integral}.
Further, the condition being local on $Y$, we can suppose that $Y$ is an affine scheme;
since $f$ is separated, $X$ is a scheme \sref{1.5.5.1}[ii], and we are finally at the hypotheses of Proposition~\sref{1.8.2.7}.
Then, for all $x\in X$, $\theta_x^\sharp$ is injective;
but the hypothesis that $f$ is a local immersion implies that $\theta_x^\sharp$ is surjective \sref{1.4.2.2}, so $\theta_x^\sharp$ is bijective, or, equivalently (with the identification of Proposition~\sref{1.8.2.7}) we have that $\sh{O}_{\psi(x)}=\sh{O}_x$.
This implies, by Corollary~\sref{1.8.2.4}, that $\psi$ is an \emph{injective} map, which already proves the proposition when $f$ is a local isomorphism \sref{1.4.5.3}.
When we suppose that $f$ is only a local immersion, for all $x\in X$ there exists an open neighborhood $U$ of $x$ in $X$ and an open neighborhood $V$ of $\psi(x)$ in $Y$ such that the restriction of $\psi$ to $U$ is a homeomorphism from $U$ to a \emph{closed} subset of $V$.
But $U$ is dense in $X$, so $\psi(U)$ is dense in $Y$ and \emph{a fortiori} in $V$, which proves that $\psi(U)=V$;
since $\psi$ is injective, $\psi^{-1}(V)=U$ and this proves that $\psi$ is a homeomorphism from $X$ to $\psi(X)$.
\end{proof}

\subsection{Chevalley schemes}
\label{subsection:1.8.3}

\begin{env}[8.3.1]
\label{1.8.3.1}
Let $X$ be a \emph{Noetherian} integral scheme, and $R$ its field of rational functions;
we denote by $X'$ the set of local subrings $\sh{O}_x\subset R$, where $x$ ranges over all points of $X$.
The set $X'$ satisfies the following three conditions.
\begin{enumerate}
  \item[(Sch.~1)] For all $M\in X'$, $R$ is the field of fractions of $M$.
  \item[(Sch.~2)] There exists a finite set of Noetherian subrings $A_i$ of $R$ such that $X'=\bigcup_i L(A_i)$, and, for all pairs of indices $i$, $j$, the subring $A_{ij}$ of $R$ generated by $A_i\cup A_j$ is an algebra of finite type over $A_i$.
  \item[(Sch.~3)] Any two elements $M$ and $N$ of $X'$ that are allied are identical.
\end{enumerate}
\end{env}

We have seen in \sref{1.8.2.1} that (Sch.~1) is satisfied, and (Sch.~3) follows from \sref{1.8.2.2}.
To show (Sch.~2), it suffices to cover $X$ by a finite number of affine open subsets $U_i$ whose rings are Noetherian, and to take $A_i=\Gamma(U_i,\sh{O}_X)$;
the hypothesis that $X$ is a scheme implies that $U_i\cap U_j$ is affine, and also that $\Gamma(U_i\cap U_j,\sh{O}_X)=A_{ij}$ \sref{1.5.5.6};
further, since the space $U_i$ is Noetherian, the immersion $U_i\cap U_j\to U_i$ is of finite type \sref{1.6.3.5}, so $A_{ij}$ is an $A_i$-algebra of finite type \sref{1.6.3.3}.

\begin{env}[8.3.2]
\label{1.8.3.2}
The structures whose axioms are (Sch.~1), (Sch.~2), and (Sch.~3) generalise ``schemes'', in the sense of C.~Chevalley, who additionally supposes that $R$ is an extension of finite type of a field $K$, and that the $A_i$ are $K$-algebras of finite type (which renders a part of (Sch.~2) useless) \cite{I-1}.
Conversely, if we have such a structure on a set $X'$, then we can associate to it an integral scheme $X$ by using the remarks from \sref{1.8.2.6}: the underlying space of $X$ is equal to $X'$ endowed with the topology defined in \sref{1.8.2.6}, and with the sheaf $\sh{O}_X$ such that $\Gamma(U,\sh{O}_X)=\bigcap_{x\in U}\sh{O}_x$ for all open $U\subset X$, with the evident definition of restriction homomorphisms.
We leave to the reader the task of verifying that we thus obtain an integral scheme, whose local rings are the elements of $X'$;
we will not use this result in what follows.
\end{env}

