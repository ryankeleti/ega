\section{Formal schemes}
\label{section-formal-schemes}

\subsection{Formal affine schemes}
\label{subsection-formal-affine-schemes}

\begin{env}[10.1.1]
\label{1.10.1.1}
Let $A$ be an {\em admissible} topological ring \sref[0]{0.7.1.2}; for each
ideal of definition $\fk{J}$ of $A$, $\Spec(A/\fk{J})$ identifies
with the closed subspace $V(\fk{J})$ of $\Spec(A)$ \sref{1.1.1.11},
the set of {\em open} prime ideals of $A$; this topological space does not depend
\oldpage[I]{181}
on the ideal of definition $\fk{J}$ considered; we denote this topological
space by $\fk{X}$. Let $(\fk{J}_\lambda)$ be a fundamental system
of neighborhoods of $0$ in $A$, consisting of ideals of definition, and for each
$\lambda$, let $\OO_\lambda$ be the structure sheaf of
$\Spec(A/\fk{J}_\lambda)$; this sheaf is induced on $\fk{X}$ by
$\widetilde{A}/\widetilde{\fk{J}_\lambda}$ (which is zero outside of
$\fk{X}$). For $\fk{J}_\mu\subset\fk{J}_\lambda$, the
canonical homomorphism $A/\fk{J}_\mu\to A/\fk{J}_\lambda$ thus
defines a homomorphism $u_{\lambda\mu}:\OO_\mu\to\OO_\lambda$ of sheaves of
rings \sref{1.1.6.1}, and $(\OO_\lambda)$ is a {\em projective system of
sheaves of rings} for these homomorphisms. As the topology of $\fk{X}$
admits a basis consisting of quasi-compact open subsets, we can associate to
each $\OO_\lambda$ a {\em sheaf of pseudo-discrete topological rings}
\sref[0]{0.3.8.1} which have $\OO_\lambda$ as the underlying (without topology)
sheaf of rings, and that we denote also by $\OO_\lambda$; and the $\OO_\lambda$ give again a
{\em projective system of sheaves of topological rings} \sref[0]{0.3.8.2}.
We denote by $\OO_\fk{X}$ the {\em sheaf of topological rings} on $\fk{X}$, the
projective limit of the system $(\OO_\lambda)$; for each {\em quasi-compact} open subset $U$
aof $\fk{X}$, then $\Gamma(U,\OO_\fk{X})$ is a topological ring, the projective
limit of the system of {\em discrete} rings $\Gamma(U,\OO_\lambda)$
\sref[0]{0.3.2.6}.
\end{env}

\begin{defn}[10.1.2]
\label{1.10.1.2}
Given an admissible topological ring $A$, we define the formal spectrum of $A$, and denote
it by $\Spf(A)$, to be the closed subspace $\fk{X}$ of $\Spec(A)$ consisting of the
open prime ideals of $A$. We say that a topologically ringed space is a formal affine scheme
if it is isomorphic to a formal spectrum $\Spf(A)=\fk{X}$ equipped with a sheaf of
topological rings $\OO_\fk{X}$ which is the projective limit of sheaves of
psuedo-discrete topological rings
$(\widetilde{A}/\widetilde{\fk{J}_\lambda})|\fk{X}$, where $\fk{J}_\lambda$
varies over the filtered set of ideals of definition for $A$.
\end{defn}

When we speak of a {\em formal spectrum $\fk{X}=\Spf(A)$} as a formal affine scheme, it will always be as the topologically ringed space $(\fk{X},\OO_\fk{X})$ where $\OO_\fk{X}$ is defined as above.

We note that every \emph{affine scheme} $X=\Spec(A)$ can be considered as a formal affine scheme in only one way, by considering $A$ as a discrete topological ring: the topological rings $\Gamma(U,\OO_X)$ are then discrete whenever $U$ is quasi-compact (but not, in general, when $U$ is an arbitrary open subset of $X$).

\begin{prop}[10.1.3]
\label{1.10.1.3}
If $\fk{X}=\Spf(A)$, where $A$ is an admissible ring, then $\Gamma(\fk{X},\OO_X)$ is topologically isomorphic to $A$.
\end{prop}

\begin{proof}
\label{proof-1.10.1.3}
Indeed, since $\fk{X}$ is closed in $\Spec(A)$, it is quasi-compact, and so $\Gamma(\fk{X},\OO_\fk{X})$ is topologically isomorphic to the projective limit of the discrete rings $\Gamma(\fk{X},\OO_\lambda)$; but $\Gamma(\fk{X},\OO_\lambda)$ is isomorphic to $A/\fk{J}_\lambda$ \sref{1.1.3.7}; since $A$ is separated and complete, it is topologically isomorphic to $\varprojlim A/\fk{J}_\lambda$ \sref[0]{0.7.2.1}, whence the proposition.
\end{proof}

\begin{prop}[10.1.4]
\label{1.10.1.4}
Let $A$ be an admissible ring, $\fk{X}=\Spf(A)$, and, for every $f\in A$, let $\fk{D}(f)=D(f)\cap\fk{X}$; then the topologically ringed space $(\fk{D}(f),\OO_\fk{X}|\fk{D}(f))$ is isomorphic to the formal affine spectrum $\Spf(A_{\{f\}}$ \sref[0]{0.7.6.15}.
\end{prop}

\begin{proof}
\label{proof-1.10.1.4}
For every \unsure{ideal of definition} $\fk{J}$ of $A$, the discrete ring $S_f^{-1}A/ S_f^{-1}\fk{J}$ is canonically identified with $A_{\{f\}}/\fk{J}_{\{f\}}$ \sref[0]{0.7.6.9}, so, by \sref{1.1.2.5} and \sref{1.1.2.6}, the topological space $\Spf(A_{\{f\}})$ is canonically identified with $\fk{D}(f)$.
Further, for every quasi-compact open subset $U$ of $\fk{X}$ contained in $\fk{D}(f)$, $\Gamma(U,\OO_\lambda)$ can be identified with the module of sections of the structure sheaf of $\Spec(S_f^{-1}A/ S_f^{-1}\fk{J}_\lambda)$ over $U$ \sref{1.1.3.6}, so, setting $\fk{N}=\Spf(A_{\{f\}})$, $\Gamma(U,\OO_\fk{X})$ can be identified with the module of sections $\Gamma(U,\OO_\fk{N})$, which proves the proposition.
\end{proof}

\begin{env}[10.1.5]
\label{1.10.1.5}
As a sheaf of rings \emph{without topology}, the structure sheaf $\OO_\fk{X}$ of $\Spf(A)$ admits, for every $x\in\fk{X}$, a fibre which, by \sref{1.10.1.4}, can be identified with the inductive limit $\varinjlim A_{\{f\}}$ for the $f\not\in\fk{j}_x$.
Then, by \sref[0]{0.7.6.17} and \sref[0]{0.7.6.18}:
\end{env}

\begin{prop}[10.1.6]
\label{1.10.1.6}
For every $x\in\fk{X}=\Spf(A)$, the fibre $\OO_x$ is a local ring whose residue field is isomorphic to $\kres(x)=A_x/\fk{j}_xA_x$.
If, further, $A$ is adic and Noetherian, then $\OO_x$ is a Noetherian ring.
\end{prop}

Since $\kres(x)$ is not reduced at $0$, we conclude from this result that the \emph{support} of the ring of sheaves $\OO_\fk{X}$ is \emph{equal to $\fk{X}$}.

\subsection{Morphisms of formal affine schemes}
\label{subsection-morphisms-of-formal-affine-schemes}

\begin{env}[10.2.1]
\label{1.10.2.1}
Let $A$, $B$ be two admissible rings, and let $\vphi:B\to A$ be a {\em continuous} morphism.
The continuous map ${}^a\vphi:\Spec(A)\to\Spec(B)$ \sref{1.1.2.1} then maps $\fk{X}=\Spf(A)$ to $\fk{Y}=\Spf(B)$, since the inverse image under $\vphi$ of an open prime ideal of $A$ is an open prime ideal of $B$.
On the other hand, for all $g\in B$, $\vphi$ defines a continuous homomorphism $\Gamma(\fk{D}(g),\OO_\fk{Y})\to\Gamma(\fk{D}(\vphi(g)),\OO_\fk{X})$ according to \sref{1.10.1.4}, \sref{1.10.1.3}, and \sref[0]{0.7.6.7}; as these homomorphisms satisfy the compatibility conditions for the restrictions corresponding to the change from $g$ to a multiple of $g$, and as $\fk{D}(\vphi(g))={}^a\vphi^{-1}(\fk{D}(g))$, they define a {\em continuous} homomorphisms of sheaves of topological rings $\OO_\fk{Y}\to{}^a\vphi_*(\OO_\fk{X})$ \sref[0]{0.3.2.5}, that we denote by $\widetilde{\vphi}$; we have thus defined a morphism $\Phi=({}^a\vphi,\widetilde{\vphi})$ of topologically ringed spaces $\fk{X}\to\fk{Y}$.
We note that as a homomorphism of sheaves without topology, $\widetilde{\vphi}$ defines a homomorphism $\widetilde{\vphi}_x^\sharp:\OO_{{}^a\vphi(x)}\to\OO_x$ on the stalks, for all $x\in\fk{X}$.
\end{env}

\begin{prop}[10.2.2]
\label{1.10.2.2}
Let $A$, $B$ be two admissible topological rings, and let $\fk{X}=\Spf(A)$, $\fk{Y}=\Spf(B)$.
For a morphism $u=(\psi,\theta):\fk{X}\to\fk{Y}$ of topologically ringed spaces to be of the form $({}^a\vphi,\widetilde{\vphi})$, where $\vphi$ is a continuous ring homomorphism $B\to A$, it is necessary and sufficient that for all $x\in\fk{X}$, $\theta_x^\sharp$ is a local homomorphism $\OO_{\vphi(x)}\to\OO_x$.
\end{prop}

\begin{proof}
\label{proof-1.10.2.2}
The condition is necessary: let $\fk{p}=\fk{j}_x\in\Spf(A)$, and let $\fk{q}=\vphi^{-1}(\fk{j}_x)$; if $g\not\in\fk{q}$, then we have $\vphi(g)\not\in\fk{p}$, and it is immediate that the homomorphism
$B_{\{g\}}\to A_{\{\vphi(g)\}}$ induced by $\vphi$ \sref[0]{0.7.6.7} sends $\fk{q}_{\{g\}}$ to a subset of $\fk{p}_{\{\vphi(g)\}}$; by passing to the inductive limit, we see (taking into account \sref{1.10.1.5} and \sref[0]{0.7.6.17}) that $\widetilde{\vphi}_x^\sharp$ is a local homomorphism.

Conversely, let $(\psi,\theta)$ be a morphism satisying the condition in the statement; according to \sref{1.10.1.3}, $\theta$ defines a continuous ring homomorphism
\[
  \vphi=\Gamma(\theta):B=\Gamma(\fk{Y},\OO_\fk{Y})\longrightarrow\Gamma(\fk{X},\OO_\fk{X})=A.
\]
By virtue of the hypothesis on $\theta$, for the section $\vphi(g)$ of $\OO_\fk{X}$ over $\fk{X}$ to be an invertible germ at the point $x$, it is necessary and sufficient that $g$ is an invertible germ at the point $\psi(x)$.
But according to \sref[0]{0.7.6.17}, the sections of $\OO_\fk{X}$ (resp. $\OO_\fk{Y}$) over $\fk{X}$ (resp. $\OO_\fk{Y}$) whose germ is not invertible at the point $x$ (resp. $\psi(x)$) are exactly the elements of
$\fk{j}_x$
\oldpage[I]{183}
(resp. $\fk{j}_{\psi(x)}$); the above remark thus shows that ${}^a\vphi=\psi$.
Finally, for all $g\in B$ the diagram
\[
  \xymatrix{
    B=\Gamma(\fk{Y},\OO_\fk{Y})\ar[r]^\vphi\ar[d] &
    \Gamma(\fk{X},\OO_\fk{X})=A\ar[d]\\
    B_{\{g\}}=\Gamma(\fk{D}(g),\OO_\fk{Y})\ar[r]^{\Gamma(\theta_{\fk{D}(g)})} &
    \Gamma(\fk{D}(\vphi(g)),\OO_\fk{X})=A_{\{\vphi(g)\}}
  }
\]
is commutative; by the universal property of completed rings of fractions \sref[0]{0.7.6.6}, $\theta_{\fk{D}(g)}$ is equal to $\widetilde{\vphi}_{\fk{D}(g)}$ for all $g\in B$, so \sref[0]{0.3.2.5} we have $\theta=\widetilde{\vphi}$.
\end{proof}

We say that a morphism $(\psi,\theta)$ of topologically ringed spaces satisfying the condition of Proposition \sref{1.10.2.2} is a {\em morphism of formal affine schemes}.
We can say that the functors $\Spf(A)$ in $A$ and $\Gamma(\fk{X},\OO_\fk{X})$ in $\fk{X}$ define an {\em equivalence} between the cateory of admissible rings and the opposite category of formal affine schemes (T, I, 1.2).

\begin{env}[10.2.3]
\label{1.10.2.3}
As a particular case of \sref{1.10.2.2}, note that for $f\in A$, the canonical injection of the formal affine scheme induced by $\fk{X}$ on $\fk{D}(f)$ corresponds to the continuous canonical homomorphism $A\to A_{\{f\}}$.
Under the hypotheses of Proposition \sref{1.10.2.2}, let $h$ be an element of $B$, $g$ an element of $A$, multiple of $\vphi(h)$; we then have $\psi(\fk{D}(g))\subset\fk{D}(h)$; the restriction of $u$ to $\fk{D}(g)$, considered as a morphism from $\fk{D}(g)$ to $\fk{D}(h)$, is the unique morphism $v$ making the diagram
\[
  \xymatrix{
    \fk{D}(g)\ar[r]^v\ar[d] &
    \fk{D}(h)\ar[d]\\
    \fk{X}\ar[r]^u &
    \fk{Y}
  }
\]
commutative.

This morphism corresponds to the unique continuous homomorphism $\vphi':B_{\{h\}}\to A_{\{g\}}$ \sref[0]{0.7.6.7} making the diagram
\[
  \xymatrix{
    A\ar[d] &
    B\ar[l]_\vphi\ar[d]\\
    A_{\{g\}} &
    B_{\{h\}}\ar[l]_{\vphi'}
  }
\]
commutative.
\end{env}

\subsection{Ideals of definition for a formal affine scheme}
\label{subsection-ideals-of-definition-formal}

\begin{env}[10.3.1]
\label{1.10.3.1}
Let $A$ be an admissible ring, $\fk{J}$ an open ideal of $A$, $\fk{X}$ the formal affine scheme $\Spf(A)$.
Let $(\fk{J}_\lambda)$ be the set of the ideals of definition for $A$ contained in $\fk{J}$; then $\widetilde{\fk{J}}/\widetilde{\fk{J}}_\lambda$ is a sheaf of ideals of $\widetilde{A}/\widetilde{\fk{J}}_\lambda$.
Denote by $\fk{J}^\Delta$ the projective limit of the induced sheaves on $\fk{X}$ by $\widetilde{\fk{J}}/\widetilde{\fk{J}}_\lambda$, which identifies with a {\em sheaf of ideals} of $\OO_\fk{X}$ \sref[0]{0.3.2.6}.
For every $f\in A$, $\Gamma(\fk{D}(f),\fk{J}^\Delta)$ is the projective limit of the $S_f^{-1}\fk{J}/S_f^{-1}\fk{J}_\lambda$, in other words, it identifies with the open ideal $\fk{J}_{\{f\}}$ of the ring $A_{\{f\}}$ \sref[0]{0.7.6.9}, and in particular $\Gamma(\fk{X},\fk{J}^\Delta)=\fk{J}$; we conclude (the $\fk{D}(f)$ forming a basis for the topology of $\fk{X}$) that we have
\[
  \fk{J}^\Delta|\fk{D}(f)=(\fk{J}_{\{f\}})^\Delta.
  \tag{10.3.1.1}
\]
\end{env}

