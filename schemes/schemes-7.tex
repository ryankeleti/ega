\section{Rational maps}
\label{section-rational-maps}

\subsection{Rational maps and rational functions}
\label{subsection-rational-maps-and-rational-functions}

\begin{env}[7.1.1]
\label{1.7.1.1}
Let $X$ and $Y$ be two preschemes, $U$ and $V$ two dense open subsets of $X$, and $f$ (resp. $g$) a morphism from $U$ (resp. $V$) to $Y$; we say that $f$ and $g$ are \emph{equivalent} if the agree on a dense open subset of $U\cap V$.
Since a finite intersection of dense open subsets of $X$ is a dense open subset of $X$, it is clear that this relation is an \emph{equivalence relation}.
\end{env}

\begin{defn}[7.1.2]
\label{1.7.1.2}
Given two preschemes $X$ and $Y$, we define a rational map from $X$ to $Y$ to be an equivalence class of morphisms from a dense open subset of $X$ to a dense open subset of $Y$, under the equivalence relation defined in \hyperref[1.7.1.1]{(7.1.1)}.
If $X$ and $Y$ are $S$-preschemes, we say that such a class is a rational $S$-map if there exists a representative of the class that is an $S$-morphism.
We define a rational $S$-section of $X$ to be any rational $S$-map from $S$ to $X$.
We define a rational function on a prescheme $X$ to be any rational $X$-section on the $X$-prescheme $X\otimes_{\bb{Z}}\bb{Z}[T]$ (where $T$ is an indeterminate).
\end{defn}

By an abuse of language, whenever we are discussing only $S$-preschemes, we will say ``rational map'' instead of ``rational $S$-map'' if no confusion may arise.

Let $f$ be a rational map from $X$ to $Y$, and $U$ an open subset of $X$; if $f_1$ and $f_2$ are two morphisms belonging to the class of $f$, defined (respectively) on dense open subsets $V$ and $W$ of $X$, then the restrictions $f_1|(U\cap V)$ and $f_2|(U\cap W)$ agree on $U\cap V\cap W$, which is dense in $U$; the class $f$ of morphisms thus defines a rational map from $U$ to $Y$, called the \emph{restriction of $f$ to $U$}, and denoted by $f|U$.

If, to every $S$-morphism $f\colon X\to Y$, we take the corresponding rational $S$-map to which $f$ belongs, we obtain a canonical map from $\Hom_S(X,Y)$ to the set of rational $S$-maps from $X$ to $Y$.
We denote by $\Gamma_\mathrm{rat}(X/Y)$ the set of rational $Y$-sections on $X$, and we thus have a canonical map $\Gamma(X/Y)\to\Gamma_\mathrm{rat}(X/Y)$.
It is also clear that, if $X$ and $Y$ are $S$-preschemes, then the set of rational $S$-maps from $X$ to $Y$ is canonically identified with $\Gamma_\mathrm{rat}((X\times_S Y)/X)$ \hyperref[1.3.3.14]{(3.3.14)}.

\begin{env}[7.1.3]
\label{1.7.1.3}
It also follows from \hyperref[1.7.1.2]{(7.1.2)} and \hyperref[1.3.3.14]{(3.3.14)} that the rational functions on $X$ are canonically identified with \emph{equivalence classes of sections of the structure sheaf $\OO_X$} over dense open subsets of $X$, where two such sections are equivalent if the agree on some dense open subset of $X$ contained inside the intersection of the subsets on which they are defined.
In particular, it follows that the rational functions on $X$ form a \emph{ring} $R(X)$.
\end{env}

\begin{env}[7.1.4]
\label{1.7.1.4}
When $X$ is an \emph{irreducible} prescheme, every non-empty open subset of $X$ is dense in $X$; so we can say that the non-empty open subsets of $X$ are the \emph{open neighbourhoods of the generic point} $x$ of $X$.
To say that two morphisms from non-empty open subsets of $X$ to $Y$ are equivalent means thus means, in this case, that they have the \emph{same germ} at the point $x$.
Said otherwise, the rational maps (resp. rational $S$-maps) $X\to Y$ are identified with the \emph{germs of morphisms} (resp. \emph{$S$-morphisms}) from non-empty open subsets of $X$ to $Y$ at the generic point $x$ of $X$.
In particular:
\end{env}

\begin{prop}[7.1.5]
\label{1.7.1.5}
If $X$ is an irreducible prescheme, the ring $R(X)$ of rational maps on $X$ is canonically identified with the local ring $\OO_x$ of the generic point $x$ of $X$.
It is a local ring of dimension~0, and so a local Artinian ring when $X$ is Noetherian; it is a field when $X$ is integral, and it is identified with the field of fractions of $A(X)$ when $X$ is further an affine scheme.
\end{prop}

\begin{proof}
\label{proof-1.7.1.5}
Given the above, and the identification of rational functions with sections of $\OO_X$ over a dense open subset of $X$, the first claim is nothing but the definition of the fibre of a sheaf above a point.
For the other claims, we can limit ourselves to the case where $X$ is affine, given by some ring $A$; then $\mathfrak{j}_x$ is the nilradical of $A$, and $\OO_x$ is thus of dimension~0; if $A$ is integral, then $\mathfrak{j}_x=(0)$ and $\OO_x$ is thus the field of fractions of $A$.
Finally, if $A$ is Noetherian, we know (\cite[p.~127, cor.~4]{I-11}) that $\mathfrak{j}_x$ is nilpotent and $\OO_x=A_x$ Artinien.
\end{proof}

If $X$ is \emph{integral}, the ring $\OO_z$ is integral for all $z\in X$; every affine open subset $U$ containing $z$ also contains $x$, and $R(U)$, equal to the field of fractions of $A(U)$, is identified with $R(X)$; we thus conclude that $R(X)$ can be identified also with the \emph{field of fractions of $\OO_z$}: the canonical identification of $\OO_z$ to a subring of $R(X)$ consists of associating, to every germ of a section $s\in\OO_z$, the unique rational function on $X$, \unsure{the} class of a section of $\OO_X$ (necessarily defined on a dense open subset of $X$) having $s$ as its germ at the point $z$.

\begin{env}[7.1.6]
\label{1.7.1.6}
Now suppose that $X$ has a \emph{finite} number of irreducible components $X_i$ ($1\leqslant i\leqslant n$) (which will be the case whenever the underlying space of $X$ is \emph{Noetherian}); let $X'_i$ be open subset of $X$ given by the complement of the $X_j\cap X_i$ for $j\neq i$ inside $X_i$; $X'_i$ is irreducible, its generic point $x_i$ is the generic point of $X_i$, and the $X'_i$ are pairwise disjoint, with their union being dense in $X$ \hyperref[0.2.1.6]{(\textbf{0},~2.1.6)}.
For every dense open subset $U$ of $X$, $U_i=U\cap X'_i$ is a non-empty dense open subset of $X'_i$, with the $U_i$ being pairwise disjoint, and so $U'=\bigcup_i U'_i$ is dense in $X$.
Giving a morphism from $U'$ to $Y$ consists of giving (arbitrarily) a morphism from each of the $U_i$ to $Y$.
Thus:
\end{env}

\begin{prop}[7.1.7]
\label{1.7.1.7}
Let $X$ and $Y$ be two preschemes (\emph{resp.} $S$-preschemes) such that $X$ has a finite number of irreducible components $X_i$, with generic points $x_i$ ($1\leqslant i\leqslant n$).
If $R_i$ is the set of germs of morphisms (\emph{resp.} $S$-morphisms) from open subsets of $X$ to $Y$ at the point $x_i$, then the set of rational maps (\emph{resp.} rational $S$-maps) from $X$ to $Y$ can be identified with the product of the $R_i$ ($1\leqslant i\leqslant n$).
\end{prop}

\begin{cor}[7.1.8]
\label{1.7.1.8}
Let $X$ be a Noetherian prescheme.
The ring of rational functions on $X$ is an Artinian ring, whose local \unsure{components} are the rings $\OO_{x_i}$ of the generic points $x_i$ of the irreducible components of $X$.
\end{cor}

\begin{cor}[7.1.9]
\label{1.7.1.9}
Let $A$ be a Noetherian ring, and $X=\Spec(A)$.
If $Q$ is the complement of the union of minimal prime ideals of $A$, then the ring of rational functions on $X$ can be canonically identified with the ring of fractions $Q^{-1}A$.
\end{cor}

This will follow from the following lemma:

\begin{lem}[7.1.9.1]
\label{1.7.1.9.1}
For an element $f\in A$ to be such that $D(f)$ is dense in $X$, it is necessary and sufficient that $f\in Q$; every dense open subset of $X$ contains an open subset of the form $D(f)$, where $f\in Q$.
\end{lem}

\begin{proof}
\label{proof-1.7.1.9}
Indeed, suppose that the above lemma is true; identifying the ring of sections $\Gamma(D(f),\OO_X)$ with $A_f$ (\hyperref[1.1.3.6]{1.3.6} and \hyperref[1.1.3.7]{1.3.7}), it follows from the fact that the $D(f)$ with $f\in Q$ form a \unsure{cofinal} set in the ordered (under $\supset$) set of dense open subsets of $X$, and from def.~\hyperref[1.7.1.1]{(7.1.1)} that the ring of rational functions on $X$ can be identified with the inductive limit of the $A_f$ for $f\in Q$ (for the preorder relation ``$g$ is a multiple of $f$''), i.e. $Q^{-1}A$ \hyperref[0.1.4.5]{(\textbf{0},~1.4.5)}.
\end{proof}

\begin{proof}
\label{proof-1.7.1.9.1}
To show \hyperref[1.7.1.9.1]{(7.1.9.1)}, 
\end{proof}
