\chapter{The language of schemes}
    
\section*{Summary}
\label{1-schemes.summary}

\begin{tabular}{ll}
  \textsection1. & Affine schemes.\\
  \textsection2. & Preschemes and morphisms of preschemes.\\
  \textsection3. & Products of preschemes.\\
  \textsection4. & Subpreschemes and immersion morphisms.\\
  \textsection5. & Reduced preschemes; separation condition.\\
  \textsection6. & Finiteness conditions.\\
  \textsection7. & Rational maps.\\
  \textsection8. & Chevalley schemes.\\
  \textsection9. & Supplement on quasi-coherent sheaves.\\
  \textsection10. & Formal schemes.
\end{tabular}\\

\oldpage{79}
The \textsection\textsection1--8 do little more than develop a language, which will be used
in the following. It should be noted, however, that in accordance with the general spirit of
this treatise, \textsection\textsection7--8 will be used less than the others, and in a less
essential way; we have moreover spoken of Chevalley's schemes only to make the link with the
language of Chevalley \cite{1} and Nagata \cite{9}. The \textsection9 gives definitions and
results on quasi-coherent sheaves, some of which are no longer limited to a translation into
a ``geometric'' language of known notions of commutative algebra, but are already of a global
nature; they will be indispensable, in the following chapters, for the global study of
morphisms. Finally, \textsection10 introduces a generalization of the notion of schemes,
which will be used as an intermediary in Chapter~III to formulate and prove in a
convenient way the fundamental results of the cohomological study of the proper morphisms;
moreover, it should be noted that the notion of formal schemes seems indispensable to express
certain facts of the ``theory of modules'' (classification problems of algebraic varieties).
The results of \textsection10 will not be used before \textsection3 of Chapter~III and it is
recommended to omit reading until then.
\bigskip

\setcounter{section}{0}
\section{Affine schemes}
\label{1-schemes-1}

\setcounter{subsection}{0}
\subsection{The prime spectrum of a ring}
\label{1-schemes-1.1}

\begin{env}{1.1.1}
\label{env-1.1.1.1}
\oldpage{80}
\emph{Notation}. Let $A$ be a (commutative) ring, $M$ an $A$-module. In
this chapter and the following, we will constantly use the following notations:
\begin{enumerate}[label=--]
  \item $\Spec(A)=$ \emph{set of prime ideals} of $A$, also called the
        \emph{prime spectrum} of $A$; for an $x\in X=\Spec(A)$, it will often be
        convenient to write $\mathfrak{j}_x$ instead of $x$. When $\Spec(A)$ is
        \emph{empty}, it is necessary and sufficient that the ring $A$ is
        reduced to $0$.
  \item $A_x=A_{\mathfrak{j}_x}=$ \emph{(local) ring of fractions $S^{-1}A$},
        where $S=A-\mathfrak{j}_x$.
  \item $\mathfrak{m}_x=\mathfrak{j}_x A_{\mathfrak{j}_x}=$ \emph{maximal ideal of $A$}.
  \item $\kres(x)=A_x/\mathfrak{m}_x=$ \emph{residue field of $A_x$},
        canonically isomorphic to the field of fractions
        of the integral ring $A/\mathfrak{j}_x$, to which it is identified.
  \item $f(x)=$ \emph{class of $f$} mod. $\mathfrak{j}_x$ in
        $A/\mathfrak{j}_x\subset\kres(x)$,
        for $f\in A$ and $x\in X$. We still say that $f(x)$ is the \emph{value}
        of $f$ at a point $x\in\Spec(A)$; the relations $f(x)=0$ and $f\in\mathfrak{j}_x$
        are \emph{equivalent}.
  \item $M_x=M\otimes_A A_x=$ \emph{module of denominators of fractions in
        $A-\mathfrak{j}_x$}.
  \item $\rad(E)=$ \emph{radical of the ideal of $A$ generated by a subset $E$ of $A$}.
  \item $V(E)=$ \emph{set of $x\in X$ such that $E\subset\mathfrak{j}_x$} (or the set of
        $x\in X$ such that $f(x)=0$ for all $f\in E$), for $E\subset A$. So we have
        \[
          \rad(E)=\bigcap_{x\in V(E)}\mathfrak{j}_x.
          \tag{1.1.1.1}
        \]
  \item $V(f)=V(\{f\})$ for $f\in A$.
  \item $D(f)=X-V(f)=$ \emph{set of $x\in X$ where $f(x)\neq 0$}.
\end{enumerate}
\end{env}

\begin{envs}[Proposition]{1.1.2}
\label{env-1.1.1.2}
We have the following properties:
\begin{enumerate}[label=\rm{(\roman*)}]
  \item $V(0)=X$, $V(1)=\emp$.
  \item The relation $E\subset E'$ implies $V(E)\supset V(E')$.
  \item For each family $(E_\lambda)$ of subsets of $A$,
        $V(\bigcup_\lambda E_\lambda)=V(\sum_\lambda E_\lambda)
          =\bigcap_\lambda V(E_\lambda)$.
  \item $V(EE')=V(E)\cup V(E')$.
  \item $V(E)=V(\mathfrak{r}(E))$.
\end{enumerate}
\end{envs}
The properties (i), (ii), (iii) are trivial, and (v) follows from (ii) and from the
formula (1.1.1.1). It is evident that $V(EE')\supset V(E)\cap V(E')$; conversely, if
$x\not\in V(E)$ and $x\not\in V(E')$, there exists $f\in E$ and $f'\in E'$ such that
$f(x)\neq 0$ and $f'(x)\neq 0$ in $\k(x)$, hence $f(x)f'(x)\neq 0$, i.e., $x\not\in V(EE')$,
which proves (iv).

The proposition \sref{env}{1.1.2} shows, among other things, that sets of the form $V(E)$
(where $E$ runs through all the subsets of $A$) are the \emph{closed sets} of a topology on
$X$, which we will call the \emph{spectral topology}\footnote{The introduction of this
topology in algebraic geometry is due to Zariski. So this topology is usually called
the ``Zariski topology'' of $X$.}; unless expressely stated otherwise, always assume
$X=\Spec(A)$ with the spectral topology.

\begin{env}{1.1.3}
\label{env-1.1.1.3}
\oldpage{81}
For each subset $Y$ of $X$, we denote by $\mathfrak{j}(Y)$ the set of $f\in A$ such that
$f(y)=0$ for all $y\in Y$; equivalently, $\mathfrak{j}(Y)$ is the intersection of the prime
ideals $\mathfrak{j}_y$ for $y\in Y$. It is clear that the relation $Y\subset Y'$ implies
that $\mathfrak{j}(Y)\supset\mathfrak{j}(Y')$ and that we have
\[
  \mathfrak{j}\bigg(\bigcup_\lambda Y_\lambda\bigg)=\bigcap_\lambda\mathfrak{j}(Y_\lambda)
  \tag{1.1.3.1}
\]
for each family $(Y_\lambda)$ of subsets of $X$. Finally we have
\[
  \mathfrak{j}(\{x\})=\mathfrak{j}_x.
  \tag{1.1.3.2}
\]
\end{env}

\begin{envs}[Proposition]{1.1.4}
\label{prop-1.1.1.4}
\begin{enumerate}[label=\rm{(\roman*)}]
  \item For each subset $E$ of $A$, we have $\mathfrak{j}(V(E))=\rad(E)$.
  \item For each subset $Y$ of $X$, $V(\mathfrak{j}(Y))=\overline{Y}$, the closure of $Y$
        in $X$.
\end{enumerate}
\end{envs}
(i) is an immeidate consequence of the definitions and (1.1.1.1); on the other hand,
$V(\mathfrak{j}(Y))$ is closed and contains $Y$; conversely, if $Y\subset V(E)$, we have
$f(y)=0$ for $f\in E$ and all $y\in Y$, so $E\subset\mathfrak{j}(Y)$,
$V(E)\supset V(\mathfrak{j}(Y))$, which proves (ii).

\begin{envs}[Corollary]{1.1.5}
\label{cor-1.1.1.5}
The closed subsets of $X=\Spec(A)$ and the ideals of $A$ equal to their radicals (otherwise
the intersection of prime ideals) correspond bijectively by the \unsure{descent} maps
$Y\mapsto\mathfrak{j}(Y)$, $\mathfrak{a}\mapsto V(\mathfrak{a})$; the union $Y_1\cup Y_2$ of
two closed subsets corresponds to $\mathfrak{j}(Y_1)\cap\mathfrak{j}(Y_2)$, and the
intersection of any family $(Y_\lambda)$ of closed subsets corresponds to the radical of the
sum of the $\mathfrak{j}(Y_\lambda)$.
\end{envs}

\begin{envs}[Corollary]{1.1.6}
\label{cor-1.1.1.6}
If $A$ is a Noetherian ring, $X=\Spec(A)$ is a Noetherian space.
\end{envs}

Note that the converse of this corollary is false, as shown
in the example of a non-Noetherian integral ring with a single prime ideal $\neq\{0\}$, for
example a non-discrete valuation ring of rank $1$.

As an example of ring $A$ whose spectrum is not a Noetherian space, one can consider the ring
$\sh{C}(Y)$ of continuous real functions on an infinite compact space $Y$; we know that as a
whole, $Y$ corresponds with the set of maximal ideals of $A$, and it is easy to see that the
topology induced on $Y$ by that of $X=\Spec(A)$ is the initial topology of $Y$. Since $Y$ is
not a Noetherian space, the same is true for $X$.

\begin{envs}[Corollary]{1.1.7}
\label{cor-1.1.1.7}
For each $x\in X$, the closure of $\{x\}$ is the set of $y\in X$ such that
$\mathfrak{j}_x\subset\mathfrak{j}_y$. For $\{x\}$ to be closed, it is necessary and
sufficient that $\mathfrak{j}_x$ is maximal.
\end{envs}

\begin{envs}[Corollary]{1.1.8}
\label{cor-1.1.1.8}
The space $X=\Spec(A)$ is a Kolmogoroff space.
\end{envs}

If $x$, $y$ are two distinct points of $X$, we have either
$\mathfrak{j}_x\not\subset\mathfrak{j}_y$ or $\mathfrak{j}_y\not\subset\mathfrak{j}_x$, so
one of the points $x$, $y$ does not belong to the closure of the other.

\begin{env}{1.1.9}
\label{env-1.1.1.9}
According to proposition (\sref{env}{1.1.2}, (iv)), for two elements $f$, $g$ of $A$, we have
\[
  D(fg)=D(f)\cap D(g).
  \tag{1.1.9.1}
\]
Note also that the relation $D(f)=D(g)$ means, according to proposition
(\sref{prop}{1.1.4}, (i)) and proposition (\sref{env}{1.1.2}, (v)) that $\rad(f)=\rad(g)$, or
that the minimal prime ideals containing $(f)$ and $(g)$ are the same; in particular, when
$f=ug$, where $u$ is invertible.
\end{env}

\begin{envs}[Proposition]{1.1.10}
\label{prop-1.1.1.10}
\oldpage{82}
\begin{enumerate}[label=\rm{(\roman*)}]
  \item When $f$ ranges over $A$, the sets $D(f)$ forms a basis for the topology of $X$.
  \item For each $f\in A$, $D(f)$ is quasi-compact. In particular $X=D(1)$ is quasi-compact.
\end{enumerate}
\end{envs}

(i) Let $U$ be an open set in $X$; by definition, we have $U=X-V(E)$ where $E$ is a subset of
$A$, and $V(E)=\bigcap_{f\in E}V(f)$, hence $U=\bigcup_{f\in E}D(f)$.

(ii) According to (i), it is sufficient to prove that if $(f_\lambda)_{\lambda\in L}$ is a
family of elements of $A$ such that $D(f)\subset\bigcup_{\lambda\in L}D(f_\lambda)$, there
exists a finite subset $J$ of $L$ such that $D(f)\subset\bigcup_{\lambda\in J}D(f_\lambda)$.
Let $\mathfrak{a}$ be the ideal of $A$ generated by the $f_\lambda$; we have by hypothesis
that $V(f)\supset V(\mathfrak{a})$, so $\rad(f)\subset\rad(\mathfrak{a})$; as $f\in\rad(f)$,
there exists an integer $n\geqslant 0$ such that $f^n\in\mathfrak{a}$. But then $f^n$ belongs
to the ideal $\mathfrak{b}$ generated by the finite subfamily $(f_\lambda)_{\lambda\in J}$,
and we have $V(f)=V(f^n)\supset V(\mathfrak{b})=\bigcap_{\lambda\in J}V(f_\lambda)$, that is
to say, $D(f)\supset\bigcup_{\lambda\in J}D(f_\lambda)$.

\begin{envs}[Proposition]{1.1.11}
\label{prop-1.1.1.11}
For each ideal $\mathfrak{a}$ of $A$, $\Spec(A/\mathfrak{a})$ identifies canonically with the
closed subspace $V(\mathfrak{a})$ of $\Spec(A)$.
\end{envs}

Indeed, we know there is a canonical bijective correspondence, respecting the inclusion order
structure, between ideals (resp. prime ideals) of $A/\mathfrak{a}$ and ideals (resp. prime
ideals) of $A$ containing $\mathfrak{a}$.

Recall that the set $\nilrad$ of nilpotent elements of $A$ (the \emph{nilradical} of $A$) is
an ideal equal to $\rad(0)$, the intersection of all the prime ideals of $A$
\pref{env}{1.1.1}.

\begin{envs}[Corollary]{1.1.12}
\label{cor-1.1.1.12}
The topological spaces $\Spec(A)$ and $\Spec(A/\nilrad)$ are canonically homeomorphic.
\end{envs}

\begin{envs}[Proposition]{1.1.13}
\label{prop-1.1.1.13}
For $X=\Spec(A)$ to be irreducible \pref{env}{2.1.1}, it is necessary and sufficient that the
ring $A/\nilrad$ is integral (or, equivalently, that the ideal $\nilrad$ is prime).
\end{envs}

By virtue of corollary \sref{cor}{1.1.12}, we can restrict to the case $\nilrad=0$. If $X$ is
reducible, there exist two distinct closed subsets $Y_1$, $Y_2$ of $X$ such that
$X=Y_1\cup Y_2$, so $\mathfrak{j}(X)=\mathfrak{j}(Y_1)\cap\mathfrak{j}(Y_2)=0$, the ideals
$\mathfrak{j}(Y_1)$ and $\mathfrak{j}(Y_2)$ being distinct from $(0)$ \sref{cor}{1.1.5}; so
$A$ is not an integral. Conversely, if in $A$ there are elements $f\neq 0$, $g\neq 0$ such
that $fg=0$, we have $V(f)\neq X$, $V(g)\neq X$ (since the intersection of the prime ideals
of $A$ is $(0)$), and $X=V(fg)=V(f)\cup V(g)$.

\begin{envs}[Corollary]{1.1.14}
\label{cor-1.1.1.14}
\begin{enumerate}[label=\rm{(\roman*)}]
  \item In the bijective correspondence between closed subsets of $X=\Spec(A)$
        and ideals of $A$ equal to their roots, the irreducible closed subsets
        of $X$ correspond to the prime ideals of $A$. In particular, the irreducible
        components of $X$ correspond to the minimal prime ideals of $A$.
  \item The map $x\mapsto\overline{\{x\}}$ establishes a bijective correspondence
        between $X$ and the set of closed irreducible subsets of $X$
        (\emph{said otherwise,} all closed irreducible subsets of $X$ containing
        only one generic point).
\end{enumerate}
\end{envs}

(i) follows immediately from \sref{prop}{1.1.13} and \sref{prop}{1.1.11}; and for
proving (ii), we can, by virtue of \sref{prop}{1.1.11}, we restrict to the case where
$X$ is irreducible; then, according to the proposition \sref{prop}{1.1.13}, there exists
in $A$ a smaller prime ideal $\nilrad$, which corresponds to the generic point
\oldpage{83}
of $X$; in addition, $X$ does not admit only one generic point since it is a Kolmogoroff
space (\sref{cor}{1.1.8} and \pref{env}{2.1.3}).

\begin{envs}[Proposition]{1.1.15}
\label{prop-1.1.1.15}
If $\mathfrak{J}$ is an ideal in $A$ containing the radical $\nilrad(A)$, the only
neighborhood of $V(\mathfrak{J})$ in $X=\Spec(A)$ is the whole space $X$.
\end{envs}

Indeed, each maximal ideal of $A$ belongs by definition of $V(\mathfrak{J})$.
As each ideal $\mathfrak{a}$ of $A$ is contained in a maximal ideal, we have
$V(\mathfrak{a})\cap V(\mathfrak{J})\neq 0$, hence the proposition.

\subsection{Functorial properties of prime spectra of rings}
\label{1-schemes-1.2}       

\begin{env}{1.2.1}
\label{env-1.1.2.1}
Let $A$, $A'$ be two rings,
\[
  \vphi:A'\longrightarrow A
\]
a homomorphism of rings. For each prime ideal $x=\mathfrak{j}_x\in\Spec(A)=X$, the
ring $A'/\vphi^{-1}(\mathfrak{j}_x)$ is canonically isomorphic to a subring of
$A/\mathfrak{j}_x$, so it is integral, otherwise we say
$\vphi^{-1}(\mathfrak{j}_x)$ is a prime ideal of $A'$; we denote it by
$^a\vphi(x)$, and we have also defined a map
\[
  ^a\vphi:X=\Spec(A)\longrightarrow X'=\Spec(A')
\]
(also denoted $\Spec(\vphi)$) we call this the map \emph{associated} to the
homomorphism $\vphi$. We denote by $\vphi^x$ the injective homomorphism of
$A'/\vphi^{-1}(\mathfrak{j}_x)$ to $A/\mathfrak{j}_x$ induced by $\vphi$ by
passing to quotients, so the canonical extention is a monomorphism of fields
\[
  \vphi^x:\kres(^a\vphi(x))\longrightarrow\kres(x);
\]
for each $f'\in A'$, we therefore have by definition
\[
  \vphi^x(f'(^a\vphi(x)))=(\vphi(f'))(x)\quad(x\in X).
  \tag{1.2.1.1}
\]
\end{env}

\begin{envs}[Proposition]{1.2.2}
\label{prop-1.1.2.2}
\begin{enumerate}[label=\rm{(\roman*)}]
  \item For each subset $E'$ of $A'$, we have
        \[
          ^a\vphi^{-1}(V(E'))=V(\vphi(E')),
          \tag{1.2.2.1}
        \]
        and in particular, for each $f'\in A'$,
        \[
          ^a\vphi^{-1}(D(f'))=D(\vphi(f')).
          \tag{1.2.2.2}
        \]
  \item For each ideal $\mathfrak{a}$ of $A$, we have
        \[
          \overline{^a\vphi(V(\mathfrak{a}))}=V(\vphi^{-1}(\mathfrak{a})).
          \tag{1.2.2.3}
        \]
\end{enumerate}
\end{envs}

Indeed, the relation $^a\vphi(x)\in V(E')$ is by definition equivalent to
$E'\subset\vphi^{-1}(\mathfrak{j}_x)$, so $\vphi(E')\subset\mathfrak{j}_x$, and
finally $x\in V(\vphi(E'))$, hence (i). To prove (ii), we can suppose that
$\mathfrak{a}$ is equal to its radical, since $V(\rad(\mathfrak{a}))=V(\mathfrak{a})$
(\sref{prop}{1.1.2}, (v)) and
$\vphi^{-1}(\rad(\mathfrak{a}))=\rad(\vphi^{-1}(\mathfrak{a}))$; the relation
$f'\in\mathfrak{a}'$ is by definition equivalent to $f'(x')=0$ for each
$x\in{^a\vphi(Y)}$, so, by virtue of the formula (1.2.1.1), it is equivalent as well
to $\vphi(f')(x)=0$ for each $x\in Y$, or $\vphi(f')\in\mathfrak{j}(Y)=\mathfrak{a}$,
since $\mathfrak{a}$ is equal to its radical; hence (ii).

\begin{envs}[Corollary]{1.2.3}
\label{cor-1.1.2.3}
The map $^a\vphi$ is continuous.
\end{envs}

We remark that if $A''$ is a third ring, $\vphi'$ a homomorphism $A''\to A'$, we have
$^a(\vphi'\circ\vphi)= ^a\vphi\circ ^a\vphi'$; this result and the corollary
\sref{cor}{1.2.3} means that $\Spec(A)$ is a \emph{contravariant functor} in $A$, from the
category of rings to that of topological spaces.

\begin{envs}[Corollary]{1.2.4}
\label{cor-1.1.2.4}
\oldpage{84}
Suppose that $\vphi$ is such that for each $f\in A$ written as $f=h\vphi(f')$, where $h$ is
invertible in $A$ (\emph{which is in particular the case when $\vphi$ is} surjective). Then
$^a\vphi$ is a homeomorphism from $X$ to $^a\vphi(X)$.
\end{envs}

We show that for each subset $E\subset A$, there exists a subset $E'$ of $A'$ such that
$V(E)=V(\vphi(E'))$; according to the axiom ($T_0$) \sref{cor}{1.1.8} and the formula
(1.2.2.1), this implies first that $^a\vphi$ is injective, then, according to (1.2.2.1),
that $^a\vphi$ is a homeomorphism. Or, it suffices for each $f\in E$ to have a $f'\in A'$
such that $h\vphi(f')=f$ with $h$ invertible in $A$; the set $E'$ of these elements $f'$
provides the answer.

\begin{env}{1.2.5}
\label{env-1.1.2.5}
In particular, when $\vphi$ is the canonical homomorphism of $A$ to a ring quotient
$A/\mathfrak{a}$, we get \sref{cor}{1.1.12}, and $^a\vphi$ is the \emph{canonical injection}
of $V(\mathfrak{a})$, identifes with $\Spec(A/\mathfrak{a})$, in $X=\Spec(A)$.
\end{env}

Another particular case of \sref{cor}{1.2.4}:
\begin{envs}[Corollary]{1.2.6}
\label{cor-1.1.2.6}
If $S$ is a multiplicative subset of $A$, the spectrum $\Spec(S^{-1}A)$ identifies
canonically (with its topology) with the subspace of $X=\Spec(A)$ consisting of the $x$
such that $\mathfrak{j}_x\cap S=\emp$.
\end{envs}

We know by \pref{env}{1.2.6} that the prime ideals of $S^{-1}A$ are the ideals
$S^{-1}\mathfrak{j}_x$ such that $\mathfrak{j}_x\cap S=\emp$, and that we have
$\mathfrak{j}_x=(i_A^S)^{-1}(S^{-1}\mathfrak{j}_x)$. It suffices to apply the $i_A^S$
with the corollary \sref{cor}{1.2.4}.

\begin{envs}[Corollary]{1.2.7}
\label{cor-1.1.2.7}
For $^a\vphi(X)$ to be dense in $X'$, it is necessary and sufficient that each element
of the kernel $\Ker\vphi$ is nilpotent.
\end{envs}

\subsection{Sheaf associated to a module}
\label{1-schemes-1.3}

\begin{env}{1.3.1}
\label{env-1.1.3.1}
Let $A$ be a commutative ring, $M$ an $A$-module, $f$ an element of $A$, $S_f$ the
multiplicative set of the $f^n$, where $n\geqslant 0$. Recall that we put $A_f=S_f^{-1}A$,
$M_f=S_f^{-1}M$. If $S_f'$ is the saturated multiplicative subset of $A$ consisting of the
$g\in A$ which divide an element of $S_f$, we know that $A_f$ and $M_f$ identify canonically
with ${S_f'}^{-1}A$ and ${S_f'}^{-1}M$ \pref{env}{1.4.3}.
\end{env}

\begin{envs}[Lemma]{1.3.2}
\label{lem-1.1.3.2}
The following conditions are equivalent:
\begin{center}
\rm{(a)} $g\in S_f'$;
\rm{(b)} $S_g'\subset S_f'$;
\rm{(c)} $f\in\rad(g)$;
\rm{(d)} $\rad(f)\subset\rad(g)$;
\rm{(e)} $V(g)\subset V(f)$;
\rm{(f)} $D(f)\subset D(g)$.
\end{center}
\end{envs}
This follows immediately from the definitions and from \sref{cor}{1.1.5}.

\begin{env}{1.3.3}
\label{env-1.1.3.3}
If $D(f)=D(g)$, the lemma (\sref{lem}{1.3.2}, (b)), shows that $M_f=M_g$. More generally, if
$D(f)\supset D(g)$, then $S_f'\subset S_g'$, and we know \pref{env}{1.4.1} that there exists
a canonical functorial homomorphism
\[
  \rho_{g,f}:M_f\longrightarrow M_g,
\]
and if $D(f)\supset D(g)\supset D(h)$, we have \pref{env}{1.4.4}
\[
  \rho_{h,g}\circ\rho_{g,f}=\rho_{h,f}.
  \tag{1.3.3.1}
\]
\end{env}

\oldpage{85}
When $f$ runs over the elements of $A-\mathfrak{j}_x$ (for a given $x$ in $X=\Spec(A)$), the
sets $S_f'$ constitute an increasing filtered set of subsets of $A-\mathfrak{j}_x$, since for
two elements $f$, $g$ of $A-\mathfrak{j}_x$, $S_f'$ and $S_g'$ are contained in $S_{fg}'$; as
the union of the $S_f'$ for $f\in A-\mathfrak{j}_x$ is $A-\mathfrak{j}_x$, we conclude
\pref{env}{1.4.5} that the $A_x$-module $M_x$ identifies canonically with the \emph{inductive
limit} $\varinjlim M_f$, relative to the family of homomorphisms $(\rho_{g,f})$. We denote by
\[
  \rho_x^f:M_f\longrightarrow M_x
\]
the canonical homomorphism for $f\in A-\mathfrak{j}_x$ (or, equivalently, $x\in D(f)$).

\begin{envs}[Definition]{1.3.4}
\label{defn-1.1.3.4}
We define the structure sheaf of the prime spectrum $X=\Spec(A)$ (resp. sheaf associated to
an $A$-module $M$) and denote it by $\widetilde{A}$ or $\OO_X$ (resp. $\widetilde{M}$) as the
sheaf of rings (resp. the $\widetilde{A}$-module) associated to the presheaf
$D(f)\mapsto A_f$ (resp. $D(f)\mapsto M_f$) over the base $\mathfrak{B}$ of $X$ consisting
of the $D(f)$ for $f\in A$ (\sref{prop}{1.1.10}, \pref{env}{3.2.1}, and \pref{env}{3.5.6}).
\end{envs}

We saw \pref{env}{3.2.4} that the stalk $\widetilde{A}_x$ (resp. $\widetilde{M}_x$)
\emph{identifies with the ring $A_x$} (resp. \emph{the $A_x$-module $M_x$}); we denote by
\[
  \theta_f:A_f\longrightarrow\Gamma(D(f),\widetilde{A})
\]
\[
  (\text{resp. }\theta_f:M_f\longrightarrow\Gamma(D(f),\widetilde{M})),
\]
the canonical map, so that for each $x\in D(f)$ and each $\xi\in M_f$, we have
\[
  (\theta_f(\xi))_x=\rho_x^f(\xi).
  \tag{1.3.4.1}
\]

\begin{envs}[Proposition]{1.3.5}
\label{prop-1.1.3.5}
$\widetilde{M}$ is an exact covariant functor in $M$, from the category of $A$-modules to the
category of $\widetilde{A}$-modules.
\end{envs}

Indeed, let $M$, $N$ be two $A$-modules, $u$ a homomorphism $M\to N$; for each $f\in A$,
it canonically assigns to $u$ a homomorphism $u_f$ of the $A_f$-module $M_f$ to the
$A_f$-module $N_f$, and the diagram (for $D(g)\subset D(f)$)
\[
  \xymatrix{
    M_f\ar[r]^{u_f}\ar[d]_{\rho_{g,f}} & N_f\ar[d]^{\rho_{g,f}}\\
    M_g\ar[r]^{u_g} & N_g
  }
\]
is commutative \pref{env}{1.4.1}; these homomorphisms then define a homomorphism of
$\widetilde{A}$-modules $\widetilde{u}:\widetilde{M}\to\widetilde{N}$ \pref{env}{3.2.3}. In
addition, for each $x\in X$, $\widetilde{u}_x$ is the inductive limit of the $u_f$ for
$x\in D(f)$ ($f\in A$), and as a result \pref{env}{1.4.5} if we canonically identify
$\widetilde{M}_x$ and $\widetilde{N}_x$ with $M_x$ and $N_x$ respectively, $\widetilde{u}_x$
identifies with the homomorphism $u_x$ canonically induced by $u$. If $P$ is a third
$A$-module, $v$ a homomorphism $N\to P$ and $w=v\circ u$, it is immediate that
$w_x=v_x\circ u_x$, so $\widetilde{w}=\widetilde{v}\circ\widetilde{u}$. We have therefore
clearly defined a \emph{covariant functor} $\widetilde{M}$ in $M$, from the category of
$A$-modules to that of $\widetilde{A}$-modules. \emph{This functor is exact}, since for each
$x\in X$, $M_x$ is an exact functor in $M$ \pref{env}{1.3.2}; in addition, we have
$\Supp(M)=\Supp(\widetilde{M})$ by the definitions \pref{env}{1.7.1} and \pref{env}{3.1.6}.

\oldpage{86}
\begin{envs}[Proposition]{1.3.6}
\label{prop-1.1.3.6}
For each $f\in A$, the open subset $D(f)\subset X$ canonically identifies with the prime
spectrum $\Spec(A_f)$, and the sheaf $\widetilde{M_f}$ associated to the $A_f$-module
$M_f$ canonically identifies with the restriction $\widetilde{M}|D(f)$.
\end{envs}

The first assertion is a particular case of \sref{cor}{1.2.6}. In addition, for $g\in A$ is
such that $D(g)\subset D(f)$, $M_g$ canonically identifies with the module of fractions of
$M_f$ whose denominators are the powers of the canonical image of $g$ in $A_f$
\pref{env}{1.4.6}. The canonical identification of $\widetilde{M_f}$ with
$\widetilde{M}|D(f)$ then follows from the definitions.

\begin{envs}[Theorem]{1.3.7}
\label{thm-1.1.3.7}
For each $A$-module $M$ and each $f\in A$, the homomorphism
\[
  \theta_f:M_f\longrightarrow\Gamma(D(f),\widetilde{M})
\]
is bijective (\emph{otherwise said, the presheaf $D(f)\mapsto M_f$ is a} sheaf). In
particular, $M$ identifies by $\theta_1$ with $\Gamma(X,\widetilde{M})$.
\end{envs}

We note that, if $M=A$, $\theta_f$ is a homomorphism of structure rings; the theorem
\sref{thm}{1.3.7} implies then that, if we identify the rings $A_f$ and
$\Gamma(D(f),\widetilde{A})$ by means of the $\theta_f$, the homomorphism
$\theta_f:M_f\to\Gamma(D(f),\widetilde{M})$ is an isomorphism of \emph{modules}.

We show first that $\theta_f$ is \emph{injective}. Indeed, if $\xi\in M_f$ is such that
$\theta_f(\xi)=0$, then this means that for each prime ideal $\mathfrak{p}$ of $A_f$, there
exists $h\not\in\mathfrak{p}$ such that $h\xi=0$; as the annihilator of $\xi$ is not
contained in any prime ideal of $A_f$, each $A_f$ integral, so $\xi=0$.

It remains to show that $\theta_f$ is \emph{surjective}; we can reduce to the case where
$f=1$, the general case deduced by ``localizing'' using \sref{prop}{1.3.6}. Now let $s$ be a
section of $\widetilde{M}$ over $X$; according to \sref{defn}{1.3.4} and
(\sref{prop}{1.1.10}, (ii)), there exists a \emph{finite} cover $(D(f_i))_{i\in I}$ of $X$
($f_i\in A$) such that, for each $i\in I$, the restriction $s_i=s|D(f_i)$ is of the form
$\theta_{f_i}(\xi_i)$, where $\xi_i\in M_{f_i}$. If $i$, $j$ are two indices of $I$, if
the restrictions of $s_i$ and $s_j$ to $D(f_i)\cap D(f_j)=D(f_i f_j)$ are equal, it follows
by definition of $M$ that
\[
  \rho_{f_i f_j,f_i}(\xi_i)=\rho_{f_i f_j,f_j}(\xi_j).
  \tag{1.3.7.1}
\]
By definition, we can write, for each $i\in I$, $\xi_i=z_i/f_i^{n_i}$, where $z_i\in M$, and
as $I$ is finite, by multiplying each $z_i$ by a power of $f_i$, we can suppose that all the
$n_i$ are equal to the same $n$. Then, by definition, (1.3.7.1) implies that there exists an
integer $m_{ij}\geqslant 0$ such that $(f_i f_j)^{m_{ij}}(f_j^n z_i-f_i^n z_j)=0$, and we can
moreover suppose that the $m_{ij}$ are equal to the same integer $m$; replacing then the
$z_i$ by $f_i^m z_i$, it remains to prove for the case where $m=0$, otherwise said, the case
where we have
\[
  f_j^n z_i=f_i^n z_j
  \tag{1.3.7.2}
\]
for any $i$, $j$. We have $D(f_i^n)=D(f_i)$, and as the $D(f_i)$ form a cover of $X$,
the ideal generated by the $f_i^n$ is $A$; in other words, there exist elements $g_i\in A$
such that $\sum_i g_i f_i^n=1$. Then consider the element $z=\sum_i g_i z_i$ of $M$; in
(1.3.7.2), we have $f_i^n z=\sum_j g_j f_i^n z_j=(\sum_j g_j f_j^n)z_i=z_i$, where by
definition $\xi_i=z/1$ in $M_{f_i}$. We conclude
\oldpage{87}
that the $s_i$ are the restrictions to $D(f_i)$ of $\theta_1(z)$, which proves that
$s=\theta_1(z)$ and finishes the proof.

\begin{envs}[Corollary]{1.3.8}
\label{cor-1.1.3.8}
Let $M$, $N$ be two $A$-modules; the canonical homomorphism $u\mapsto\widetilde{u}$ from
$\Hom_A(M,N)$ to $\Hom_{\widetilde{A}}(\widetilde{M},\widetilde{N})$ is bijective. In
particular, the relations $M=0$ and $\widetilde{M}=0$ are equivalent.
\end{envs}

Consider the canonical homomorphism $v\mapsto\Gamma(v)$ from
$\Hom_{\widetilde{A}}(\widetilde{M},\widetilde{N})$ to
$\Hom_{\Gamma(\widetilde{A})}(\Gamma(\widetilde{M}),\Gamma(\widetilde{N}))$; the latter
module canonically identifies with $\Hom_A(M,N)$ according to the theorem \sref{thm}{1.3.7}.
It remains to show that $u\mapsto\widetilde{u}$ and $v\mapsto\Gamma(v)$ are inverses of each
other; it is evident that $\Gamma(\widetilde{u})=u$ by definition of $\widetilde{u}$; on the
other hand, if we put $u=\Gamma(v)$ for
$v\in\Hom_{\widetilde{A}}(\widetilde{M},\widetilde{N})$, the map
$w:\Gamma(D(f),\widetilde{M})\to\Gamma(D(f),\widetilde{N})$ canonically induced from $v$
is such that the diagram
\[
  \xymatrix{
    M\ar[r]^u\ar[d]_{\rho_{f,1}} & N\ar[d]^{\rho_{f,1}}\\
    M_f\ar[r]^w & N_f
  }
\]
is commutative; so we have necessarily that $w=u_f$ for all $f\in A$ \pref{env}{1.2.4}, which
shows that $\widetilde{\Gamma(v)}=v$.

\begin{envs}[Corollary]{1.3.9}
\label{cor-1.1.3.9}
\begin{enumerate}[label=\rm{(\roman*)}]
  \item Let $u$ be a homomorphism from an $A$-module $M$ to an $A$-module $N$; then the
        sheaves associated to $\Ker u$, $\Im u$, $\Coker u$, are respectively
        $\Ker\widetilde{u}$, $\Im\widetilde{u}$, $\Coker\widetilde{u}$. In particular, for
        $\widetilde{u}$ to be injective (resp. surjective, bijective), it is necessary and
        sufficient that $u$ is.
  \item If $M$ is an inductive limit (resp. direct sum) of a family of $A$-modules
        $(M_\lambda)$, $\widetilde{M}$ is the inductive limit (resp. direct sum) of the
        family $(\widetilde{M_\lambda})$, via a canonical isomorphism.
\end{enumerate}
\end{envs}
\begin{enumerate}[label=(\roman*)]
  \item If suffices to apply the fact that $\widetilde{M}$ is an exact functor in $M$
        \sref{prop}{1.3.5} to the two exact sequenes of $A$-modules
        \[
          0\longrightarrow\Ker u\longrightarrow M\longrightarrow\Im u\longrightarrow 0,
        \]
        \[
          0\longrightarrow\Im u\longrightarrow N\longrightarrow\Coker u\longrightarrow 0.
        \]
        The second assertion then follows from Theorem \sref{thm}{1.3.7}.
  \item Let $(M_\lambda,g_{\mu\lambda})$ be an inductive system of $A$-modules, with
        inductive limit $M$, and let $g_\lambda$ be the canonical homomorphism
        $M_\lambda\to M$. As we have
        $\widetilde{g_{\nu\mu}}\circ\widetilde{g_{\mu\lambda}}=\widetilde{g_{\nu\lambda}}$
        and $\widetilde{g_\lambda}=\widetilde{g_\mu}\circ\widetilde{g_{\mu\lambda}}$ for
        $\lambda\leqslant\mu\leqslant\nu$,
        $(\widetilde{M_\lambda},\widetilde{g_{\mu\lambda}})$ is an inductive system of
        sheaves on $X$, and if we denote by $h_\lambda$ the canonical homomorphism
        $\widetilde{M_\lambda}\to\varinjlim\widetilde{M_\lambda}$, there is a unique
        homomorphism $v:\varinjlim\widetilde{M_\lambda}\to\widetilde{M}$ such that
        $v\circ h_\lambda=\widetilde{g_\lambda}$. To see that $v$ is bijective, it suffices
        to check, for each $x\in X$, that $v_x$ is a bijection from
        $(\varinjlim\widetilde{M_\lambda})_x$ to $\widetilde{M}_x$; but
        $\widetilde{M}_x=M_x$, and
        \[
          (\varinjlim\widetilde{M_\lambda})_x=\varinjlim(\widetilde{M_\lambda})_x
          =\varinjlim(M_\lambda)_x=M_x\quad\pref{env}{1.3.3}.
        \]
        Conversely, it follows from the definitions that $(\widetilde{g_\lambda})_x$ and
        $(h_\lambda)$ are all equal to the canonical map from $(M_\lambda)_x$ to $M_x$; as
        $(\widetilde{g_\lambda})_x=v_x\circ(h_\lambda)_x$ is the identity.

\oldpage{88}
        Finally, if $M$ is the direct sum of two $A$-modules $N$, $P$, it is immediate that
        $\widetilde{M}=\widetilde{N}\oplus\widetilde{P}$; each direct sum being the inductive
        limit of finite direct sums, the assertions of (ii) are proved.
\end{enumerate}

We note that \sref{cor}{1.3.8} proves that the sheaves isomorphic to the associated sheaves
of $A$-modules forms an \emph{abelian category} (T, I, 1.4).

We also note that it follows from \sref{cor}{1.3.9} that if $M$ is an $A$-module \emph{of
finite type}, that is to say there exists a surjective homomorphism $A^n\to M$, then there
exists a surjective homomorphism $\widetilde{A^n}\to\widetilde{M}$, in other words, the
$\widetilde{A}$-module $\widetilde{M}$ is \emph{generated by a finite family of sections over
$X$} \pref{env}{5.1.1}, and conversely.

\begin{env}{1.3.10}
\label{env-1.1.3.10}
If $N$ is a submodule of an $A$-module $M$, the canonical injection $j:N\to M$ gives by
\sref{cor}{1.3.9} an injective homomorphism $\widetilde{N}\to\widetilde{M}$, which allows us
to canonically identify $\widetilde{N}$ with a \emph{$\widetilde{A}$-submodule} of
$\widetilde{M}$; we will always assume we have made this identification. If $N$ and $P$ are
two submodules of $M$, we then habe
\[
  \widetilde{(N+P)}=\widetilde{N}+\widetilde{P},
  \tag{1.3.10.1}
\]
\[
  \widetilde{(N\cap P)}=\widetilde{N}\cap\widetilde{P},
  \tag{1.3.10.2}
\]
since $N+P$ and $N\cap P$ are respectively the images of the canonical homomorphism
$N\oplus P\to M$, and the kernel of the canonical homomorphism $M\to(M/N)\oplus(M/P)$, and
it suffices to apply \sref{cor}{1.3.9}.

We conclude from (1.3.10.1) and (1.3.10.2) that if $\widetilde{N}=\widetilde{P}$, we have
$N=P$.
\end{env}

\begin{envs}[Corollary]{1.3.11}
\label{cor-1.1.3.11}
On the category of sheaves isomorphic to the associated sheaves of $A$-modules, the functor
$\Gamma$ is exact.
\end{envs}

Indeed, let
$\widetilde{M}\xrightarrow{\widetilde{u}}\widetilde{N}
\xrightarrow{\widetilde{v}}\widetilde{P}$ be an exact sequence corresponding to two
homomorphisms $u:M\to N$, $v:N\to P$ of $A$-modules. If $Q=\Im u$ and $R=\Ker v$, we have
$\widetilde{Q}=\Im\widetilde{u}=\Ker\widetilde{v}=\widetilde{R}$ (Cor. \sref{cor}{1.3.9}),
hence $Q=R$.

\begin{envs}[Corollary]{1.3.12}
\label{cor-1.1.3.12}
Let $M$, $N$ be two $A$-modules.
\begin{enumerate}[label=\rm{(\roman*)}]
  \item The sheaf associated to $M\otimes_A N$ canonically identifies with
        $\widetilde{M}\otimes_{\widetilde{A}}\widetilde{N}$.
  \item If in addition $M$ admits a finite presentation, the sheaf associated to
        $\Hom_A(M,N)$ identifies canonically with
        $\shHom_{\widetilde{A}}(\widetilde{M},\widetilde{N})$.
\end{enumerate}
\end{envs}
\begin{enumerate}[label=(\roman*)]
  \item The sheaf $\sh{F}=\widetilde{M}\otimes_{\widetilde{A}}\widetilde{N}$ is associated to
        the presheaf
        \[
          U\longmapsto\sh{F}(U)
          =\Gamma(U,\widetilde{M})\otimes_{\Gamma(U,\widetilde{A})}\Gamma(U,\widetilde{N}),
        \]
        $U$ varying over the basis (\sref{prop}{1.1.10}, (i)) of $X$ consisting of the
        $D(f)$, where $f\in A$. We have that $\sh{F}(D(f))$ canonically identifies with
        $M_f\otimes_{A_f}N_f$ according to \sref{thm}{1.3.7} and \sref{prop}{1.3.6}.
        Moreover, we have that the $A_f$-module $M_f\otimes_{A_f}N_f$ is canonically
        isomorphic to $(M\otimes_A N)_f$ \pref{env}{1.3.4}, which itself is canonically
        isomorphic to $\Gamma(D(f),(M\otimes_A N)^\sim)$ (\sref{thm}{1.3.7} and
        \sref{prop}{1.3.6}). In addition, we check immediately that the canonical
        isomorphisms
        \[
          \sh{F}(D(f))\isoto\Gamma(D(f),(M\otimes_A N)^\sim)
        \]
\oldpage{89}
        thus obtained satisfy the compatibility conditions with respect to the restriction
        operations \pref{env}{1.4.2}, so they define canonical functorial isomorphism
        \[
          \widetilde{M}\otimes_{\widetilde{A}}\widetilde{N}\isoto(M\otimes_A N)^\sim.
        \]
  \item The sheaf $\sh{G}=\shHom_{\widetilde{A}}(\widetilde{M},\widetilde{N})$ is associated
        to the presheaf
        \[
          U\longmapsto\sh{G}(U)=\Hom_{\widetilde{A}|U}(\widetilde{M}|U,\widetilde{N}|U),
        \]
        $U$ varying over the basis of $X$ consisting of the $D(f)$. We have that
        $\sh{G}(D(f))$ canonically identifies with $\Hom_{A_f}(M_f,N_f)$ (\sref{prop}{1.3.6}
        and \sref{cor}{1.3.8}), which, according to the hypothesis on $M$, canonically
        identifies with $(\Hom_A(M,N))_f$ \pref{env}{1.3.5}. Finally, $(\Hom_A(M,N))_f$
        canonically identifies with $\Gamma(D(f),(\Hom_A(M,N))^\sim)$ (\sref{prop}{1.3.6} and
        \sref{thm}{1.3.7}), and the canonical isomorphisms
        $\sh{G}(D(f))\isoto\Gamma(D(f),(\Hom_A(M,N))^\sim)$ thus obtained are compatible with
        the restriction operations \pref{env}{1.4.2}; they thus define a canonical
        isomorphism
        $\shHom_{\widetilde{A}}(\widetilde{M},\widetilde{N})\isoto(\Hom_A(M,N))^\sim$.
\end{enumerate}

\begin{env}{1.3.13}
\label{env-1.1.3.13}
Now let $B$ be a (commutative) $A$-algebra; this can be interpreted by saying that $B$ is an
$A$-module such that we are given an element $e\in B$ and an $A$-homomorphism
$\vphi:B\otimes_A B\to B$, so that: 1\textsuperscript{st} the diagrams
\[
  \xymatrix{
    B\otimes_A B\otimes_A B\ar[r]^{\vphi\otimes 1}\ar[d]_{1\otimes\vphi} &
    B\otimes_A B\ar[d]^\vphi & &
    B\otimes_A B\ar[rr]^\sigma\ar[rd]_\vphi & &
    B\otimes_A B\ar[dl]^\vphi\\
    B\otimes_A B\ar[r]^\vphi &
    B & & & 
    B
  }
\]
\end{env}  

\subsection{Quasi-coherent sheaves over a prime spectrum}
\label{1-schemes-1.4}

\subsection{Coherent sheaves over a prime spectrum}
\label{1-schemes-1.5}

\subsection{Functorial properties of quasi-coherent sheaves over a prime spectrum}
\label{1-schemes-1.6}

\subsection{Characterisation of morphisms of affine schemes}
\label{1-schemes-1.7}

\section{Preschemes and morphisms of preschemes}
\label{1-schemes-2}

\subsection{Definition of preschemes}
\label{1-schemes-2.1}

\begin{env}{2.1.1}
\label{env-1.2.1.1}
Given a ringed space $(X,\OO_X)$, we say that an open subset
$V$ of $X$ is an \emph{affine open} if the ringed space $(V,\OO_X|V)$ is an
affine scheme \sref{env}{1.7.1}.
\end{env}

\begin{envs}[Definition]{2.1.2}
\label{defn-1.2.1.2}
We define a prescheme to be a ringed space
$(X,\OO_X)$ such that every point of $X$ admits an affine open neighbourhood.
\end{envs}

\begin{envs}[Proposition]{2.1.3}
\label{prop-1.2.1.3}
\oldpage{98}
If $(X,\OO_X)$ is a prescheme then the affine opens give a base for the topology of $X$.
\end{envs}

Indeed, if $V$ is an arbitrary open neighbourhood of $x\in X$, then there
exists by hypothesis an open neighbourhood $W$ of $x$ such that $(W,\OO_X|W)$ is
an affine scheme; we write $A$ to mean its ring. In the space $W$, $V\cap W$ is
an open neighbourhood of $x$; thus there exists $f\in A$ such that $D(f)$ is an
open neighbourhood of $x$ contained inside $V\cap W$ (\sref{prop}{1.1.10}, (i)). The ringed
space $(D(f),\OO_X|D(f))$ is thus an affine scheme, isomorphic to $A_f$
\sref{env}{1.3.6}, whence the proposition.

\begin{envs}[Proposition]{2.1.4}
\label{prop-1.2.1.4}
The underlying space of a prescheme is a Kolmogoroff space.
\end{envs}

Indeed, if $x,y$ are two distinct points of a prescheme $X$ then it is clear
that there exists an open neighbourhood of one of these points that does not
contain the other if $x$ and $y$ are not in the same affine open; and if they
are in the same affine open, this is a result of \sref{cor}{1.1.8}.

\begin{envs}[Proposition]{2.1.5}
\label{prop-1.2.1.5}
If $(X,\OO_X)$ is a prescheme then every closed
irreducible subset of $X$ admits exactly one generic point, and the map
$x\mapsto\overline{\{x\}}$ is thus a bijection of $X$ onto its set of closed
irreducible subsets.
\end{envs}

Indeed, if $Y$ is a closed irreducible subset of $X$ and $y\in Y$, and if $U$
is an open affine neighbourhood of $y$ in $X$, then $U\cap Y$ is everywhere
dense in $Y$, as well as irreducible (\pref{env}{2.1.1} and \pref{env}{2.1.4}); thus by
\sref{cor}{1.1.14}, $U\cap Y$ is the closure in $U$ of a point $x$, and then
$Y\subset\overline{U}$ is the closure of $x$ in $X$. The uniqueness of the
generic point of $X$ is a result of \sref{prop}{2.1.4} and (\pref{env}{2.1.3}).

\begin{env}{2.1.6}
\label{env-1.2.1.6}
If $Y$ is a closed irreducible subset of $X$ and $y$ its
generic point then the local ring $\OO_y$, also written $\OO_{X/Y}$, is called the
\emph{local ring of $X$ along $Y$}, or the \emph{local ring of $Y$ in $X$}.

If $X$ itself is irreducible and $x$ its generic point then we say that
$\OO_x$ is the \emph{ring of rational functions on $X$} (cf. \textsection7).
\end{env}

\begin{envs}[Proposition]{2.1.7}
\label{prop-1.2.1.7}
If $(X,\OO_X)$ is a prescheme then the ringed
space $(U,\OO_X|U)$ is a prescheme for every open subset $U$.
\end{envs}

This follows directly from definition \sref{defn}{2.1.2} and proposition \sref{prop}{2.1.3}.

We say that $(U,\OO_X|U)$ is the prescheme \emph{induced} on $U$ by
$(X,\OO_X)$, or the \emph{restriction} of $(X,\OO_X)$ to $U$.

\begin{env}{2.1.8}
\label{env-1.2.1.8}
We say that a prescheme $(X,\OO_X)$ is \emph{irreducible}
(resp. \emph{connected}) if the underlying space $X$ is irreducible (resp.
connected).  We say that a prescheme is \emph{integral} if it is
\emph{irreducible and reduced} (cf. \sref{env}{5.1.4}).  We say that a prescheme
$(X,\OO_X)$ is \emph{locally integral} if every $x\in X$ admits an open
neighbourhood $U$ such that the prescheme induced on $U$ by $(X,\OO_X)$ is
integral.
\end{env}

\subsection{Morphisms of preschemes}
\label{1-schemes-2.2}

\begin{envs}[Definition]{2.2.1}
\label{defn-1.2.2.1}
Given two preschemes $(X,\OO_X)$, $(Y,\OO_Y)$, we
define a morphism (of preschemes) of $(X,\OO_X)$ to $(Y,\OO_Y)$ to be a morphism
of ringed spaces $(\psi,\theta)$ such that, for all $x\in X$, $\theta_x^\sharp$ is a
local homomorphism $\OO_{\psi(x)}\to\OO_x$.
\end{envs}

\oldpage{99}
By passing to quotients, the map $\OO_{\psi(x)}\to\OO_x$ gives us a monomorphism
$\theta^x:\kres(\psi(x))\to\kres(x)$, which lets us consider $\kres(x)$ as an
\emph{extension} of the field $\kres(\psi(x))$.

\begin{env}{2.2.2}
\label{env-1.2.2.2}
The composition $(\psi'',\theta'')$ of two morphisms
$(\psi,\theta)$, $(\psi',\theta')$ of preschemes is also a morphism of
preschemes, since it is given by the formula
${\theta''}^\sharp=\theta^\sharp\circ\psi^*({\theta'}^\sharp)$ \pref{env}{3.5.5}. From this
we conclude that preschemes form a \emph{category}; using the usual notation, we
will write $\Hom(X,Y)$ to mean the set of morphisms from a prescheme $X$ to a
prescheme $Y$.
\end{env}

\begin{env}[Example]{2.2.3}
\label{exm-1.2.2.3}
If $U$ is an open subset of $X$ then the canonical
injection \pref{env}{4.1.2} of the induced prescheme $(U,\OO_X|U)$ into
$(X,\OO_X)$ is a morphism of preschemes; it is further a \emph{monomorphism} of
ringed spaces (and \emph{a fortiori} a monomorphism of preschemes), which
follows rapidly from \pref{env}{4.1.1}.
\end{env}

\begin{envs}[Proposition]{2.2.4}
\label{prop-1.2.2.4}
Let $(X,\OO_X)$ be a prescheme, and $(S,\OO_S)$ an
affine scheme associated to a ring $A$. Then there exists a canonical bijective
correspondence between morphisms of preschemes from $(X,\OO_X)$ to $(S,\OO_S)$ and
ring homomorphisms from $A$ to $\Gamma(X,\OO_X)$.
\end{envs}

Note first of all that, if $(X,\OO_X)$ and $(Y,\OO_Y)$ are two arbitrary ringed spaces,
a morphism $(\psi,\theta)$ from $(X,\OO_X)$ to $(Y,\OO_Y)$ canonically defines a ring
homomorphism
$\Gamma(\theta):\Gamma(Y,\OO_Y)\to\Gamma(Y,\psi_*(\OO_X))=\Gamma(X,\OO_X)$.
In the case that we consider, everything boils down to showing that any
homomorphism $\vphi:A\to\Gamma(X,\OO_X)$ is of the form $\Gamma(\theta)$
for one and only one $\theta$. Now, by hypothesis there is a covering
$(V_\alpha)$ of $X$ by affine opens; by composing of $\vphi$ with the
restriction homomorphism $\Gamma(X,\OO_X)\to\Gamma(V_\alpha,\OO_X|V_\alpha)$ we
obtain a homomorphism $\vphi_\alpha:A\to\Gamma(V_\alpha,\OO_X|V_\alpha)$
that corresponds to a unique morphism $(\psi_\alpha,\theta_\alpha)$ from the
prescheme $(V_\alpha,\OO_X|V_\alpha)$ to $(S,\OO_S)$, thanks to \sref{env}{1.7.3}.
Furthermore, for every pair of indices $(\alpha,\beta)$, every point of
$V_\alpha\cap V_\beta$ admits an open affine neighbourhood $W$ contained inside
$V_\alpha\cap V_\beta$ \sref{prop}{2.1.3}; it is clear that that, by composing
$\vphi_\alpha$ and $\vphi_\beta$ with the restriction homomorphisms to $W$,
we obtain the same homomorphism $\Gamma(S,\OO_S)\to\Gamma(W,\OO_X|W)$, so, thanks
to the relations $(\theta_\alpha^\sharp)_x=(\vphi_\alpha)_x$ for all $x\in
V_\alpha$ and all $\alpha$ \sref{env}{1.6.1}, the restriction to $W$ of the morphisms
$(\psi_\alpha,\theta_\alpha)$ and $(\psi_\beta,\theta_\beta)$ coincide. From
this we conclude that there is a morphism
$(\psi,\theta):(X,\OO_X)\to(S,\OO_S)$ of ringed spaces, and only one such
that its restriction to each $V_\alpha$ is $(\psi_\alpha,\theta_\alpha)$, and it
is clear that this morphism is a morphism of preschemes and such that
$\Gamma(\theta)=\vphi$.

Let $u:A\to\Gamma(X,\OO_X)$ be a ring homomorphism, and $v=(\psi,\theta)$
the corresponding morphism $(X,\OO_X)\to(S,\OO_S)$. For every $f\in A$ we have
that
\[
  \psi^{-1}(D(f))=X_{u(f)}
  \tag{2.2.4.1}
\]
with the notation of \pref{env}{5.5.2} relative to the locally-free sheaf
$\OO_X$. In fact, it suffices to verify this formula when $X$ itself is affine,
and then this is nothing but (1.2.2.2).

\begin{envs}[Proposition]{2.2.5}
\label{prop-1.2.2.5}
Under the hypotheses of \sref{prop}{2.2.4}, let
$\vphi:A\to\Gamma(X,\OO_X)$ be a ring homomorphism,
$f:(X,\OO_X)\to(S,\OO_S)$ the corresponding morphism of preschemes,
$\sh{G}$ (resp. $\sh{F}$) an $\OO_X$-module (resp. $\OO_S$-module), and
$M=\Gamma(S,\sh{F})$. Then there exists a canonical bijective
\oldpage{100}
correspondence between $f$-morphisms $\sh{F}\to\sh{G}$ \pref{env}{4.4.1} and
$A$-homomorphisms $M\to(\Gamma(X,\sh{G}))_{[\vphi]}$.
\end{envs}

Indeed, reasoning as in \sref{prop}{2.2.4}, we are rapidly led to the case where $X$ is
affine, and the proposition then follows from \sref{env}{1.6.3} and \sref{env}{1.3.8}.

\begin{env}{2.2.6}
\label{env-1.2.2.6}
We say that a morphism of preschemes
$(\psi,\theta):(X,\OO_X)\to(Y,\OO_Y)$ is \emph{open} (resp. \emph{closed})
if, for all open subsets $U$ of $X$ (resp. all closed subsets $F$ of $X$),
$\psi(U)$ is open (resp. $\psi(F)$ is closed) in $Y$. We say that
$(\psi,\theta)$ is \emph{dominant} if $\psi(X)$ is dense in $Y$, and
\emph{surjective} if $\psi$ is surjective. We will point out that these
conditions rely only on the continuous map $\psi$.
\end{env}

\begin{envs}[Proposition]{2.2.7}
\label{prop-1.2.2.7}
Let
\begin{gather*}
  f=(\psi,\theta):(X,\OO_X)\to(Y,\OO_Y);\\
  g=(\psi',\theta'):(Y,\OO_Y)\to(Z,\OO_Z)
\end{gather*}
be two morphisms of
preschemes.
\begin{enumerate}[label=\rm{(\roman*)}]
  \item If $f$ and $g$ are both open (resp. closed, dominant, surjective),
        then so is $g\circ f$.
  \item If $f$ is surjective and $g\circ f$ closed, then $g$ is closed.
  \item If $g\circ f$ is surjective, then $g$ is surjective.
\end{enumerate}
\end{envs}
Claims (i) and (iii) are evident. Write $g\circ f=(\psi'',\theta'')$.
If $F$ is closed in $Y$ then $\psi^{-1}(F)$ is closed in $X$, so
$\psi''(\psi^{-1}(F))$ is closed in $Z$; but since $\psi$ is surjective,
$\psi(\psi^{-1}(F))=F$, so $\psi''(\psi^{-1}(F))=\psi'(F)$, which proves (ii).

\begin{envs}[Proposition]{2.2.8}
\label{prop-1.2.2.8}
Let $f=(\psi,\theta)$ be a morphism
$(X,\OO_X)\to(Y,\OO_Y)$, and $(U_\alpha)$ an open cover of $Y$. For $f$ to be
open (resp. closed, surjective, dominant), it is necessary and sufficient that
its restriction to every induced prescheme
$(\psi^{-1}(U_\alpha),\OO_X|\psi^{-1}(U_\alpha))$, considered as a morphism of
preschemes from this induced prescheme to the induced prescheme
$(U_\alpha,\OO_Y|U_\alpha)$ is open (resp. closed, surjective, dominant).
\end{envs}

The proposition follows immediately from the definitions, taking into
account the fact that a subset $F$ of $Y$ is closed (resp. open, dense) in $Y$
if and only if each of the $F\cap U_\alpha$ are closed (resp. open, dense) in
$U_\alpha$.

\begin{env}{2.2.9}
\label{env-1.2.2.9}
Let $(X,\OO_X)$ and $(Y,\OO_Y)$ be two preschemes; suppose that
$X$ (resp. $Y$) has a finite number of irreducible components $X_i$ (resp.
$Y_i$) ($1\leqslant i\leqslant n$); let $\xi_i$ (resp. $\eta_i$) be the generic
point of $X_i$ (resp. $Y_i$) \sref{env}{2.1.5}. We say that a morphism
\[
  f=(\psi,\theta):(X,\OO_X)\to(Y,\OO_Y)
\]
is \emph{birational} if, for all $i$, $\psi^{-1}(\eta_i)=\{\xi_i\}$ and
$\theta_{\xi_i}^\sharp:\OO_{\eta_i}\to\OO_{\xi_i}$ is an \emph{isomorphism}. It
is clear that a birational morphism is dominant \pref{env}{2.1.8}, and so is
surjective if it is also closed.
\end{env}

\begin{env}[Notational conventions]{2.2.10}
\label{rmk-1.2.2.10}
In all that follows, when there is
no risk of confusion, we \emph{suppress} the structure sheaf (resp. the morphism
of structure sheaves) from the notation of a prescheme (resp. morphism of
preschemes). If $U$ is an open subset of the underlying space $X$ of a
prescheme, then whenever we speak of $U$ as a prescheme we always mean the
induced prescheme on $U$.
\end{env}

\subsection{Gluing preschemes}
\label{1-schemes-2.3}

\begin{env}{2.3.1}
\label{env-1.2.3.1}
\oldpage{101}
It follows from definition \sref{defn}{2.1.2} that every ringed space obtained by
\emph{gluing} preschemes \pref{env}{4.1.6} is again a prescheme. In particular, although
every prescheme admits, by definition, a cover by affine open sets, we see that every
prescheme can actually be obtained by \emph{gluing affine schemes}.
\end{env}

\begin{env}[Example]{2.3.2}
\label{exm-1.2.3.2}
Let $K$ be a field, and $B=K[s]$, $C=K[t]$ be two polynomial rings in one indeterminate over
$K$, and define $X_1=\Spec(B)$, $X_2=\Spec(C)$, which are two isomorphic affine schemes. In
$X_1$ (resp. $X_2$), let $U_{12}$ (resp. $U_{21}$) be the affine open $D(s)$ (resp. $D(t)$)
where the ring $B_s$ (resp. $C_t$) is formed of rational fractions of the form $f(s)/s^m$
(resp. $g(t)/t^n$) with $f\in B$ (resp. $g\in C$). Let $u_{12}$ be the isomorphism of
preschemes $U_{21}\to U_{12}$ corresponding \sref{prop}{2.2.4} to the isomorphism from $B$ to
$C$ that, to $f(s)/s^m$, associates the rational fraction $f(1/t)/(1/t^m)$. We can glue $X_1$
and $X_2$ along $U_{12}$ and $U_{21}$ by using $u_{12}$, because there is clearly no gluing
condition. We later show that the prescheme $X$ obtained in this manner is a particular case
of a general method of construction (\textbf{II},~2.4.3). Here we only show that $X$ \emph{is
not an affine scheme}; this will follow from the fact that the ring $\Gamma(X,\OO_X)$ is
\emph{isomorphic} to $K$, and so its spectrum reduces to a point. Indeed, a section of
$\OO_X$ over $X$ has a restriction over $X_1$ (resp. $X_2$), identified to an affine open of
$X$, that is a polynomial $f(s)$ (resp. $g(t)$), and it follows from the definitions that we
should have $g(t)=f(1/t)$, which is not possible if $f=g\in K$.
\end{env}

\subsection{Local schemes}
\label{1-schemes-2.4}

\begin{env}{2.4.1}
\label{env-1.2.4.1}
We say that an affine scheme is a \emph{local scheme} if
it is the affine scheme associated to a local ring $A$; then there exists in
$X=\Spec(A)$ a single \emph{closed point $a\in X$}, and for all other $b\in X$
we have that $a\in\overline{\{b\}}$ \sref{cor}{1.1.7}.
\end{env}
    
For all preschemes $Y$ and points $y\in Y$, the local scheme $\Spec(\OO_y)$
is called the \emph{local scheme of $Y$ at the point $y$}. Let $V$ be an affine
open of $Y$ containing $y$, and $B$ the ring of the affine scheme $V$; then
$\OO_y$ is canonically identified with $B_y$ \sref{env}{1.3.4}, and the canonical
homomorphism $B\to B_y$ thus corresponds \sref{env}{1.6.1} to a morphism of preschemes
$\Spec(\OO_y)\to V$.  If we compose this morphism with the canonical injection
$V\to Y$, then we obtain a morphism $\Spec(\OO_y)\to Y$, which is
\emph{independent} of the affine open $V$ (containing $y$) that we chose:
indeed, if $V'$ is some other affine open containing $y$, then there exists a
third affine open $W$ containing $y$ and such that $W\subset V\cap V'$ \sref{prop}{2.1.3};
we can thus assume that $V\subset V'$, and then if $B'$ is the ring of $V'$,
everything comes down to remarking that the diagram
\[
  \xymatrix{
    B'\ar[rr]\ar[dr] & & B\ar[dl]\\
    & \OO_y &
  }
\]
is commutative \pref{env}{1.5.1}. The morphism
\[
  \Spec(\OO_y)\longrightarrow Y
\]
thus defined is said to be \emph{canonical}.
    
\begin{envs}[Proposition]{2.4.2}
\label{prop-1.2.4.2}
\oldpage{102}
Let $(Y,\OO_Y)$ be a prescheme; for all $y\in Y$, let $(\psi,\theta)$ be the canonical
morphism $(\Spec(\OO_y),\widetilde{\OO}_y)\to(Y,\OO_Y)$. Then $\psi$ is a homeomorphism
from $\Spec(\OO_y)$ to the subspace $S_y$ of $Y$ given by the $z$ such that
$y\in\overline{\{z\}}$ (\emph{or, equivalently, the generalizations of $y$
\pref{env}{2.1.2}}; furthermore, if $z=\psi(\mathfrak{p})$, then
$\theta_z^\sharp:\OO_z\to(\OO_y)_\mathfrak{p}$ is an isomorphism; $(\psi,\theta)$
is thus a monomorphism of ringed spaces.
\end{envs}
    
As the unique closed point $a$ of $\Spec(\OO_y)$ is contained in the closure of any
point of this space, and since $\psi(a)=y$, the image of $\Spec(\OO_y)$ under
the continuous map $\psi$ is contained in $S_y$. Since $S_y$ is contained in
every affine open containing $y$, one can consider just the case where $Y$ is an
affine scheme; but then this proposition follows from \sref{env}{1.6.2}.
    
\emph{We see \sref{prop}{2.1.5} that there is a bijective correspondence between
$\Spec(\OO_y)$ and the set of closed irreducible subsets of $Y$ containing $y$.}
    
\begin{envs}[Corollary]{2.4.3}
\label{cor-1.2.4.3}
For $y\in Y$ to be the generic point of an
irreducible component of $Y$, it is necessary and sufficient that the only prime
ideal of the local ring $\OO_y$ is its maximal ideal (\emph{in other words, that
$\OO_y$ is of \emph{dimension zero}}).
\end{envs}
    
\begin{envs}[Proposition]{2.4.4}
\label{prop-1.2.4.4}
Let $(X,\OO_X)$ be a local scheme of a ring
$A$, $a$ its unique closed point, and $(Y,\OO_Y)$ a prescheme.  Every morphism
$u=(\psi,\theta):(X,\OO_X)\to(Y,\OO_Y)$ then factorizes uniquely as
$X\to\Spec(\OO_{\psi(a)})\to Y$, where the second arrow denotes the canonical
morphism, and the first corresponds to a local homomorphism $\OO_{\psi(a)}\to A$.
This establishes a canonical bijective correspondence between the set of
morphisms $(X,\OO_X)\to(Y,\OO_Y)$ and the set of local homomorphisms $\OO_y\to A$
for ($y\in Y$).
\end{envs}
    
Indeed, for all $x\in X$, we have that $a\in\overline{\{x\}}$, so
$\psi(a)\in\overline{\{\psi(x)\}}$, which shows that $\psi(X)$ is contained in
every affine open containing $\psi(a)$. So it suffices to consider the case
where $(Y,\OO_Y)$ is an affine scheme of ring $B$, and we then have that
$u=(^a\vphi,\tilde{\vphi})$, where $\vphi\in\Hom(B,A)$ (1.7.3).  Further,
we have that $\vphi^{-1}(\mathfrak{j}_a)=\mathfrak{j}_{\psi(a)}$, and hence
that the image under $\vphi$ of any element of
$B\setminus\mathfrak{j}_{\psi(a)}$ is invertible in the local ring $A$; the
factorization in the result follows from the universal property of the ring of
fractions \pref{env}{1.2.4}. Conversely, to every local homomorphism
$\OO_y\to A$ there exists a unique corresponding morphism
$(\psi,\theta):X\to\Spec(\OO_y)$ such that $\psi(a)=y$ \sref{env}{1.7.3}, and,
by composing with the canonical morphism $\Spec(\OO_y)\to Y$, we obtain a morphism
$X\to Y$, which proves the proposition.
    
\begin{env}{2.4.5}
\label{env-1.2.4.5}
The affine schemes whose ring is a field $K$ have an
underlying space that is just a point. If $A$ is a local ring with maximal
ideal $\mathfrak{m}$, then every local homomorphism $A\to K$ has kernel equal to
$\mathfrak{m}$, and so factorizes as $A\to A/\mathfrak{m}\to K$, where the
second arrow is a monomorphism. The morphisms $\Spec(K)\to\Spec(A)$ thus
correspond bijectively to monomorphisms of fields $A/\mathfrak{m}\to K$.
\end{env}
    
Let $(Y,\OO_Y)$ be a prescheme; for every $y\in Y$ and every ideal
$\mathfrak{a}_y$ of $\OO_y$, the canonical homomorphism
$\OO_y\to\OO_y/\mathfrak{a}_y$ defines a morphism
$\Spec(\OO_y/\mathfrak{a}_y)\to\Spec(\OO_y)$; if we compose this with the
canonical morphism $\Spec(\OO_y)\to Y$, then we obtain a morphism
$\Spec(\OO_y/\mathfrak{a}_y)\to Y$, again said to be \textit{canonical}. For
$\mathfrak{a}_y=\mathfrak{m}_y$, this says that $\OO_y/\mathfrak{a}_y=\kres(y)$, and
so proposition \sref{prop}{2.4.4} says that:
    
\begin{envs}[Corollary]{2.4.6}
\label{cor-1.2.4.6}
\oldpage{103}
Let $(X,\OO_X)$ be a local scheme whose ring $K$ is a field, $\xi$ be the unique point of
$X$, and $(Y,\OO_Y)$ a prescheme. Then every morphism $u:(X,\OO_X)\to(Y,\OO_Y)$ factorizes
uniquely as $X\to\Spec(\kres(\psi(\xi)))\to Y$, where the second arrow denotes the canonical
morphism, and the first corresponds to a monomorphism $\kres(\psi(\xi))\to K$.
This establishes a canonical bijective correspondance between the set of
morphisms $(X,\OO_X)\to (Y,\OO_Y)$ and the set of monomorphisms $\kres(y)\to K$ (for
$y\in Y$).
\end{envs}
    
\begin{envs}[Corollary]{2.4.7}
\label{cor-1.2.4.7}
For all $y\in Y$, every canonical morphism
$\Spec(\OO_y/\mathfrak{a}_y)\to Y$ is a monomorphism of ringed spaces.
\end{envs}
    
We have already seen this when $\mathfrak{a}_y=0$ \sref{prop}{2.4.2}, and it suffices
to apply \sref{env}{1.7.5}.
    
\begin{env}[Remark]{2.4.8}
\label{rmk-1.2.4.8}
Let $X$ be a local scheme, and $a$ its unique
closed point.  Since every affine open containing $a$ is necessarily in the
whole of $X$, every \emph{invertible} $\OO_X$-module \pref{env}{5.4.1} is
necessarily \emph{isomorphic to $\OO_X$} (or, as we say, again, \emph{trivial}).
This property doesn't hold in general, for an arbitrary affine scheme
$\Spec(A)$; we will see in Chapter~V that if $A$ is a normal ring then this is
true when $A$ is \unsure{\emph{factorial}}.
\end{env}

\subsection{Preschemes over a prescheme}
\label{1-schemes-2.5}

\begin{envs}[Definition]{2.5.1}
\label{defn-1.2.5.1}
Given a prescheme $S$, we say that the data of a
prescheme $X$ and a morphism of preschemes $\vphi:X\to S$ defines a
prescheme $X$ \emph{over the prescheme $S$}, or an \emph{$S$-prescheme}; we say
that $S$ is the \emph{base prescheme} of the $S$-prescheme $X$. The morphism
$\vphi$ is called the \emph{structure morphism} of the $S$-prescheme $X$.
When $S$ is an affine scheme of ring $A$, we also say that $X$ endowed with
$\vphi$ is a prescheme \emph{over the ring $A$} (or an \emph{$A$-prescheme}).
\end{envs}

It follows from \sref{prop}{2.2.4} that the data of a prescheme over a ring $A$ is
equivalent to the data of a prescheme $(X,\OO_X)$ whose structure sheaf $\OO_X$ is
a sheaf of \emph{$A$-algebras}. \emph{An arbitrary prescheme can always be
considered as a $\mathbb{Z}$-prescheme in a unique way.}

If $\vphi:X\to S$ is the structure morphism of an $S$-prescheme $X$, we
say that a point $x\in X$ is \emph{over a point $s\in S$} if $\vphi(x)=s$.  We
say that $X$ \emph{dominates} $S$ if $\vphi$ is a dominant morphism \sref{env}{2.2.6}.

\begin{env}{2.5.2}
\label{env-1.2.5.2}
Let $X$ and $Y$ be two $S$-preschemes; we say that a morphism
of preschemes $u:X\to Y$ is a \emph{morphism of preschemes over $S$} (or
an \emph{$S$-morphism}) if the diagram
\[
  \xymatrix{
    X \ar[rr]^u \ar[dr] & & Y\ar[dl]\\
    & S &
  }
\]
(where the diagonal arrows are the structure morphisms) is
commutative: this ensures that, for all $s\in S$ and $x\in X$ over $s$, $u(x)$
is also above $s$.
\end{env}

From this definition it follows immediately that the composition of two
$S$-morphisms is an $S$-morphism; $S$-preschemes thus form a \emph{category}.

We denote by $\Hom_S(X,Y)$ the set of $S$-morphisms from an $S$-prescheme $X$ to
an $S$-prescheme $Y$; the identity morphism of an $S$-prescheme is denoted by
$1_X$.

When $S$ is an affine scheme of ring $A$, we will also say \emph{$A$-morphism}
instead of $S$-morphism.

\begin{env}{2.5.3}
\label{env-1.2.5.3}
\oldpage{104}
If $X$ is an $S$-prescheme, and $v:X'\to X$ a morphism of preschemes,
then the composition $X'\to X\to S$ endows $X'$ with the structure of an $S$-prescheme;
in particular, every prescheme induced by an open set $U$ of $X$ can be considered as an
$S$-prescheme by the canonical injection.
\end{env}

If $u:X\to Y$ is an $S$-morphism of $S$-preschemes, then the restriction
of $u$ to any prescheme induced by an open subset $U$ of $X$ is also an
$S$-morphism $U\to Y$. Conversely, let $(U_\alpha)$ be an open cover of $X$,
and for each $\alpha$ let $u_\alpha:U_\alpha\to Y$ be an $S$-morphism; if,
for all pairs of indices $(\alpha,\beta)$, the restrictions of $u_\alpha$ and
$u_\beta$ to $U_\alpha\cap U_\beta$ agree, then there exists an $S$-morphism
$X\to Y$, and only one such that the restriction to each $U_\alpha$ is
$u_\alpha$.

If $u:X\to Y$ is an $S$-morphism such that $u(X)\subset V$, where $V$ is
an open subset of $Y$, then $u$, considered as a morphism from $X$ to $V$, is
also an $S$-morphism.

\begin{env}{2.5.4}
\label{env-1.2.5.4}
Let $S'\to S$ be a morphism of preschemes; for all
$S'$-preschemes, the composition $X\to S'\to S$ endows $X$ with the structure of
an $S$-prescheme. Conversely, suppose that $S'$ is the induced prescheme of an
open subset of $S$; let $X$ be an $S$-prescheme and suppose that the structure
morphism $f:X\to S$ is such that $f(X)\subset S'$; then we can consider
$X$ as an $S'$-preschemes. In this latter case, if $Y$ is another $S$-prescheme
whose structure morphism sends the underlying space to $S'$, then every
$S$-morphism from $X$ to $Y$ is also an $S'$-morphism.
\end{env}

\begin{env}{2.5.5}
\label{env-1.2.5.5}
If $X$ is an $S$-prescheme, with structure morphism
$\vphi:X\to S$, we define an \emph{$S$-section of $X$} to be an
$S$-morphism from $S$ to $X$, that is to say a morphism of preschemes
$\psi:S\to X$ such that $\vphi\circ\psi$ is the identity on $S$.  We
denote by $\Gamma(X/S)$ the set of $S$-sections of $X$.
\end{env}

\section{Products of preschemes}
\label{1-schemes-3}

\section{Subpreschemes and immersion morphisms}
\label{1-schemes-4}

\section{Reduced preschemes; separation conditions}
\label{1-schemes-5}

\section{Finiteness conditions}
\label{1-schemes-6}

\section{Rational maps}
\label{1-schemes-7}

\section{Chevalley schemes}
\label{1-schemes-8}

\subsection{Allied local rings}
\label{1-schemes-8.1}

For every local ring $A$, we denote by $\mathfrak{m}(A)$ the maximal ideal of
$A$.

\begin{envs}[Lemma]{8.1.1}
\label{lem-1.8.1.1}
Let $A$ and $B$ be two local rings such that $A\subset B$;
then the following conditions are equivalent: (i)
$\mathfrak{m}(B)\cap A=\mathfrak{m}(A)$; (ii)
$\mathfrak{m}(A)\subset\mathfrak{m}(B)$; (iii) $1$ is not an element of
the ideal of $B$ generated by $\mathfrak{m}(A)$.
\end{envs}

It's evident that (i) implies (ii), and (ii) implies (iii); lastly, if (iii) is
true, then $\mathfrak{m}(B)\cap A$ contains $\mathfrak{m}(A)$ and doesn't
contain $1$, and is thus equal to $\mathfrak{m}(A)$.

When the equivalent conditions of \sref{lem}{8.1.1} are satisfied, we say that $B$
\emph{dominates} $A$; this is equivalent to saying that the injection $A\to B$
is a \emph{local} homomorphism. It is clear that, in the set of local subrings
of a ring $R$, the relation given by domination is an \unsure{order}.

\begin{env}{8.1.2}
\label{env-1.8.1.2}
Now consider a \emph{field} $R$. For all subrings $A$ of
$R$, we denote by $L(A)$ the set of local rings $A_\mathfrak{p}$, where
$\mathfrak{p}$ runs over the prime spectrum of $A$; they are identified with the
subrings of $R$ containing $A$. Since
$\mathfrak{p}=(\mathfrak{p}A_\mathfrak{p})\cap A$, the map $\mathfrak{p}\to A_\mathfrak{p}$
from $\Spec(A)$ to $L(A)$ is bijective.
\end{env}

\begin{envs}[Lemma]{8.1.3}
\label{lem-1.8.1.3}
Let $R$ be a field, and $A$ a subring of $R$. For a
local subring $M$ of $R$ to dominate a ring $A_\mathfrak{p}\in L(A)$ it is
necessary and sufficient that $A\subset M$; the local ring $A_\mathfrak{p}$
dominated by $M$ is then unique, and corresponds to
$\mathfrak{p}=\mathfrak{m}(M)\cap A$.
\end{envs}

Indeed, if $M$ dominates $A_\mathfrak{p}$, then $\mathfrak{m}(M)\cap
A_\mathfrak{p}=\mathfrak{p}A_\mathfrak{p}$, by \sref{lem}{8.1.1}, whence the
uniqueness of $\mathfrak{p}$; on the other hand, if $A\subset M$, then
$\mathfrak{m}M\cap A=\mathfrak{p}$ is prime in $A$, and since
$A\setminus\mathfrak{p}\subset M$, we have that $A_\mathfrak{p}\subset M$ and
$\mathfrak{p}A_\mathfrak{p}\subset\mathfrak{m}(M)$, so $M$ dominates
$A_\mathfrak{p}$

\begin{envs}[Lemma]{8.1.4}
\label{lem-1.8.1.4}
\oldpage{165}
Let $R$ be a field, $M$ and $N$ two local
subrings of $R$, and $P$ the subring of $R$ generated by $M\cup N$. Then the
following conditions are equivalent:
\begin{enumerate}[label=\rm{(\roman*)}]
  \item There exists a prime ideal $\mathfrak{p}$ of $P$ such that
        $\mathfrak{m}(M)=\mathfrak{p}\cap M$ and $\mathfrak{m}(N)=\mathfrak{p}\cap N$.
  \item The ideal $\mathfrak{a}$ generated in $P$ by $\mathfrak{m}(M)\cup\mathfrak{m}(N)$ is
        distinct from $P$.
  \item There exists a local subring $Q$ of $R$ simultaneously dominating both $M$ and $N$.
\end{enumerate}
\end{envs}

It is clear that (i) implies (ii); conversely, if $\mathfrak{a}\neq P$, then
$\mathfrak{a}$ is contained in a maximal ideal $\mathfrak{n}$ of $P$, and since
$1\not\in\mathfrak{n}$, $\mathfrak{n}\cap M$ contains $\mathfrak{m}(M)$ and is
distinct from $M$, so $\mathfrak{n}\cap M=\mathfrak{m}(M)$, and similarly
$\mathfrak{n}\cap N=\mathfrak{m}(N)$. It is clear that, if $Q$ dominates both
$M$ and $N$, then $P\subset Q$ and
$\mathfrak{m}(M)=\mathfrak{m}(Q)\cap M=(\mathfrak{m}(Q)\cap P)\cap M$, and
$\mathfrak{m}(N)=(\mathfrak{m}(Q)\cap P)\cap N$, so (iii) implies (i); the inverse is evident
when we take $Q=P_\mathfrak{p}$.

When the conditions of \sref{lem}{8.1.4} are satisfied, we say, with C.~Chevalley,
that the local rings $M$ and $N$ are \emph{allied}.

\begin{envs}[Proposition]{8.1.5}
\label{prop-1.8.1.5}
Let $A$ and $B$ be two subrings of a field $R$,
and $C$ the subring of $R$ generated by $A\cup B$. Then the following
conditions are equivalent:
\begin{enumerate}[label=\rm{(\roman*)}]
  \item For every local ring $Q$ containing $A$ and $B$, we have that
        $A_\mathfrak{p}=B_\mathfrak{q}$, where $\mathfrak{p}=\mathfrak{m}(Q)\cap A$ and
        $\mathfrak{q}=\mathfrak{m}(Q)\cap B$.
  \item For all prime ideals $\mathfrak{r}$ of $C$, we have that
        $A_\mathfrak{p}=B_\mathfrak{q}$, where $\mathfrak{p}=\mathfrak{r}\cap A$ and
        $\mathfrak{q}=\mathfrak{r}\cap B$.
  \item If $M\in L(A)$ and $N\in L(B)$ are allied, then they are identical.
  \item $L(A)\cap L(B)=L(C)$.
\end{enumerate}
\end{envs}

Lemmas \sref{lem}{8.1.3} and \sref{lem}{8.1.4} prove that (i) and (iii) are equivalent; it
is clear that (i) implies (ii) by taking $Q=C_\mathfrak{r}$; conversely, (ii)
implies (i), because if $Q$ contains $A\cup B$ then it contains $C$, and if
$\mathfrak{r}=\mathfrak{m}(Q)\cap C$ then $\mathfrak{p}=\mathfrak{r}\cap A$ and
$\mathfrak{q}=\mathfrak{r}\cap B$, from \sref{lem}{8.1.3}. It is immediate that (iv)
implies (i), because if $Q$ contains $A\cup B$ then it dominates a local ring
$C_\mathfrak{r}\in L(C)$ by \sref{lem}{8.1.3}; by hypothesis we have that
$C_\mathfrak{r}\in L(A)\cap L(B)$, and \sref{lem}{8.1.1} and \sref{lem}{8.1.3} prove that
$C_\mathfrak{r}=A_\mathfrak{p}=B_\mathfrak{q}$. We prove finally that (iii)
implies (iv). Let $Q\in L(C)$; $Q$ dominates some $M\in L(A)$ and some $N\in
L(B)$ \sref{lem}{8.1.3}, so $M$ and $N$, being allied, are identical by hypothesis.
As we then have that $C\subset M$, we know that $M$ dominates some $Q'\in L(C)$
\sref{lem}{8.1.3}, so $Q$ dominates $Q'$, whence necessarily \sref{lem}{8.1.3} $Q=Q'=M$,
so $Q\in L(A)\cap L(B)$. Conversely, if $Q\in L(A)\cap L(B)$, then $C\subset
Q$, so \sref{lem}{8.1.3} $Q$ dominates some $Q''\in L(C)\subset L(A)\cap L(B)$; $Q$
and $Q''$, being allied, are identical, so $Q''=Q\in L(C)$, which completes the
proof.

\subsection{Local rings of an integral scheme}
\label{1-schemes-8.2}

\begin{env}{8.2.1}
\label{env-1.8.2.1}
Let $X$ be an \emph{integral} prescheme, and $R$ its field of
rational functions, identical to the local ring of the generic point $a$ of $X$;
for all $x\in X$, we know that $\OO_x$ can be canonically identified with a
subring of $R$ \sref{env}{7.1.5}, and for every rational function $f\in R$, the
domain of definition $\delta(f)$ of $f$ is the open set of $x\in X$ such that
$f\in\OO_x$. It thus follows from \sref{env}{7.2.6} that, for every open $U\subset X$,
we have
\[
  \Gamma(U,\OO_X)=\bigcap_{x\in U}\OO_x.
  \tag{8.2.1.1}
\]
\end{env}

\begin{envs}[Proposition]{8.2.2}
\label{prop-1.8.2.2}
\oldpage{166}
Let $X$ be an integral prescheme,
and $R$ its field of rational fractions. For $X$ to be a scheme, it is
necessary and sufficient that the relation ``$\OO_x$ and $\OO_y$ are allied''
\sref{lem}{8.1.4}, for points $x$, $y$ of $X$, implies that $x=y$.
\end{envs}

Suppose that this condition is verified, and aim to show that $X$ is separated.
Let $U$ and $V$ be two distinct affine opens of $X$, with rings $A$ and $B$,
identified with subrings of $R$; $U$ (resp.$V$) is thus identified \sref{env}{8.1.2}
with $L(A)$ (resp.$L(B)$), and the hypothesis tells us \sref{env}{8.1.5} that $C$ is
the subring of $R$ generated by $A\cup B$, and $W=U\cap V$ is identified with
$L(A)\cap L(B)=L(C)$. Further, we know
(\cite{1}, p.~\unsure{5-03},~4~\emph{bis}) that every subring $E$ of $R$ is
equal to the intersection of the local rings belonging to $L(E)$; $C$ is thus
identified with the intersection of the rings $\OO_z$ for $z\in W$, or,
equivalently (8.2.1.1) with $\Gamma(W,\OO_X)$. So consider the subprescheme
induced by $X$ on $W$; to the \unsure{identity} morphism $\vphi:
C\to\Gamma(W,\OO_X)$ there corresponds \sref{env}{2.2.4} a morphism
$\Phi=(\psi,\theta):W\to\Spec(C)$; we will see that $\Phi$ is an
\emph{isomorphism} of preschemes, whence $W$ is an \emph{affine} open. The
identification of $W$ with $L(C)=\Spec(C)$ shows that $\psi$ is
\emph{bijective}.On the other hand, for all $x\in W$, $\theta_x^\sharp$ is the
injection $C_\mathfrak{r}\to\OO_x$, where $\mathfrak{r}=\mathfrak{m}_x\cap C$,
and by definition $C_\mathfrak{r}$ is identified with $\OO_x$, so $\theta_x^\sharp$
is bijective. It thus remains to show that $\psi$ is a \emph{homeomorphism},
i.e. that for every closed subset $F\subset W$, $\psi(F)$ is closed in
$\Spec(C)$. But $F$ is the \unsure{trace over} $W$ of closed subspace of $U$,
of the form $V(\mathfrak{a})$, where $\mathfrak{a}$ is an ideal of $A$; we show
that $\psi(F)=V(\mathfrak{a}C)$, which proves our claim. In fact, the prime
ideals of $C$ containing $\mathfrak{a}C$ are the prime ideals of $C$ containing
$\mathfrak{a}$, and so are the ideals of the form $\psi(x)=\mathfrak{m}_x\cap
C$, where $\mathfrak{a}\subset\mathfrak{m}_x$ and $x\in W$; since
$\mathfrak{a}\subset\mathfrak{m}_x$ is equivalent to $x\in V(\mathfrak{a})=W\cap
F$ for $x\in U$, we do indeed have that $\psi(F)=V(\mathfrak{a}C)$.

It follows that $X$ is separated, because $U\cap V$ is affine and its ring $C$
is generated by the union $A\cup B$ of the rings of $U$ and $V$ \sref{env}{5.5.6}.

Conversely, suppose that $X$ is separated, and let $x,y$ be two points of $X$
such that $\OO_x$ and $\OO_y$ are allied. Let $U$ (resp. $V$) be an affine open
containing $x$ (resp. $y$), of ring $A$ (resp. $B$); we then know that $U\cap V$
is affine and that its ring $C$ is generated by $A\cup B$ \sref{env}{5.5.6}. If
$\mathfrak{p}=\mathfrak{m}_x\cap A$ and $\mathfrak{q}=\mathfrak{m}_y\cap B$,
then $A_\mathfrak{p}=\OO_x$ and $B_\mathfrak{q}=\OO_y$, and since $A_\mathfrak{p}$
and $B_\mathfrak{q}$ are allied, there exists a prime ideal $\mathfrak{r}$ of
$C$ such that $\mathfrak{p}=\mathfrak{r}\cap A$ and
$\mathfrak{q}=\mathfrak{r}\cap B$ \sref{lem}{8.1.4}. But then there exists a point
$z\in U\cap V$ such that $\mathfrak{r}=\mathfrak{m}_z\cap C$, since $U\cap V$ is
affine, and so evidently $x=z$ and $y=z$, whence $x=y$.

\begin{envs}[Corollary]{8.2.3}
\label{cor-1.8.2.3}
Let $X$ be an integral scheme, and $x,y$ two
points of $X$.In order that $x\in\overline{\{y\}}$, it is necessary and
sufficient that $\OO_x\subset\OO_y$, or, equivalently, that every rational
function defined at $x$ is also defined at $y$.
\end{envs}

The condition is evidently necessary because the domain of definition
$\delta(f)$ of a rational function $f\in R$ is open; we now show that it is
sufficient.If $\OO_x\subset\OO_y$, then there exists a prime ideal
$\mathfrak{p}$ of $\OO_x$ such that $\OO_y$ dominates $(\OO_x)_\mathfrak{p}$
\sref{lem}{8.1.3}; but \sref{env}{2.4.2} there exists $z\in X$ such that
$x\in\overline{\{z\}}$ and $\OO_z=(\OO_x)_\mathfrak{p}$; since $\OO_z$ and $\OO_y$
are allied, we have that $z=y$ by \sref{prop}{8.2.2}, whence the corollary.

\begin{envs}[Corollary]{8.2.4}
\label{cor-1.8.2.4}
If $X$ is an integral scheme then the map
$x\to\OO_x$ is injective; equivalently, if $x$ and $y$ are two distinct points of
$X$, then there exists a rational function defined at one of these points but
not the other.
\end{envs}

\oldpage{167}
This follows from \sref{cor}{8.2.3} and the axiom ($T_0$) \sref{env}{2.1.4}.

\begin{envs}[Corollary]{8.2.5}
\label{cor-1.8.2.5}
Let $X$ be an integral scheme whose underlying
space is Noetherian; letting $f$ run over the field $R$ of rational functions on
$X$, the sets $\delta(f)$ generate the topology of $X$.
\end{envs}

In fact, every closed subset of $X$ is thus a finite union of irreducible closed
subsets, i.e. of the form $\overline{\{y\}}$ \sref{env}{2.1.5}. But, if
$x\not\in\overline{\{y\}}$, then there exists a rational function $f$ defined at
$x$ but not at $y$ \sref{cor}{8.2.3}, or, equivalently, we have that $x\in\delta(f)$
and $\delta(f)$ is not contained in $\overline{\{y\}}$. The complement  of
$\overline{\{y\}}$ is thus a union of sets of the form $\delta(f)$, and by
virtue of the first remark, every open subset of $X$ is the union of finite
intersections of open sets of the form $\delta(f)$.

\begin{env}{8.2.6}
\label{env-1.8.2.6}
Corollary \sref{cor}{8.2.5} shows that the topology of $X$ is
entirely characterised by the data of the local rings $(\OO_x)_{x\in X}$ that
have $R$ as their field of fractions. It amounts to the same to say that the
closed subsets of $X$ are defined in the following manner: given a finite subset
$\{x_1,\ldots,x_n\}$ of $X$, consider the set of $y\in X$ such that
$\OO_y\subset\OO_{x_i}$ for at least one index $i$, and these sets (over all
choices of $\{x_1,\ldots,x_n\}$) are the closed subsets of $X$. Further, once
the topology on $X$ is known, the structure sheaf $\OO_X$ is also determined by
the family of the $\OO_x$, since $\Gamma(U,\OO_X)=\bigcap_{x\in U}\OO_x$ by
(8.2.1.1). The family $(\OO_X)_{x\in X}$ thus completely determines the
prescheme $X$ when $X$ is an integral scheme whose underlying space is
Noetherian.
\end{env}

\begin{envs}[Proposition]{8.2.7}
\label{prop-1.8.2.7}
Let $X,Y$ be two integral schemes, $f:X\to Y$ a dominant morphism
\sref{env}{2.2.6}, and $K$ (resp.$L$) the field of rational
functions on $X$ (resp.$Y$). Then $L$ can be identified with a subfield of
$K$, and for all $x\in X$, $\OO_{f(x)}$ is the unique local ring of $Y$ dominated
by $\OO_x$.
\end{envs}

In fact, if $f=(\psi,\theta)$ and $a$ is the generic point of $X$, then
$\psi(a)$ is the generic point of $Y$ \pref{env}{2.1.5}; $\theta_a^\sharp$ is then
a monomorphism of fields, from $L=\OO_{\psi(a)}$ to $K=\OO_a$. Since every
non-empty affine open $U$ of $Y$ contains $\psi(a)$, it follows from
\sref{env}{2.2.4} that the homomorphism $\Gamma(U,\OO_Y)\to\Gamma(\psi^{-1}(U),\OO_X)$
corresponding to $f$ is the restriction of $\theta_a^\sharp$ to $\Gamma(U,\OO_Y)$.
So, for every $x\in X$, $\theta_x^\sharp$ is the restriction to $\OO_{\psi(a)}$ of
$\theta_a^\sharp$, and is thus a monomorphism. We also know that $\theta_x^\sharp$ is a
local homomorphism, so, if we identify $L$ with a subfield of $K$ by
$\theta_a^\sharp$, $\OO_{\psi(x)}$ is dominated by $\OO_x$ \sref{lem}{8.1.1}; it is also
the only local ring of $Y$ dominated by $\OO_x$, since two local rings of $Y$
that are allied are identical \sref{prop}{8.2.2}.

\begin{envs}[Proposition]{8.2.8}
\label{prop-1.8.2.8}
Let $X$ be an \emph{irreducible} prescheme; and
$f:X\to Y$ a local immersion (\emph{resp.} a local isomorphism); and
suppose further that $f$ is separated. Then $f$ is an immersion (\emph{resp.}
an open immersion).
\end{envs}

Let $f=(\psi,\theta)$; it suffices, in both cases, to prove that $\psi$ is a
\emph{homeomorphism} from $X$ to $\psi(X)$ \sref{env}{4.5.3}. Replacing $f$ by
$f_\mathrm{red}$ (\sref{env}{5.1.6} and \sref{env}{5.5.1}, (vi)), we can assume that $X$
and $Y$ are \emph{reduced}. If $Y'$ is the closed reduced subprescheme of $Y$
having $\overline{\psi(X)}$ as its underlying space, then $f$ factorizes as
$X\xrightarrow{f'}Y'\xrightarrow{j}Y$, where $j$ is the canonical injection
\sref{env}{5.2.2}. It follows from (\sref{env}{5.5.1}, (v)) that $f'$ is again a
separated morphism; further, $f'$ is again
\oldpage{168}
a local immersion (resp. a local isomorphism), because, since the condition is local on $X$
and $Y$, we can reduce ourselves to the case where $f$ is a closed immersion (resp. open
immersion), and then our claim follows immediately from \sref{env}{4.2.2}.

We can thus suppose that $f$ is a \emph{dominant} morphism, which leads to the
fact that $Y$ is, itself, irreducible \pref{env}{2.1.5}, and so $X$ and $Y$
are both \emph{integral}. Further, the condition being local on $Y$, we can
suppose that $Y$ is an affine scheme; since $f$ is separated, $X$ is a scheme
(\sref{env}{5.5.1}, (ii)), and we are finally at the hypotheses of \sref{prop}{8.2.7}.
Then, for all $x\in X$, $\theta_x^\sharp$ is injective; but the hypothesis that $F$
is a local immersion implies that $\theta_x^\sharp$ is surjective \sref{env}{4.2.2}, so
$\theta_x^\sharp$ is bijective, or, equivalently (with the identification of
\sref{prop}{8.2.7}) we have that $\OO_{\psi(x)}=\OO_x$. This implies, by \sref{cor}{8.2.4},
that $\psi$ is an \emph{injective} map, which already proves the proposition
when $f$ is a local isomorphism \sref{env}{4.5.3}. When we suppose that $f$ is only
a local immersion, for all $x\in X$ there exists an open neighbourhood $U$ of
$x$ in $X$ and an open neighbourhood $V$ of $\psi(x)$ in $Y$ such that the
restriction of $\psi$ to $U$ is a homeomorphism from $U$ to a \emph{closed}
subset of $V$. But $U$ is dense in $X$, so $\psi(U)$ is dense in $Y$ and
\emph{a fortiori} in $V$, which proves that $\psi(U)=V$; since $\psi$ is
injective, $\psi^{-1}(V)=U$ and this proves that $\psi$ is a homeomorphism from
$X$ to $\psi(X)$.

\subsection{Chevalley schemes}
\label{1-schemes-8.3}

\begin{env}{8.3.1}
\label{env-1.8.3.1}
Let $X$ be a \emph{Noetherian} integral scheme, and $R$ its
field of rational functions; we denote by $X'$ the set of local subrings
$\OO_x\subset R$, where $x$ runs over all points of $X$. The set $X'$ verifies
the three following conditions:
\begin{enumerate}
  \item[(Sch.~1)] For all $M\in X'$, $R$ is the field of fractions of $M$.
  \item[(Sch.~2)] There exists a finite set of Noetherian subrings $A_i$ of $R$
  such that $X'=\bigcup_i L(A_i)$, and, for all pairs of indices $i,j$, the subring
  $A_{ij}$ of $R$ generated by $A_i\cup A_j$ is an algebra of finite type over $A_i$.
  \item[(Sch.~3)] Two elements $M$ and $N$ of $X'$ that are allied are identical.
\end{enumerate}
\end{env}

We have basically seen in \sref{env}{8.2.1} that (Sch.~1) is satisfied, and (Sch.~3)
follows from \sref{env}{8.2.2}. To show (Sch.~2), it suffices to cover $X$ by a
finite number of affine opens $U_i$, whose rings are Noetherian, and to take
$A_i=\Gamma(U_i,\OO_X)$; the hypothesis that $X$ is a scheme implies that
$U_i\cap U_j$ is affine, and also that $\Gamma(U_i\cap U_j,\OO_X)=A_{ij}$
\sref{env}{5.5.6}; further, since the space $U_i$ is Noetherian, the immersion
$U_i\cap U_j\to U_i$ is of finite type \sref{env}{6.3.5}, so $A_{ij}$ is an
$A_i$-algebra of finite type \sref{env}{6.3.3}.

\begin{env}{8.3.2}
\label{env-1.8.3.2}
The structures whose axioms are (Sch.~1), (Sch.~2), and
(Sch.~3), generalise ``schemes'' in the sense of C.~Chevalley, who supposes
furthermore that $R$ is an extension of finite type of a field $K$, and that the
$A_i$ are $K$-algebras of finite type (which renders a part of (Sch.~2) useless)
\cite{1}. Conversely, if we have such a structure on a set $X'$, then we can
associate to it an integral scheme $X$ by using the remarks from \sref{env}{8.2.6}:
the underlying space of $X$ is equal to $X'$ endowed with the topology defined
in \sref{env}{8.2.6}, and with the sheaf $\OO_X$ such that
$\Gamma(U,\OO_X)=\bigcap_{x\in U}\OO_x$ for all open $U\subset X$, with the
evident definition of restriction homomorphisms. We leave to the reader the
task of verifying that we obtain thusly an integral scheme, whose local rings
are the elements of $X'$; we will not use this result in what follows.
\end{env}

\section{Supplement on quasi-coherent sheaves}
\label{1-schemes-9}

\subsection{Tensor product of quasi-coherent sheaves}
\label{1-schemes-9.1}

\begin{envs}[Proposition]{9.1.1}
\label{prop-1.9.1.1}
\oldpage{169}
Let $X$ be a prescheme (\emph{resp.} a locally Noetherian prescheme). Let $\sh{F}$ and
$\sh{G}$ be two quasi-coherent (\emph{resp.} coherent) $\OO_X$-modules; then
$\sh{F}\otimes_{\OO_X}\sh{G}$ is quasi-coherent (\emph{resp.} coherent) and
of finite type if $\sh{F}$ and $\sh{G}$ are of finite type. If
$\sh{F}$ admits a finite presentation and if $\sh{G}$ is quasi-coherent
(\emph{resp.} coherent), then $\shHom(\sh{F},\sh{G})$ is quasi-coherent
(\emph{resp.} coherent).
\end{envs}

Being a local property, we can suppose that $X$ is affine (resp. Noetherian
affine); further, if $\sh{F}$ is coherent, then we can assume that it is the
cokernel of a homomorphism $\OO_X^m\to\OO_X^n$. The claims pertaining to
quasi-coherent sheaves then follow from \sref{env}{1.3.12} and \sref{env}{1.3.9}; the
claims pertaining to coherent sheaves follow from \sref{env}{1.5.1} and from the fact
that, if $M$ and $N$ are modules of finite type over a Noetherian ring $A$,
$M\otimes_A N$ and $\Hom_A(M,N)$ are $A$-modules of finite type.

\begin{envs}[Definition]{9.1.2}
\label{defn-1.9.1.2}
Let $X$ and $Y$ be two $S$-preschemes, $p$ and
$q$ the projections of $X\times_S Y$, and $\sh{F}$ (resp.$\sh{G}$) a
quasi-coherent $\OO_X$-module (resp. quasi-coherent $\OO_Y$-module). We define the
tensor product of $\sh{F}$ and $\sh{G}$ over $\OO_S$ (\emph{or} over $S$),
denoted by $\sh{F}\otimes_{\OO_S}\sh{G}$ (\emph{or}
$\sh{F}\otimes_S\sh{G}$) to be the tensor product
$p^*(\sh{F})\otimes_{\OO_{X\times_S Y}}q^*(\sh{G})$ over the
prescheme $X\times_S Y$.
\end{envs}

If $X_i$ ($1\leqslant i\leqslant n$) are $S$-preschemes, and $\sh{F}_i$ are quasi-coherent
$\OO_{X_i}$-modules ($1\leqslant i\leqslant n$), then we define similarly the tensor product
$\sh{F}_1\otimes_S\sh{F}_2\otimes_S\cdots\otimes_S\sh{F}_n$ over the
prescheme $Z=X_1\times_S X_2\times_S\cdots\times_S X_n$; it is a
\emph{quasi-coherent} $\OO_Z$-module by virtue of \sref{prop}{9.1.1} and
\pref{env}{5.1.4}; it is \emph{coherent} if the $\sh{F}_i$ are coherent and
$Z$ is \emph{locally Noetherian}, by virtue of \sref{prop}{9.1.1},
\pref{env}{5.3.11}, and \sref{env}{6.1.1}.

Note that if we take $X=Y=S$ then definition \sref{defn}{9.1.2} gives us back the tensor
product of $\OO_S$-modules. Furthermore, as $q^*(\OO_Y)=\OO_{X\times_S Y}$
\pref{env}{4.3.4}, the product $\sh{F}\otimes_S\OO_Y$ is canonically
identified with $p^*(\sh{F})$, and, in the same way,
$\OO_X\otimes_S\sh{G}$ is canonically identified with $q^*(\sh{G})$. In
particular, if we take $Y=S$ and denote by $f$ the structure morphism $X\to Y$,
we have that $\OO_X\otimes_Y\sh{G}=f^*(\sh{G})$: the ordinary tensor
product and the inverse image thus appear as particular cases of the general
tensor product.

Definition \sref{defn}{9.1.2} leads immediately to the fact that, for fixed $X$ and
$Y$, $\sh{F}\otimes_S\sh{G}$ is an \emph{additive covariant bifunctor that
is right-exact} in $\sh{F}$ and $\sh{G}$.

\begin{envs}[Proposition]{9.1.3}
\label{prop-1.9.1.3}
Let $S$, $X$, $Y$ be three affine schemes of rings
$A$, $B$, $C$ (respectively), with $B$ and $C$ being $A$-algebras. Let $M$
(\emph{resp.} $N$) be a $B$-module (\emph{resp.} $C$-module), and
$\sh{F}=\widetilde{M}$ (\emph{resp.} $\sh{G}=\widetilde{N}$) the
associated quasi-coherent sheaf; then $\sh{F}\otimes_S\sh{G}$ is
canonically isomorphic to the sheaf associated to the $(B\otimes_A C)$-module
$M\otimes_A N$.
\end{envs}

\oldpage{170}
In fact, by virtue of \sref{env}{1.6.5}, $\sh{F}\otimes_S\sh{G}$
is canonically isomorphic to the sheaf associated to the $(B\otimes_A C)$-module
\[
  \big(M\otimes_B(B\otimes_A C)\big)\otimes_{B\otimes_A C}\big((B\otimes_A C)\otimes_C N\big)
\]
and by the canonical isomorphisms between tensor
products, this latter module is isomorphic to
\[
  M\otimes_B(B\otimes_A C)\otimes_C N=(M\otimes_B B)\otimes_A(C\otimes_C N)=M\otimes_A N.
\]

\begin{envs}[Proposition]{9.1.4}
\label{prop-1.9.1.4}
Let $f:T\to X$, and $g:T\to Y$ be
two $S$-morphisms, and $\sh{F}$ (\emph{resp.} $\sh{G}$) a quasi-coherent
$\OO_X$-module (\emph{resp.} quasi-coherent $\OO_Y$-module). Then
\[
  (f,g)^*_S(\sh{F}\otimes_S\sh{G})=f^*(\sh{F})\otimes_{\OO_T}g^*(\sh{G}).
\]
\end{envs}

If $p,q$ are the projections of $X\times_S Y$, then the formula in fact follows
from the relations $(f,g)^*_S\circ p^*=f^*$ and
$(f,g)^*_S\circ q^*=g^*$ \pref{env}{3.5.5}, and the fact that the inverse
image of a tensor product of algebraic sheaves is the tensor product of their inverse
images \pref{env}{4.3.3}.

\begin{envs}[Corollary]{9.1.5}
\label{cor-1.9.1.5}
Let $f:X\to X'$ and $g:Y\to Y'$ be
$S$-morphisms, and $\sh{F}'$ (\emph{resp.} $\sh{G}'$) a quasi-coherent
$\OO_{X'}$-module (\emph{resp.} quasi-coherent $\OO_{Y'}$-module). Then
\[
  (f,g)^*_S(\sh{F}'\otimes_S\sh{G}')=f^*(\sh{F}')\otimes_S g^*(\sh{G}')
\]
\end{envs}

This follows from \sref{env}{9.1.4} and the fact that $f\times_S g=(f\circ p, g\circ q)_S$,
where $p,q$ are the projections of $X\times_S Y$.

\begin{envs}[Corollary]{9.1.6}
\label{cor-1.9.1.6}
Let $X,Y,Z$ be three $S$-preschemes, and $\sh{F}$ (\emph{resp.} $\sh{G},\sh{H}$) a
quasi-coherent $\OO_X$-module (\emph{resp.} quasi-coherent $\OO_Y$-module, quasi-coherent
$\OO_Z$-module); then the sheaf $\sh{F}\otimes_S\sh{G}\otimes_S\sh{H}$ is the inverse image
of $(\sh{F}\otimes_S\sh{G})\otimes_S\sh{H}$ by the canonical isomorphism from
$X\times_S Y\times_S Z$ to $(X\times_S Y)\times_S Z$.
\end{envs}

In fact, this isomorphism is given by $(p_1,p_2)_S\times_S p_3$, where $p_1$, $p_2$, $p_3$
are the projections of $X\times_S Y\times_S Z$.

Similarly, the inverse image of $\sh{G}\otimes_S\sh{F}$ by the canonical isomorphism from
$X\times_S Y$ to $Y\times_S X$ is $\sh{F}\otimes_S\sh{G}$.

\begin{envs}[Corollary]{9.1.7}
\label{cor-1.9.1.7}
If $X$ is an $S$-prescheme, then every quasi-coherent $\OO_X$-module $\sh{F}$ is the inverse
image of $\sh{F}\otimes_S\OO_S$ by the canonical isomorphism from $X$ to $X\times_S S$
\sref{env}{3.3.3}.
\end{envs}

In fact, this isomorphism is $(1_X,\vphi)_S$, where $\vphi$ is the structure morphism
$X\to S$, and the corollary follows from \sref{env}{9.1.4} and the fact that
$\vphi^*(\OO_S)=\OO_X$.

\begin{env}{9.1.8}
\label{env-1.9.1.8}
Let $X$ be an $S$-prescheme, $\sh{F}$ a quasi-coherent
$\OO_X$-module, and $\vphi:S'\to S$ a morphism; we denote by
$\sh{F}_{(\vphi)}$ or $\sh{F}_{(S')}$ the quasi-coherent sheaf
$\sh{F}\otimes_S\OO_{S'}$ over $X\times_S S'=X_{(\vphi)}=X_{(S')}$; so
$\sh{F}_{(S')}=p^*(\sh{F})$, where $p$ is the projection $X_{(S')}\to X$.
\end{env}

\begin{envs}[Proposition]{9.1.9}
\label{prop-1.9.1.9}
Let $\vphi'':S''\to S'$ be a morphism.
For every quasi-coherent $\OO_X$-module $\sh{F}$ on the $S$-prescheme $X$,
$(\sh{F}_{(\vphi)})_{(\vphi')}$ is the inverse image of
$\sh{F}_{(\vphi\circ\vphi')}$ by the canonical isomorphism
$(X_{(\vphi)})_{(\vphi')}\isoto X_{(\vphi\circ\vphi')}$
\sref{env}{3.3.9}.
\end{envs}

This follows immediately from the definitions and from \sref{env}{3.3.9}, and is
written
\[
  (\sh{F}\otimes_S\OO_{S'})\otimes_{S'}\OO_{S''}=\sh{F}\otimes_S\OO_{S''}.
  \tag{9.1.9.1}
\]

\begin{envs}[Proposition]{9.1.10}
\label{prop-1.9.1.10}
Let $Y$ be an $S$-prescheme, and $f:X\to Y$ an $S$-morphism.
For every quasi-coherent $\OO_Y$-module and every morphism
$S'\to S$, we have that
$(f_{(S')})^*(\sh{G}_{(S')})=(f^*(\sh{G}))_{(S')}$.
\end{envs}

This follows immediately from the commutativity of the diagram
\oldpage{171}
\[
  \xymatrix{
    X_{(S')}\ar[r]^{f_{(S')}}\ar[d] & Y_{(S')}\ar[d]\\
    X\ar[r]^f & Y.
  }
\]

\begin{envs}[Corollary]{9.1.11}
\label{cor-1.9.1.11}
Let $X$ and $Y$ be $S$-preschemes, and
$\sh{F}$ (\emph{resp.} $\sh{G}$) a quasi-coherent $\OO_X$-module
(\emph{resp.} quasi-coherent $\OO_Y$-module). Then the inverse image of the sheaf
$(\sh{F}_{(S')})\otimes_{(S')}(\sh{G}_{(S')})$ by the canonical isomorphism
$(X\times_S Y)_{(S')}\isoto(X_{(S')})\times_{S'}(Y_{(S')})$
\sref{env}{3.3.10} is equal to $(\sh{F}\otimes_S\sh{G})_{(S')}$.
\end{envs}

If $p$, $q$ are the projections of $X\times_S Y$, then the isomorphism in question
is nothing but $(p_{(S')}, q_{(S')})_{S'}$; the corollary follows from
propositions \sref{env}{9.1.4} and \sref{env}{9.1.10}.

\begin{envs}[Proposition]{9.1.12}
\label{prop-1.9.1.12}
With the notation from \sref{defn}{9.1.2}, let $z$ be
a point of $X\times_S Y$, $x=p(z)$, and $y=q(z)$; the stalk
$(\sh{F}\otimes_S\sh{G})_z$ is isomorphic to
$(\sh{F}_x\otimes_{\OO_x}\OO_z)\otimes_{\OO_z}(\sh{G}_y\otimes_{\OO_y}\OO_z)
=\sh{F}_x\otimes_{\OO_x}\OO_z\otimes_{\OO_y}\otimes\sh{G}_y$.
\end{envs}

As we can reduce ourselves to the affine case, the proposition follows from
equation (1.6.5.1).

\begin{envs}[Corollary]{9.1.13}
\label{cor-1.9.1.13}
If $\sh{F}$ and $\sh{G}$ are of finite type, then we have that
\[
  \Supp(\sh{F}\otimes_S\sh{G})=p^{-1}(\Supp(\sh{F}))\cap q^{-1}(\Supp(\sh{G})).
\]
\end{envs}

Since $p^*(\sh{F})$ and $q^*(\sh{G})$ are both of finite type over
$\OO_{X\times_S Y}$, we are reduced, by \sref{env}{9.1.12} and \pref{env}{1.7.5}, to
the case where $\sh{G}=\OO_Y$, that is, it remains to prove the following
equation:
\[
  \Supp(p^{-1}(\sh{F}))=p^{-1}(\Supp(\sh{F})).
  \tag{9.1.13.1}
\]

The same reasoning as in \pref{env}{1.7.5} leads us to prove that, for all
$z\in X\times_S Y$, we have $\OO_z/\mathfrak{m}_x\OO_z\neq0$ (with $x=p(z)$),
which follows from the fact that the homomorphism $\OO_x\to\OO_z$ is \emph{local},
by hypothesis.

We leave it to the reader to extend the results in this section to the more
general case of arbitrarily (but finitely) many factors, instead of just two.

\subsection{Direct image of a quasi-coherent sheaf}
\label{1-schemes-9.2}

\begin{envs}[Proposition]{9.2.1}
\label{prop-1.9.2.1}
Let $f:X\to Y$ be a morphism of
preschemes. We suppose that there exists a cover $(Y_\alpha)$ of $Y$ by affine
opens having the following property: every $f^{-1}(Y_\alpha)$ admits a
\emph{finite} cover $(X_{\alpha i})$ by affine opens contained in
$f^{-1}(Y_\alpha)$ such that every intersection $X_{\alpha i}\cap X_{\alpha j}$
is itself a \emph{finite} union of affine opens. With these hypotheses, for
every quasi-coherent $\OO_X$-module $\sh{F}$, $f_*(\sh{F})$ is a
quasi-coherent $\OO_Y$-module.
\end{envs}

Since this is a local condition on $Y$, we can assume that $Y$ is equal to one
of the $Y_\alpha$, and thus omit the indices $\alpha$.

\begin{enumerate}[label=(\alph*)]
  \item First, suppose that the $X_i\cap X_j$
        are themselves \emph{affine} opens. We set $\sh{F}_i=\sh{F}|X_i$ and
        $\sh{F}_{ij}=\sh{F}|(X_i\cap X_j)$, and let $\sh{F}'_i$ and
        $\sh{F}'_{ij}$ be the images of $\sh{F}_i$ and $\sh{F}_{ij}$
        (respectively) by the restriction of $f$ to $X_i$ and $X_i\cap X_j$
        (respectively); we know that the $\sh{F}'_i$ and $\sh{F}'_{ij}$ are
        quasi-coherent \sref{env}{1.6.3}. Set $\sh{G}=\bigoplus_i\sh{F}'_i$ and
        $\sh{H}=\bigoplus_{i,j}\sh{F}'_{ij}$; $\sh{G}$ and $\sh{H}$ are
        quasi-coherent $\OO_Y$-modules; we will define a homomorphism
        $u:\sh{G}\to\sh{H}$ such that $f_*(\sh{F})$ is the
        \emph{kernel} of $u$; it will follow from this that $f_*(\sh{F})$ is
        quasi-coherent \sref{env}{1.3.9}. It suffices to define $u$ as
\oldpage{172}
        a homomorphism of presheaves; taking into account the definitions of $\sh{G}$
        and $\sh{H}$, it thus suffices, for every open subset $W\subset Y$, to define a
        homomorphism
        \[
          u_W:\bigoplus_i\Gamma(f^{-1}(W)\cap X_i,\sh{F})
          \longrightarrow\bigoplus_{i,j}\Gamma(f^{-1}(W)\cap X_i\cap X_j,\sh{F})
        \]
        in such a way that it satisfies the usual compatibility conditions when $W$
        varies. If, for every section $s_i\in\Gamma(f^{-1}(W)\cap X_i,\sh{F})$, we
        denote by $s_{i|j}$ the restriction to $f^{-1}(W)\cap X_i\cap X_j$, then we set
        \[
          u_W\big((s_i)\big)=(s_{i|j}-s_{j|i})
        \]
        and the compatibility conditions are clearly satisfied. To prove that the kernel
        $\sh{R}$ of $u$ is $f_*(\sh{F})$, we define a homomorphism from $f_*(\sh{F})$ to
        $\sh{R}$ by sending each section $s\in\Gamma(f^{-1}(W),\sh{F})$ to the family
        $(s_i)$, where $s_i$ is the restriction of $s$ to $f^{-1}(W)\cap X_i$; the
        axioms (F1) and (F2) of sheaves (G, II, 1.1) tell us that this homomorphism is
        \emph{bijective}, which finishes the proof in this case.
  \item In the general case, the same reasoning applies once we have established that
        the $\sh{F}_{ij}$ are quasi-coherent. But, by hypothesis, $X_i\cap X_j$ is a
        finite union of affine opens $X_{ijk}$; and since the $X_{ijk}$ are affine opens
        \emph{in a scheme}, the intersection of any two of them is again an affine open
        \sref{env}{5.5.6}. We are thus led to the first case, and so we have proved
        \sref{env}{9.2.1}.
\end{enumerate}

\begin{envs}[Corollary]{9.2.2}
\label{cor-1.9.2.2}
The conclusion of \sref{prop}{9.2.1} holds true in each of the following cases:
\begin{enumerate}[label=\rm{(\alph*)}]
  \item $f$ is separated and quasi-compact.
  \item $f$ is separated and of finite type.
  \item $f$ is quasi-compact and the underlying space of $X$ is locally Noetherian.
\end{enumerate}
\end{envs}

In case \emph{(a)}, the $X_{\alpha i}\cap X_{\alpha j}$ are affine \sref{env}{5.5.6}.
Case \emph{(b)} is a particular case of \emph{(a)} \sref{env}{6.6.3}. Finally, in case
\emph{(c)}, we can reduce to the case where $Y$ is affine and the underlying
space of $X$ is Noetherian; then $X$ admits a finite cover of affine opens
$(X_i)$, and the $X_i\cap X_j$, being quasi-compact, are finite unions of affine
opens \sref{prop}{2.1.3}.

\subsection{Extension of sections of quasi-coherent sheaves}
\label{1-schemes-9.3}

\begin{envs}[Theorem]{9.3.1}
\label{thm-1.9.3.1}
Let $X$ be a prescheme whose underlying space is Noetherian, or a scheme whose underlying
space is quasi-compact. Let $\sh{L}$ be an invertible $\OO_X$-module \pref{env}{5.4.1}, $f$ a
section of $\sh{L}$ over $X$, $X_f$ the open set of $x\in X$ such that $f(x)\neq0$
\pref{env}{5.5.1}, and $\sh{F}$ a quasi-coherent $\OO_X$-module.
\begin{enumerate}[label=\rm{(\roman*)}]
  \item If $s\in\Gamma(X,\sh{F})$ is such that $s|X_f=0$, then there exists an integer $n>0$
        such that $s\otimes f^{\otimes n}=0$.
  \item For every section $s\in\Gamma(X_f,\sh{F})$, there exists an integer $n>0$ such that
        $s\otimes f^{\otimes n}$ extends to a section of $\sh{F}\otimes\sh{L}^{\otimes n}$
        over $X$.
\end{enumerate}
\end{envs}

\begin{enumerate}[label=(\roman*)]
  \item Since the underlying space of $X$ is quasi-compact, and thus the union of
        finitely-many affine opens $U_i$ with $\sh{L}|U_i$ is isomorphic to
        $\OO_X|U_i$, we can reduce to the case where $X$ is affine and $\sh{L}=\OO_X$.
        In this case, $f$ is identified with an element of $A(X)$, and we have that
        $X_f=D(f)$; $s$ is identified with an element of an $A(X)$-module $M$, and
        $s|X_f$ to the corresponding element of $M_f$, and the result is then trivial,
        recalling the definition of a module of fractions.
\oldpage{173}
  \item Again, $X$ is a finite union of affine opens $U_i$ ($1\leqslant i\leqslant r$)
        such that $\sh{L}|U_i\cong\OO_X|U_i$, and for every $i$,
        $(s\otimes f^{\otimes n})|(U_i\cap X_f)$ is identified (by the aforementioned
        isomorphism) with $(f|(U_i\cap X_f))^n(s|(U_i\cap X_f))$. We then know
        \sref{env}{1.4.1} that there exists an integer $n>0$ such that, for all
        $i$, $(s\otimes f^{\otimes n})|(U_i\cap X_f)$ extends to a section $s_i$ of
        $\sh{F}\otimes\sh{L}^{\otimes n}$ over $U_i$. Let $s_{i|j}$ be the restriction
        of $s_i$ to $U_i\cap U_j$; by definition we have that $s_{i|j}-s_{j|i}=0$ in
        $X_f\cap U_i\cap U_j$. But, if $X$ is a Noetherian space, then $U_i\cap U_j$ is
        quasi-compact; if $X$ is a scheme, then $U_i\cap U_j$ is an affine open
        \sref{env}{5.5.6}, and so again quasi-compact. By virtue of (i), there thus
        exists an integer $m$ (independent of $i$ and $j$) such that
        $(s_{i|j}-s_{j|i})\otimes f^{\otimes m}=0$. It immediately follows that there
        exists a section $s'$ of $\sh{F}\otimes\sh{L}^{\otimes(n+m)}$ over $X$,
        restricting to $s_i\otimes f^{\otimes m}$ over each $U_i$, and restricting to
        $s\otimes f^{\otimes(n+m)}$ over $X_f$.
\end{enumerate}

The following corollaries give an interpretation of theorem \sref{env}{9.3.1} in a more
algebraic language:
\begin{envs}[Corollary]{9.3.2}
\label{cor-1.9.3.2}
With the hypotheses of \sref{thm}{9.3.1}, consider the graded ring $A_*=\Gamma_*(\sh{L})$
and the graded $A_*$-module $M_*=\Gamma_*(\sh{L},\sh{F})$ \pref{env}{5.4.6}. If $f\in A_n$,
where $n\in\bb{Z}$, then there is a canonical isomorphism
$\Gamma(X_f,\sh{F})\isoto((M_*)_f)_0$ (\emph{the subgroup of the module of
fractions $(M_*)_f$ consisting of elements of degree $0$}).
\end{envs}

\begin{envs}[Corollary]{9.3.3}
\label{cor-1.9.3.3}
Suppose that the hypotheses of \sref{thm}{9.3.1} are satisfied, and suppose further that
$\sh{L}=\OO_X$. Then, setting $A=\Gamma(X,\OO_X)$ and $M=\Gamma(X,\sh{F})$, the $A_f$-module
$\Gamma(X_f,\sh{F})$ is canonically isomorphic to $M_f$.
\end{envs}

\begin{envs}[Proposition]{9.3.4}
\label{prop-1.9.3.4}
Let $X$ be a Noetherian prescheme, $\sh{F}$ a coherent $\OO_X$-module, and $\sh{J}$ a
coherent sheaf of ideals in $\OO_X$, such that the support of $\sh{F}$ is contained in that
of $\OO_X|\sh{J}$. Then there exists a whole number $n>0$ such that $\sh{J}^n\sh{F}=0$.
\end{envs}

Since $X$ is a union of finitely-many affine opens whose rings are Noetherian, we can suppose
that $X$ is affine of Noetherian ring $A$; then $\sh{F}=\widetilde{M}$, where
$M=\Gamma(X,\sh{F})$ is an $A$-module of finite type, and $\sh{J}=\widetilde{\mathfrak{J}}$,
where $\mathfrak{J}=\Gamma(X,\sh{J})$ is an ideal of $A$ (\sref{env}{1.4.1} and
\sref{env}{1.5.1}). Since $A$ is Noetherian, $\mathfrak{J}$ admits a finite system of
generators $f_i$ ($1\leqslant i\leqslant m$). By hypothesis, every section of $\sh{F}$ over
$X$ is zero in each of the $D(f_i)$; if $s_j$ ($1\leqslant j\leqslant q$) are sections of
$\sh{F}$ generating $M$, then there exists a whole number $h$, independent of $i$ and $j$,
such that $f_i^h s_j=0$ \sref{env}{1.4.1}, whence $f_i^h s=0$ for all $s\in M$. We thus
conclude that if $n=mh$ then $\mathfrak{J}^n M=0$, and so the corresponding $\OO_X$-module
$\sh{J}^n\sh{F}=\widetilde{\mathfrak{J}^n M}$ \sref{env}{1.3.13} is zero.

\begin{envs}[Corollary]{9.3.5}
\label{cor-1.9.3.5}
With the hypotheses of \sref{prop}{9.3.4}, there exists a closed subprescheme $Y$ of $X$,
whose underlying space is the support of $\OO_X/\sh{J}$, such that, if $j:Y\to X$ is the
canonical injection, then $\sh{F}=j_*(j^*(\sh{F}))$.
\end{envs}

First of all, note that the supports of $\OO_X/\sh{J}$ and $\OO_X/\sh{J}^n$ are the same,
since, if $\sh{J}_x=\OO_x$, then $\sh{J}_x^n=\OO_x$, and we also have that
$\sh{J}_x^n\subset\sh{J}_x$ for all $x\in X$. We can, thanks to \sref{prop}{9.3.4}, thus
suppose that $\sh{J}\sh{F}=0$; we can then take $Y$ to be the closed subprescheme of $X$
defined by $\sh{J}$, and since $\sh{F}$ is then an $(\OO_X/\sh{J})$-module, the conclusion
follows immediately.

\subsection{Extension of quasi-coherent sheaves}
\label{1-schemes-9.4}        

\begin{env}{9.4.1}
\label{env-1.9.4.1}
Let
\oldpage{174}
$X$ be a topological space, $\sh{F}$ a sheaf of sets (resp. of groups, of rings) on $X$, $U$
an open subset of $X$, $\psi:U\to X$ the canonical injection, and $\sh{G}$ a subsheaf of
$\sh{F}|U=\psi^*(\sh{F})$. Since $\psi_*$ is left exact, $\psi_*(\sh{G})$ is a subsheaf of
$\psi_*(\psi^*(\sh{F}))$; if we denote by $\rho$ the canonical homomorphism
$\sh{F}\to\psi_*(\psi^*(\sh{F}))$ \pref{env}{3.5.3}, then we denote by $\overline{\sh{G}}$
the subsheaf $\rho^{-1}(\psi_*(\sh{G}))$ of $\sh{F}$. It follows immediately from the
definitions that, for every open subset $V$ of $X$, $\Gamma(V,\overline{\sh{G}})$ consists of
sections $s\in\Gamma(V,\sh{F})$ whose restriction to $V\cap U$ is a section of $\sh{G}$ over
$V\cap U$. We thus have that $\overline{\sh{G}}|U=\psi^*(\overline{\sh{G}})=\sh{G}$, and that
$\overline{\sh{G}}$ is the \emph{biggest} subsheaf of $\sh{F}$ that restricts to $\sh{G}$
over $U$; we say that $\overline{\sh{G}}$ is the \emph{canonical extension} of the subsheaf
$\sh{G}$ of $\sh{F}|U$ to a subsheaf of $\sh{F}$.
\end{env}

\begin{envs}[Proposition]{9.4.2}
\label{prop-1.9.4.2}
Let $X$ be a prescheme, $U$ an open subset of $X$ such that the canonical injection
$j:U\to X$ is a quasi-compact morphism \emph{(which will be the case for \emph{all} $U$ if
the underlying space of $X$ is \emph{locally Noetherian}
{\normalfont(\sref{env}{6.6.4}, (i))})}. Then:
\begin{enumerate}[label=\rm{(\roman*)}]
  \item For every quasi-coherent $(\OO_X|U)$-module $\sh{G}$, $j_*(\sh{G})$
        is a quasi-coherent $\OO_X$-module, and $j_*(\sh{G})|U=j^*(j_*(\sh{G}))=\sh{G}$.
  \item For every quasi-coherent $\OO_X$-module $\sh{F}$ and every quasi-coherent
        $(\OO_X|U)$-submodule $\sh{G}$, the canonical extension
        $\overline{\sh{G}}$ of $\sh{G}$ \sref{env}{9.4.1} is a
        quasi-coherent $\OO_X$-submodule of $\sh{F}$.
\end{enumerate}
\end{envs}

If $j=(\psi,\theta)$ ($\psi$ being the injection $U\to X$ of underlying spaces), then by
definition we have that $j_*(\sh{G})=\psi_*(\sh{G})$ for every $(\OO_X|U)$-module $\sh{G}$,
and, further, that $j^*(\sh{H})=\psi^*(\sh{H})=\sh{H}|U$ for every $\OO_X$-module $\sh{H}$,
by definition of the prescheme induced over an open subset. So (i) is thus a particular case
of (\sref{env}{9.2.2}, (a)); for the same reason, $j_*(j^*(\sh{F}))$ is quasi-coherent, and
since $\overline{\sh{G}}$ is the inverse image of $j_*(\sh{G})$ by the homomorphism
$\rho:\sh{F}\to j_*(j^*(\sh{F}))$, (ii) follows from \sref{env}{4.1.1}.
 
Note that the hypothesis that the morphism $j:U\to X$ is quasi-compact
holds whenever the open subset $U$ is \emph{quasi-compact} and $X$ is a
\emph{scheme}: indeed, $U$ is then a union of finitely-many affine opens $U_i$,
and for every affine open $V$ of $X$, $V\cap U_i$ is an affine open \sref{env}{5.5.6}, and
thus quasi-compact.
 
\begin{envs}[Corollary]{9.4.3}
\label{cor-1.9.4.3}
Let $X$ be a prescheme, $U$ a quasi-compact open subset of $X$ such that the injection
morphism $j:U\to X$ is quasi-compact. Suppose as well that every quasi-coherent
$\OO_X$-module is the inductive limit of its quasi-coherent $\OO_X$-submodules of finite type
\emph{(which will be the case if $X$ is an \emph{affine scheme})}. Then let $\sh{F}$ be a
quasi-coherent $\OO_X$-module, and $\sh{G}$ a quasi-coherent $(\OO_X|U)$-submodule \emph{of
finite type} of $\sh{F}|U$. Then there exists a quasi-coherent $\OO_X$-submodule $\sh{G}'$ of
$\sh{F}$ \emph{of finite type} such that $\sh{G}'|U=\sh{G}$.
\end{envs}
 
Indeed, we have $\sh{G}=\overline{\sh{G}}|U$, and $\overline{\sh{G}}$ is quasi-coherent, from
\sref{prop}{9.4.2}, and so the inductive limit of its quasi-coherent $\OO_X$-submodules
$\sh{H}_\lambda$ of finite type. It follows that $\sh{G}$ is the inductive limit of the
$\sh{H}_\lambda|U$, and thus equal to one of the $\sh{H}_\lambda|U$ since it is of finite
type \pref{env}{5.2.3}.
 
\begin{env}[Remark]{9.4.4}
\label{rmk-1.9.4.4}
Suppose that for \emph{every} affine open $U\subset X$, the injection morphism $U\to X$ is
quasi-compact. Then, if the conclusion of \sref{cor}{9.4.3} holds for every affine open $U$
and every quasi-coherent $(\OO_X|U)$-submodule $\sh{G}$ of $\sh{F}|U$ of finite type, it
follows
\oldpage{175}
that $\sh{F}$ is the inductive limit of its quasi-coherent $\OO_X$-submodules of finite type.
Indeed, for every affine open $U\subset X$, we have that $\sh{F}|U=\widetilde{M}$, where $M$
is an $A(U)$-module, and since the latter is the inductive limit of its quasi-coherent
submodules of finite type, $\sh{F}|U$ is the inductive limit of its $(\OO_X|U)$-submodules of
finite type \sref{env}{1.3.9}. But, by hypothesis, each of these submodules is induced on $U$
by a quasi-coherent $\OO_X$-submodule $\sh{G}_{\lambda,U}$ of $\sh{F}$ of finite type. The
finite sums of the $\sh{G}_{\lambda,U}$ are again quasi-coherent $\OO_X$-modules of finite
type, because the property is local, and the case where $X$ is affine was covered in
\sref{env}{1.3.10}; it is clear then that $\sh{F}$ is the inductive limit of these finite
sums, whence our claim.
\end{env}
 
\begin{envs}[Corollary]{9.4.5}
\label{cor-1.9.4.5}
Under the hypotheses of \sref{cor}{9.4.3}, for every quasi-coherent $(\OO_X|U)$-module
$\sh{G}$ of finite type, there exists a quasi-coherent $\OO_X$-module $\sh{G}'$ of finite
type such that $\sh{G}'|U=\sh{G}$.
\end{envs}

Since $\sh{F}=j_*(\sh{G})$ is quasi-coherent \sref{prop}{9.4.2} and $\sh{F}|U=\sh{G}$, it
suffices to apply \sref{cor}{9.4.3} to $\sh{F}$.

\begin{envs}[Lemma]{9.4.6}
\label{lem-1.9.4.6}
Let $X$ be a prescheme, $L$ a well-ordered set, $(V_\lambda)_{\lambda\in L}$ a cover of $X$
by affine opens, and $U$ an open subset of $X$; for all $\lambda\in L$, we set
$W_\lambda=\bigcup_{\mu<\lambda}V_\mu$. Suppose that: (1) for every $\lambda\in L$,
$V_\lambda\cap W_\lambda$ is quasi-compact; (2) the immersion morphism $U\to X$ is
quasi-compact. Then, for every quasi-coherent $\OO_X$-module $\sh{F}$ and every
quasi-coherent $(\OO_X|U)$-submodule $\sh{G}$ of $\sh{F}|U$ \emph{of finite type}, there
exists a quasi-coherent $\OO_X$-submodule $\sh{G}'$ of $\sh{F}$ \emph{of finite type} such
that $\sh{G}'|U=\sh{G}$.
\end{envs}

Let $U_\lambda=U\cup W_\lambda$; we will define a family $(\sh{G}'_\lambda)$ by induction,
where $\sh{G}'_\lambda$ is a quasi-coherent $(\OO_X|U_\lambda)$-submodule of
$\sh{F}|U_\lambda$ of finite type, such that $\sh{G}'_\lambda|U_\mu=\sh{G}'_\mu$ for
$\mu<\lambda$ and $\sh{G}'_\lambda|U=\sh{G}$. The unique $\OO_X$-submodule $\sh{G}'$ of
$\sh{F}$ such that $\sh{G}'|U_\lambda=\sh{G}'$ for all $\lambda\in L$ \pref{env}{3.3.1} gives
us what we want. So suppose that the $\sh{G}'_\mu$ are defined and have the preceding
properties for $\mu<\lambda$; if $\lambda$ does not have a predecessor then we take for
$\sh{G}'_\lambda$ the unique $(\OO_X|U_\lambda)$-submodule of $\sh{F}|U_\lambda$ such that
$\sh{G}'_\lambda|U_\mu=\sh{G}'_\mu$ for all $\mu<\lambda$, which is allowed since the $U_\mu$
with $\mu<\lambda$ then form a cover of $U_\lambda$. If, conversely, $\lambda=\mu+1$, then
$U_\lambda=U_\mu\cup V_\mu$, and it suffices to define a quasi-coherent
$(\OO_X|V_\mu)$-submodule $\sh{G}''_\mu$ of $\sh{F}|V_\mu$ of finite type such that
\[
  \sh{G}''_\mu|(U_\mu\cap V_\mu)=\sh{G}'_\mu|(U_\mu\cap V_\mu);
\]
and then to take for $\sh{G}'_\lambda$ the $(\OO_X|U_\lambda)$-submodule of
$\sh{F}|U_\lambda$ such that $\sh{G}'_\lambda|U_\mu=\sh{G}'_\mu$ and
$\sh{G}'_\lambda|V_\mu=\sh{G}''_\mu$ \pref{env}{3.3.1}. But, since $V_\mu$ is affine, the
existence of $\sh{G}''_\mu$ is guaranteed by \sref{cor}{9.4.3} as soon as we show that
$U_\mu\cap V_\mu$ is quasi-compact; but $U_\mu\cap V_\mu$ is the union of $U\cap V_\mu$ and
$W_\mu\cap V_\mu$, which are both quasi-compact by virtue of the hypothesis.

\begin{envs}[Theorem]{9.4.7}
\label{thm-1.9.4.7}
Let $X$ be a prescheme, and $U$ an open set of $X$. Suppose that one of the following
conditions is verified:
\begin{enumerate}[label=\rm{(\alph*)}]
  \item the underlying space of $X$ is locally Noetherian;
  \item $X$ is a quasi-compact scheme and $U$ is a quasi-compact open.
\end{enumerate}
Then, for every quasi-coherent $\OO_X$-module $\sh{F}$ and every quasi-coherent
$(\OO_X|U)$-submodule $\sh{G}$ of $\sh{F}|U$ \emph{of finite type}, there exists a
quasi-coherent $\OO_X$-submodule $\sh{G}'$ of $\sh{F}$ \emph{of finite type} such that
$\sh{G}'|U=\sh{G}$.
\end{envs}

Let
\oldpage{176}
$(V_\lambda)_{\lambda\in L}$ be a cover of $X$ by affine opens, with $L$ assumed to be finite
in case (b); since $L$ is equipped with the structure of a well-ordered set, it suffices to
check that the conditions of \sref{lem}{9.4.6} are satisfied. It is clear in the case of (a),
as the spaces $V_\lambda$ are Noetherian. For case (b), the $V_\lambda\cap\lambda_\mu$ are
affine \sref{env}{5.5.6}, and thus quasi-compact, and since $L$ is finite,
$V_\lambda\cap W_\lambda$ is quasi-compact. Whence the theorem.

\begin{envs}[Corollary]{9.4.8}
\label{cor-1.9.4.8}
Under the hypotheses of \sref{thm}{9.4.7}, for every quasi-coherent $(\OO_X|U)$-module
$\sh{G}$ of finite type, there exists a quasi-coherent $\OO_X$-module $\sh{G}'$ of finite
type such that $\sh{G}'|U=\sh{G}$.
\end{envs}

It suffices to apply \sref{thm}{9.4.7} to $\sh{F}=j_*(\sh{G})$, which is quasi-coherent
\sref{prop}{9.4.2} and such that $\sh{F}|U=\sh{G}$.

\begin{envs}[Corollary]{9.4.9}
\label{cor-1.9.4.9}
Let $X$ be a prescheme whose underlying space is locally Noetherian, or a quasi-compact
scheme. Then every quasi-coherent $\OO_X$-module is the inductive limit of its quasi-coherent
$\OO_X$-submodules of finite type.
\end{envs}

This follows from \sref{thm}{9.4.7} and the remark \sref{rmk}{9.4.4}.

\begin{envs}[Corollary]{9.4.10}
\label{cor-1.9.4.10}
Under the hypotheses of \sref{cor}{9.4.9}, if a quasi-coherent $\OO_X$-module $\sh{F}$ is
such that every quasi-coherent $\OO_X$-submodule of finite type of $\sh{F}$ is generated by
its sections over $X$, then $\sh{F}$ is generated by its sections over $X$.
\end{envs}

Indeed, let $U$ be an affine open neighbourhood of a point $x\in X$, and let $s$ be a
section of $\sh{F}$ over $U$; the $\OO_X$-submodule $\sh{G}$ of $\sh{F}|U$ generated by $s$
is quasi-coherent and of finite type, so there exists a quasi-coherent $\OO_X$-submodule
$\sh{G}'$ of $\sh{F}$ of finite type such that $\sh{G}'|U=\sh{G}$ \sref{thm}{9.4.7}. By
hypothesis, there is thus a finite number of sections $t_i$ of $\sh{G}'$ over $X$ and of
sections $a_i$ of $\OO_X$ over a neighbourhood $V\subset U$ of $x$ such that
$s|V=\sum_i a_i(t_i|V)$, which proves the corollary.

\subsection{Closed image of a prescheme; closure of a subprescheme}
\label{1-schemes-9.5}        

\begin{envs}[Proposition]{9.5.1}
\label{prop-1.9.5.1}
Let $f:X\to Y$ be a morphism of preschemes such that $f_*(\OO_X)$ is a quasi-coherent
$\OO_Y$-module (which will be the case if $f$ is quasi-compact and if in addition $f$ is
either separated or $X$ is locally Noetherian \sref{cor}{9.2.2}). Then there exists a smaller
subprescheme $Y'$ of $Y$ such that $f$ factors through the canonical injection $j:Y'\to Y$
(\emph{or, equivalently \sref{env}{4.4.1}, such that the subprescheme $f^{-1}(Y')$ of $X$ is
\emph{identical} to $X$}).
\end{envs}

More precisely:
\begin{envs}[Corollary]{9.5.2}
\label{cor-1.9.5.2}
Under the conditions of \sref{prop}{9.5.1}, let $f=(\psi,\theta)$, and let $\sh{J}$ be the
(quasi-coherent) kernel of the homomorphism $\theta:\OO_Y\to f_*(\OO_X)$. Then the closed
subprescheme $Y'$ of $Y$ defined by $\sh{J}$ satisfies the conditions of \sref{prop}{9.5.1}.
\end{envs}

Since the functor $\psi^*$ is exact, the canonical factorization
$\theta:\OO_Y\to\OO_Y/\sh{J}\xrightarrow{\theta'}\psi_*(\OO_X)$ gives (\textbf{0},~3.5.4.3)
a factorization
$\theta^\sharp:\psi^*(\OO_Y)\to\psi^*(\OO_Y)/\psi^*(\sh{J})
\xrightarrow{{\theta'}^\sharp}\OO_X$; since $\theta_x^\sharp$ is a local homomorphism for
every $x\in X$, the same is true of ${\theta_x'}^\sharp$; if we denote by $\psi_0$ the
continuous map $\psi$ considered as a map from $X$ to $X'$, and by $\theta_0$ the restriction
$\theta'|X':(\OO_Y/\sh{J})|X'\to\psi_*(\OO_X)|X'=(\psi_0)_*(\OO_X)$, we see that
$f_0=(\psi_0,\theta_0)$ is a morphism of preschemes $X\to X'$ \sref{defn}{2.2.1} such that
$f=j\circ f_0$. Now, if $X''$ is
\oldpage{177}
a second closed subprescheme of $Y$, defined by a quasi-coherent sheaf of ideals $\sh{J}'$ of
$\OO_Y$, such that $f$ factors through the injection $j':X''\to Y$, then we should
immediately have that $\psi(X)\subset X''$, and so $X'\subset X''$, since $X''$ is closed.
Furthermore, for all $y\in X''$, $\theta$ should factorize as
$\OO_y\to\OO_y/\sh{J}'_y\to(\psi_*(\OO_X))_y$, which by definition leads to
$\sh{J}'_y\subset\sh{J}_y$, and thus $X'$ is a closed subprescheme of $X''$
\sref{env}{4.1.10}.

\begin{envs}[Definition]{9.5.3}
\label{defn-1.9.5.3}
Whenever there exists a smaller subprescheme $Y'$ of $Y$ such that $f$ factors through the
canonical injection $j:Y'\to Y$, we
say that $Y'$ is the \emph{closed image} prescheme of $X$ by the morphism $f$.
\end{envs}

\begin{envs}[Proposition]{9.5.4}
\label{prop-1.9.5.4}
If $f_*(\OO_X)$ is a quasi-coherent $\OO_Y$-module, then the underlying space of
the closed image of $X$ by $f$ is the closure $\overline{f(X)}$ in $Y$.
\end{envs}

\subsection{Quasi-coherent sheaves of algebras; change of structure sheaf}
\label{1-schemes-9.6}        

\section{Formal schemes}
\label{1-schemes-10}

